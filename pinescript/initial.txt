### Pine Script Start of String Assertion \A

Source: https://www.tradingview.com/pine-script-docs/concepts/strings

Demonstrates the \A assertion, which matches the starting point of the source string without consuming characters. The example matches word characters only at the beginning of the string.

```Pine Script
regex.test("\\A\\w+", "start of string")
```

--------------------------------

### Define Inputs in Pine Script

Source: https://www.tradingview.com/pine-script-docs/writing/style-guide

Illustrates how to define script inputs in Pine Script, grouping them at the beginning for better organization. It shows examples of using `input.string` and `input.int` functions with predefined constants for options and tooltips. Input variable names are suffixed with `Input` for easy identification.

```Pine Script
// ———— Inputs  
string    resetInput              = input.string(RST2,           "CVD Resets",                   inline = "00", options = [RST1, RST2, RST3, RST4, RST5, RST6, RST7])  
string    fixedTfInput            = input.timeframe("D",         "		Fixed HTF:	   ",           tooltip = TT_RST_HTF)  
int       hourInput               = input.int(9,                 "		Fixed time hour: 	",         inline = "01", minval = 0, maxval = 23)  
int       minuteInput             = input.int(30,                "minute",                       inline = "01", minval = 0, maxval = 59, tooltip = TT_RST_TIME)  
int       fixedPeriodInput        = input.int(20,                "		Fixed period:	   ",         inline = "02", minval = 1, tooltip = TT_RST_PERIOD)  
string    ltfModeInput            = input.string(LTF3,          "Intrabar precision",           inline = "03", options = [LTF1, LTF2, LTF3, LTF4])  
```

--------------------------------

### Pine Script: Full Script Example

Source: https://www.tradingview.com/pine-script-docs/language/methods

This is a complete Pine Script example demonstrating the use of user-defined methods for calculating Bollinger Bands. It includes input definitions and the core logic for applying the custom methods.

```Pine Script
//@version=6  
indicator("Custom Sample BB", overlay = true)  
  
float sourceInput  = input.source(close, "Source")  
```

--------------------------------

### Pine Script v5 UDT History Referencing Example

Source: https://www.tradingview.com/pine-script-docs/migration-guides/to-pine-version-6

Demonstrates using the history-referencing operator `[]` directly on UDT fields in Pine Script v5. This script defines a UDT `LblSettings` to store label styles and percentage differences, then displays labels and a table showing data from 10 bars prior.

```Pine Script
//@version=5  
indicator("UDT history-referencing demo", overlay = true)
  
//@type A custom type to hold bar's `label` settings based on bar's direction.
//Includes bar direction, label style and color, and "string" percentage difference between bar's `open` and `close`.
type LblSettings
    bool isUp = false
    string lblStyle
    color lblColor
    string diff

//@variable A `LblSettings` instance declared on every bar.
LblSettings infoObject = LblSettings.new()

// Set the `LblSettings` object fields based on current bar's direction and price information.
infoObject.isUp := close > open
infoObject.lblStyle := infoObject.isUp ? label.style_arrowup : label.style_arrowdown
infoObject.lblColor := infoObject.isUp ? color.green : color.red
infoObject.diff := str.tostring((close - open) / open * 100, "# .##") + "%"

// Display a new `label` on each bar using its `infoObject` settings.
label.new(bar_index, high, infoObject.diff, style = infoObject.lblStyle, 
     color = infoObject.lblColor, textcolor = infoObject.lblColor)

// Highlight the bar that is 10 bars back from the last bar.
bgcolor(bar_index == last_bar_index - 10 ? color.yellow : na)

// On last bar, output table cell to display `LblSettings` object's `lblStyle` and `diff` fields from 10 bars back.
if barstate.islast
    var table t = table.new(position.bottom_right, 1, 1, color.yellow)

    // In v5, you could use history-referencing operator `[]` on UDT fields directly.
    //@variable Text displayed in table cell. Set based on the `lblStyle` and `diff` fields from 10 bars back.
    string txt = "10 bars back: Arrow was "
       +  (infoObject.lblStyle[10] == label.style_arrowdown ? "DOWN" : "UP")
       +  "  by "  +  infoObject.diff[10]
    t.cell(0, 0, txt, text_size = size.large)

```

--------------------------------

### Pine Script Map Iteration Example

Source: https://www.tradingview.com/pine-script-docs/language/loops

This example script demonstrates populating a map with random float values and then iterating through its key-value pairs using a direct `for...in` loop. The script visualizes the map's content using a label on the last historical bar.

```Pine Script
//@version=6
indicator("Looping through map demo")

if barstate.islastconfirmedhistory
    //@variable A map of "string" keys and "float" values to render within a `label`.
    map<string, float> simpleMap = map.new<string, float>()

    //@variable An array of "string" values representing the keys to put into the map. 
    array<string> newKeys = array.from("A", "B", "C", "D", "E")
    // Put key-value pairs into the `simpleMap`. 
    for key in newKeys
        simpleMap.put(key, math.random(1, 20))

    //@variable A "string" representation of the `simpleMap` contents. Modified within a loop. 
    string displayText = "simpleMap content: \n "

    // Loop through each key-value pair within the `simpleMap`. 
    for [key, value] in simpleMap
        // Add a "string" representation of the pair to the `displayText`.
        displayText += key + ": " + str.tostring(value, "#.##") + "\n "
    
    // Draw a `label` showing the `displayText` on the current bar. 
    label.new( 
        x = bar_index, y = 0, text = displayText, color = color.green, textcolor = color.white, 
        size = size.huge, textalign = text.align_left, style = label.style_label_center
   )
```

--------------------------------

### Pine Script: Create Transparent Volume Colors with color.new()

Source: https://www.tradingview.com/pine-script-docs/concepts/colors

This example demonstrates using color.new() to dynamically set the transparency of volume columns based on price action (bull/bear) and a calculated transparency level derived from volume changes. It allows user inputs for base colors and gradient levels.

```Pine Script
//@version=6
indicator("Volume")
// We name our color constants to make them more readable.
var color GOLD_COLOR   = #CCCC00ff
var color VIOLET_COLOR = #AA00FFff
color bullColorInput = input.color(GOLD_COLOR,  "Bull")
color bearColorInput = input.color(VIOLET_COLOR, "Bear")
int levelsInput = input.int(10, "Gradient levels", minval = 1)
// We initialize only once on bar zero with `var`, otherwise the count would reset to zero on each bar.
var float riseFallCnt = 0
// Count the rises/falls, clamping the range to: 1 to `i_levels`.
riseFallCnt := math.max(1, math.min(levelsInput, riseFallCnt + math.sign(volume - nz(volume[1]))))
// Rescale the count on a scale of 80, reverse it and cap transparency to <80 so that colors remains visible.
float transparency = 80 - math.abs(80 * riseFallCnt / levelsInput)
// Build the correct transparency of either the bull or bear color.
color volumeColor = color.new(close > open ? bullColorInput : bearColorInput, transparency)
plot(volume, "Volume", volumeColor, 1, plot.style_columns)
```

--------------------------------

### Pine Script v5 Strategy Order Limit Error Example

Source: https://www.tradingview.com/pine-script-docs/migration-guides/to-pine-version-6

Demonstrates a Pine Script v5 strategy that places numerous orders on each bar, exceeding the 9000 order limit and causing a runtime error. This code is intended to illustrate the behavior in v5.

```Pine Script
//@version=5  
strategy("Strategy order limit demo", overlay=true, pyramiding=5)  

// Place several long orders on every even bar. This reaches the maximum orders limit in v5 and raises a runtime error.  
if bar_index % 2 == 0  
    for i = 1 to 5  
        strategy.entry("Entry " + str.tostring(i), strategy.long, qty = 5)  
// Place short orders on every odd bar.  
else  
    strategy.entry("Short", strategy.short, qty = 25)  

```

--------------------------------

### Pine Script Comparison Operators Examples

Source: https://www.tradingview.com/pine-script-docs/language/operators

Provides examples of using comparison operators in Pine Script. It demonstrates the usage of greater than (>), not equal (!=), and greater than or equal to (>=) operators with numerical values and built-in variables like 'close' and 'open'.

```Pine Script
1 > 2  // false  
1 != 1 // false  
close >= open  // Depends on values of `close` and `open`  

```

--------------------------------

### Pine Script: Array Example - Storing and Displaying Closing Prices

Source: https://www.tradingview.com/pine-script-docs/faq/data-structures

An example of creating and managing an array in Pine Script to store the last five closing prices. It demonstrates using `array.new<float>()`, `array.push()`, and `array.shift()` to maintain the array, and displays its contents in a table on the last bar.

```Pine Script
//@version=6  
indicator("Array example")  
// Declare an array with 5 `na` values on the first bar.  
var array<float> pricesArray = array.new<float>(5)  
// On each bar, add a new value to the end of the array and remove the first (oldest) element.  
array.push(pricesArray, close)  
array.shift(pricesArray)  
// Display the array and its contents in a table.  
var table displayTable = table.new(position.middle_right, 1, 1)  
if barstate.islast  
    table.cell(displayTable, 0, 0, str.tostring(pricesArray), text_color = chart.fg_color)  
```

--------------------------------

### Pine Script: Array Usage Example

Source: https://www.tradingview.com/pine-script-docs/release-notes

Illustrates the use of arrays in Pine Script, showing how to create a float array, populate it with data, and retrieve elements. This feature allows for building custom datasets.

```Pine Script
//@version=4
study("My Script")
a = array.new_float(0)
for i = 0 to 5
    array.push(a, close[i] - open[i])
plot(array.get(a, 4))

```

--------------------------------

### Pine Script Trailing Stop Example

Source: https://www.tradingview.com/pine-script-docs/faq/strategies

A long-only Pine Script example demonstrating the use of strategy.exit() with `trail_points` and `trail_offset` parameters to set a trailing stop. It also includes logic to visualize the trailing stop price and a separate static stop-loss.

```Pine Script
`//@version=6  
strategy("Trailing stop order demo", overlay = true)

string TT_SO = "The trailing stop offset in ticks. Also used as the initial stop loss distance from the entry price."

//@variable The activation level is this number of ticks above the entry price.
int activationOffsetInput = input.int(1000, "Activation Level Offset (in ticks)")
//@variable The trailing stop trails this many ticks below the high price.
int stopOffsetInput = input.int(2000, "Stop Offset (in ticks)", tooltip = TT_SO)

//@variable The price at which the trailing stop activates.
float trailPriceActivationLevel = activationOffsetInput * syminfo.mintick + strategy.position_avg_price
//@variable The price at which the trailing stop itself is located.
var float trailingStop = na

// Calculate a fast and slow Simple Moving Average.
float ma1 = ta.sma(close, 14)
float ma2 = ta.sma(close, 28)

//@variable Is `true` when `ma1` crosses over `ma2` and we are not in a position.
bool longCondition  = ta.crossover(ma1,  ma2) and strategy.position_size == 0
//@variable Is `true` on the bar that a trade exits.
bool  isExitBar = strategy.closedtrades.exit_bar_index(strategy.closedtrades - 1) == bar_index
float exitPrice = strategy.closedtrades.exit_price(strategy.closedtrades - 1)

// Generate a long market order when `longCondition` is `true`.
// Set a static abd trailing stop loss.
if longCondition
    strategy.entry("Long", strategy.long)
    strategy.exit("Stop",
            from_entry  = "Long",
            trail_points = activationOffsetInput,
            trail_offset = stopOffsetInput,
            loss     = stopOffsetInput
            )

// If the high exceeds the activation level, set the `trailingStop` to whichever is higher:
// the current high minus the price equivalent of `stopOffsetInput` or the previous `trailingStop` value.
if high > trailPriceActivationLevel or isExitBar and exitPrice > trailingStop
    trailingStop := math.max(high - stopOffsetInput * syminfo.mintick, nz(trailingStop))

//@variable The price of the active stop price, using the trailing stop when activated, or a static stop loss otherwise.
float stopLevel = na(trailingStop) ? strategy.position_avg_price - stopOffsetInput * syminfo.mintick : trailingStop

// Visualize the movement of the trailing stop and the activation level.
plot(stopLevel,           "Stop Level",     chart.fg_color,  2, plot.style_linebr)
plot(trailPriceActivationLevel, "Activation level", color.aqua, 1, plot.style_linebr)
// Display the two simple moving averages on the chart.
plot(ma1, "MA 1", color.new(color.lime,    60))
plot(ma2, "MA 2", color.new(color.fuchsia, 60))

// Mark the point where the trailing stop is activated with a shape and text.
plotshape(high > trailPriceActivationLevel and na(trailingStop)[1], "Trail Activated", shape.triangledown,
           size = size.small, color = color.aqua, text = "Trailing stop\nactivated", textcolor = color.aqua)

// Set the trailing stop to `na` when not in a position.
if strategy.position_size == 0
    trailingStop := na
`
```

--------------------------------

### Pine Script: Define 24/7 Session

Source: https://www.tradingview.com/pine-script-docs/concepts/sessions

This example demonstrates the standard Pine Script session string for a 24-hour, 7-day trading session, starting at midnight.

```pinescript
"0000-0000:1234567"
```

--------------------------------

### Pine Script Version Declaration

Source: https://www.tradingview.com/pine-script-docs/writing/style-guide

This snippet demonstrates how to declare the Pine Script version for a script. If no version is specified, the script defaults to v1. This example shows the declaration for v6.

```Pine Script
//@version=6  
```

--------------------------------

### Pine Script: Spacing and Ternary Operators

Source: https://www.tradingview.com/pine-script-docs/writing/style-guide

Illustrates the use of spacing around operators and commas in Pine Script, including examples with ternary operators for conditional assignments and basic plotting.

```Pine Script
`int a = close > open ? 1 : -1  
var int newLen = 2  
newLen := min(20, newlen + 1)  
float a = -b  
float c = d > e ? d - e : d  
int index = bar_index % 2 == 0 ? 1 : 2  
plot(close, color = color.red)  
`
```

--------------------------------

### Pine Script: Define User-Defined Functions

Source: https://www.tradingview.com/pine-script-docs/writing/style-guide

Demonstrates how to declare user-defined functions in the global scope in Pine Script. It includes an example of a function that maps user input to built-in size constants and uses it to draw an arrow.

```Pine Script
`
```

--------------------------------

### Strategy.exit() with Parameter Pairs (Pine v6)

Source: https://www.tradingview.com/pine-script-docs/migration-guides/to-pine-version-6

Illustrates the Pine v6 behavior of strategy.exit(), where both relative and absolute parameters are evaluated, and the exit order is placed at the level expected to trigger first. In this example, with profit/loss set to 0, exits occur at the entry price.

```Pine Script
//@version=6
strategy("`strategy.exit()` with parameter pairs demo", overlay = true, margin_long = 100, margin_short = 100)

//@variable The 14-bar Average True Range.
float atr = ta.atr(14)

if bar_index % 28 == 0
    strategy.entry("Buy", strategy.long)
    strategy.exit("Exit", "Buy", profit = 0, limit = close + 2.0 * atr, loss = 0, stop = close - 2.0 * atr)

```

--------------------------------

### Pine Script v5 `for` loop with dynamic boundary

Source: https://www.tradingview.com/pine-script-docs/migration-guides/to-pine-version-6

This Pine Script v5 example demonstrates a `for` loop where the boundary is determined by an array operation (`data.queue(close) - 1`). In v5, this boundary is evaluated only once before the loop starts. The script manages an array of closing prices and counts elements below the `ohlc4` value.

```Pine Script
//@version=5  
indicator("v5 vs v6 `to_num` demo")  
  
//@variable The size of the `data` array.   
int sizeInput = input.int(20, "Size", 1)  
  
//@function Appends a new `value` to `this` array and returns the array's size.   
method queue(array<float> this, float value) =>  
    this.push(value)  
    this.size()  
  
//@function Removes the first value from `this` array if the size equals the `sizeInput`.  
method dequeue(array<float> this) =>  
    if this.size() == sizeInput  
        this.shift()  
  
//@variable An array that holds `sizeInput` recent `close` prices.   
var array<float> data = array.new<float>()  
  
//@variable The number of elements in the `data` array that are below the current bar's `ohlc4`.   
int belowCount = 0  
  
// Remove the oldest element from the `data` array when its size reaches the `sizeInput`.   
data.dequeue()  
  
// Push the bar's `close` into `data` and loop from zero to one less than the array's size.   
// In v5, the loop evaluates the `data.queue()` call *once*, meaning the final counter value is fixed across iterations.  
// In v6, it evaluates the call before *every* iteration, causing the array and loop boundary to expand indefinitely.      
for i = 0 to data.queue(close) - 1  
    // Add 1 to `belowCount` when the `data` element at index `i` is less than the `ohlc4` value.   
    if data.get(i) < ohlc4  
        belowCount += 1  
  
// Plot the `belowCount` in a separate pane.   
plot(belowCount, "Closes below OHLC4", color.blue, 3)
```

--------------------------------

### Pine Script Naming Conventions and Examples

Source: https://www.tradingview.com/pine-script-docs/language/identifiers

Illustrates recommended naming conventions for Pine Script identifiers, such as uppercase SNAKE_CASE for constants and camelCase for variables. Includes examples of constant declarations and a simple function.

```Pine Script
GREEN_COLOR = #4CAF50
MAX_LOOKBACK = 100
int fastLength = 7
// Returns 1 if the argument is `true`, 0 if it is `false` or `na`.
zeroOne(boolValue) => boolValue ? 1 : 0
```

--------------------------------

### Pine Script: Optimized `request.security` with tuple

Source: https://www.tradingview.com/pine-script-docs/writing/profiling-and-optimization

This optimized Pine Script example consolidates nine `request.security()` calls into a single call by using a tuple for the `expression` argument. This approach improves script performance and reduces memory usage.

```Pine Script
//@version=6  
indicator("Minimizing `request.*()` calls demo")  

//@variable The symbol to request data from.  
string symbolInput = input.symbol("BINANCE:BTCUSDT", "Symbol")  

// Request 9 `ta.percentrank()` values from the `symbolInput` context using a single `request.security()` call.  
[reqRank1, reqRank2, reqRank3, reqRank4, reqRank5, reqRank6, reqRank7, reqRank8, reqRank9] =   
 request.security(  
     symbolInput, timeframe.period, [  
             ta.percentrank(close, 10), ta.percentrank(close, 20), ta.percentrank(close, 30),   
             ta.percentrank(close, 40), ta.percentrank(close, 50), ta.percentrank(close, 60),   
             ta.percentrank(close, 70), ta.percentrank(close, 80), ta.percentrank(close, 90)  
         ]  
 )  

// Plot the `reqRank*` values.  
plot(reqRank1)  
plot(reqRank2)  
plot(reqRank3)  
plot(reqRank4)  
plot(reqRank5)  
plot(reqRank6)  
plot(reqRank7)  
plot(reqRank8)  
plot(reqRank9)  
```

--------------------------------

### Pine Script Logging Example

Source: https://www.tradingview.com/pine-script-docs/writing/debugging

This snippet demonstrates how to use various logging functions in Pine Script. It includes examples of logging information, warnings, and errors, which can be filtered in the Pine Logs pane. The code highlights the importance of filtering logs for efficient analysis.

```Pine Script
//@version=5

indicator("Log Example", overlay=true)

var float open_price = na

if barstate.isfirst
    log.info("Script started")

if barstate.isrealtime and barstate.isnew
    log.warning("Real-time tick detected")

if close > open_price
    log.error("Price increased")
else if close < open_price
    log.info("Price decreased or stayed the same")

open_price := open
```

--------------------------------

### Full Script Profiling Example

Source: https://www.tradingview.com/pine-script-docs/writing/profiling-and-optimization

A Pine Script example demonstrating a full script that calculates pseudorandom series and their average. The code includes a user-defined type, a method for generating values, and conditional logic to update series, showcasing a typical script structure that the Profiler would analyze.

```Pine Script
//@version=6  
indicator("Profiler's workings demo")  

int seedInput = input.int(12345, "Seed")  

type LCG
    float state

method generate(LCG this, int generations = 1) =>
    float result = 0.0
    for i = 1 to generations
        this.state := 16807 * this.state % 2147483647
        result += this.state / 2147483647
    result / generations

var lcg = LCG.new(seedInput)

var float val0 = 1.0
var float val1 = 1.0
var float val2 = 1.0

if lcg.generate(10) < 0.5
    val0 *= 1.0 + (2.0 * lcg.generate(50) - 1.0) * 0.1
else if lcg.generate(10) < 0.5
    val1 *= 1.0 + (2.0 * lcg.generate(50) - 1.0) * 0.1
else if lcg.generate(10) < 0.5
    val2 *= 1.0 + (2.0 * lcg.generate(50) - 1.0) * 0.1

plot(math.avg(val0, val1, val2), "Average pseudorandom result", color.purple)

```

--------------------------------

### Pine Script Variable Declarations Examples

Source: https://www.tradingview.com/pine-script-docs/language/variable-declarations

Demonstrates various valid variable declarations in Pine Script, including basic assignments, type inference, using 'var' and 'varip', and tuple assignments from function calls.

```Pine Script
BULL_COLOR = color.lime  
i = 1  
len = input(20, "Length")  
float f = 10.5  
closeRoundedToTick = math.round_to_mintick(close)  
sma = ta.sma(close, 14)  
var barRange = float(na)  
var firstBarOpen = open  
varip float lastClose = na  
[macdLine, signalLine, histLine] = ta.macd(close, 12, 26, 9)  
plotColor = if close > open  
	    color.green  
else  
	    color.red  

```

--------------------------------

### Pine Script Strategy Information Demo

Source: https://www.tradingview.com/pine-script-docs/concepts/strategies

This Pine Script® example demonstrates how to use various `strategy.*` variables to access and display strategy performance data. It includes logic for order entry and exit based on custom conditions and creates a table to show key metrics like net profit, win percentage, and profit factor. The script also plots the strategy's equity and highlights the background based on open profit.

```Pine Script®
//@version=6  
strategy(  
    "Using strategy information demo", default_qty_type = strategy.percent_of_equity, default_qty_value = 5,  
    margin_long = 100, margin_short = 100  
)

//@variable The number of bars in the `rank` calculation.  
int lengthInput = input.int(50, "Length", 1)  
//@variable The stop-loss percentage.  
float slPercentInput = input.float(4.0, "SL %", 0.0, 100.0) / 100.0  

//@variable The percent rank of `close` prices over `lengthInput` bars.  
float rank = ta.percentrank(close, lengthInput)  
// Entry and exit signals.    
bool entrySignal = ta.crossover(rank, 10) and strategy.opentrades == 0  
bool exitSignal   = ta.crossover(rank, 80) and strategy.opentrades == 1  

// Place orders based on the `entrySignal` and `exitSignal` occurrences.  
switch  
    entrySignal       => strategy.entry("Buy", strategy.long)  
    entrySignal[1]    => strategy.exit("SL", "Buy", stop = strategy.position_avg_price * (1.0 - slPercentInput))  
    exitSignal        => strategy.close("Buy")  

if barstate.islastconfirmedhistory or barstate.isrealtime  
    //@variable A table displaying strategy information on the main chart pane.  
    var table dashboard = table.new(  
         position.top_right, 2, 10, border_color = chart.fg_color, border_width = 1, force_overlay = true  
    )
    //@variable The strategy's currency.  
    string currency = strategy.account_currency  
    // Display the net profit as a currency amount and percentage.  
    dashboard.cell(0, 1, "Net P/L")  
    dashboard.cell(  
         1, 1, str.format("{0, number, 0.00} {1} ({2}%)", strategy.netprofit, currency, strategy.netprofit_percent),  
         text_color = chart.fg_color, bgcolor = strategy.netprofit > 0 ? color.lime : color.red  
    )
    // Display the number of winning trades as an absolute value and percentage of all completed trades.  

```

--------------------------------

### Pine Script v4: Explicit Float Declaration Example

Source: https://www.tradingview.com/pine-script-docs/migration-guides/to-pine-version-4

Demonstrates the explicit declaration of a float variable in Pine Script v4, which is now mandatory when initializing with 'na'. This example shows how to declare a float variable 'src' and assign values based on the closing price relative to the opening price.

```Pine Script
//@version=4  
study("Green Candle Close")  
// We expect `src` to hold float values, so we declare in with the `float` keyword  
float src = na  
if close > open  
    src := close  
plot(src)   
```

--------------------------------

### Correctly Get Trading Day using time_tradingday in Pine Script

Source: https://www.tradingview.com/pine-script-docs/faq/times-dates-and-sessions

This example shows the recommended method to accurately get the trading day for any symbol, including those with overnight sessions. It utilizes the `time_tradingday` variable, which provides the timestamp for the start of the trading day (00:00 UTC). This timestamp is then passed to the `dayofmonth()` function with the "UTC" timezone to ensure correct date extraction, regardless of the bar's actual opening time.

```Pine Script
//@version=6  
indicator("Day number", overlay = true)  
currTradingDay = dayofmonth(time_tradingday, "UTC")  
labelStr = "`time_tradingday`: " + str.format_time(time_tradingday, "dd MMM HH:mm 'UTC'", "UTC")  
labelStr += "\n`dayofmonth(time_tradingday)`: " + str.tostring(currTradingDay)  
label.new(bar_index, high, labelStr)  

```

--------------------------------

### Pine Script v4 to v5: Removed Functions and Variables

Source: https://www.tradingview.com/pine-script-docs/migration-guides/to-pine-version-5

Lists common Pine Script functions and variables removed in v5, providing their v5 replacements, such as `input.bool()` replacing `input.bool`.

```Pine Script
input.bool // Replaced by input.bool()
input.color // Replaced by input.color()
input.float // Replaced by input.float()
input.integer // Replaced by input.int()
input.resolution // Replaced by input.timeframe()
input.session // Replaced by input.session()
input.source // Replaced by input.source()
input.string // Replaced by input.string()
input.symbol // Replaced by input.symbol()
input.time // Replaced by input.time()
iff() // Use the ?: operator instead
offset() // Use the [] operator instead
```

--------------------------------

### Pine Script: Define 24/7 Session (Shorthand)

Source: https://www.tradingview.com/pine-script-docs/concepts/sessions

This example shows the shorthand Pine Script session string '24x7' which is equivalent to a 24-hour, 7-day session starting at midnight.

```pinescript
"24x7"
```

--------------------------------

### Pine Script v5: Plotting with 'transp' parameter

Source: https://www.tradingview.com/pine-script-docs/migration-guides/to-pine-version-6

Example of using the 'transp' parameter in Pine Script v5 to set the transparency of a plot. This parameter is deprecated in v5 and removed in v6.

```Pine Script
//@version=5  
indicator("Transparency demo v5")  
  
color myColor = close > open ? color.green : color.red  
plot(close, color = myColor, transp = 80)  
```

--------------------------------

### Pine Script Strategy Alert Message Example

Source: https://www.tradingview.com/pine-script-docs/concepts/strategies

This Pine Script example demonstrates how to set a default alert message for strategy order fills using the //@strategy_alert_message compiler annotation. It includes placeholders for trade action, position size, ticker, and price.

```Pine Script
`//@version=6  
//@strategy_alert_message {{strategy.order.action}} {{strategy.position_size}} {{ticker}} @ {{strategy.order.price}}  
strategy("Alert Message Demo", overlay = true)
float fastMa = ta.sma(close, 5)  
float slowMa = ta.sma(close, 10)  

if ta.crossover(fastMa, slowMa)  
    strategy.entry("buy", strategy.long)  

if ta.crossunder(fastMa, slowMa)  
    strategy.entry("sell", strategy.short)  

plot(fastMa, "Fast MA", color.aqua)
plot(slowMa, "Slow MA", color.orange)  
`
```

--------------------------------

### Pine Script All-Time High/Low Library Example

Source: https://www.tradingview.com/pine-script-docs/concepts/libraries

An example of a Pine Script library that calculates the all-time high and low of a given series. It includes two exported functions, 'hi' and 'lo', with descriptions and parameter details.

```Pine Script
//@version=6  
  
//  @description Provides functions calculating the all-time high/low of values.  
library("AllTimeHighLow", true)  
  
//  @function Calculates the all-time high of a series.  
//  @param val Series to use (`high` is used if no argument is supplied).  
//  @returns The all-time high for the series.  
export hi(float val = high) =>  
    var float ath = val  
    ath := math.max(ath, val)  
  
//  @function Calculates the all-time low of a series.  
//  @param val Series to use (`low` is used if no argument is supplied).  
//  @returns The all-time low for the series.  
export lo(float val = low) =>  
    var float atl = val  
    atl := math.min(atl, val)  
  
plot(hi())  
plot(lo())  
```

--------------------------------

### Pine Script Comments

Source: https://www.tradingview.com/pine-script-docs/language/script-structure

Demonstrates the use of single-line comments in Pine Script. Comments can start anywhere on a line or follow existing code.

```Pine Script
//\/\/version=6  
indicator("")  
// This line is a comment  
a = close // This is also a comment  
plot(a) 

```

--------------------------------

### Pine Script: Grouping Inputs with ASCII Separators

Source: https://www.tradingview.com/pine-script-docs/faq/techniques

Demonstrates organizing inputs into groups using string constants for group headers and ASCII characters to create visual boundaries. This example shows how to use the `inline` parameter for related inputs within a group.

```Pine Script
//@version=6
indicator("Inputs", overlay = true)

// Defining options strings improves script readability.
// It also enables the creation of boolean variables by comparing these constants with user input strings in a single line of code.
string EQ1 = "On"
string EQ2 = "Off"

// The `GRP*` strings used for group headers demonstrate using ASCII characters to create a visual boundary,
// making it easier for users to differentiate between different sections in the menu.

// Group 1 demonstrates inline inputs that do not align vertically in the menu.
string GRP1 = "════════════ Settings ═════════════" // ASCII 205
float  ao1SrcInput       = input.source(close, "AO source",       inline = "11", group = GRP1)
int    ao1LenInput       = input.int(14,           "Length",          inline = "11", group = GRP1)
float  long1SrcInput     = input.source(close, "Signal source", inline = "12", group = GRP1)
int    long1LenInput     = input.int(3,            "Length",          inline = "12", group = GRP1)

// In Group 2, the title of `ao2SrcInput` is padded with three Unicode EN spaces (U+2002) to compensate for the misalignment.
string GRP2               = "──────────── Settings ────────────" // ASCII 196
float  ao2SrcInput       = input.source(close, "AO source   ",  inline = "21", group = GRP2)
int    ao2LenInput       = input.int(14,           "Length",          inline = "21", group = GRP2)
float  long2SrcInput     = input.source(close, "Signal source", inline = "22", group = GRP2)
int    long2LenInput     = input.int(3,            "Length",          inline = "22", group = GRP2)

// This configuration uses Unicode white space characters to indent input sub-sections. We use Em space ( ): 8195 (0x2003).
string GRP3               = "————————————— Settings ———————————————" // ASCII 151 (Em dash)
float  level1Input       = input.float(65.,        "First level",               group = GRP3)
float  level2Input       = input.float(65.,        "  Second Level",            group = GRP3)
bool   level3Input       = input.string(EQ1,       "    Checkbox equivalent", group = GRP3, options = [EQ1, EQ2]) == EQ1
float  level4Input       = input.float(65.,        "Widest Legend            ", group = GRP3)

// These options demonstrate the use of the `inline` parameter to create structured blocks of inputs that are relevant to one another.
string GRP4 = "------------------------ Settings ----------------------------" // ASCII 45 (dash)
bool   showMa1Input     = input(true,           "MA №1", inline = "1", group = GRP4)
string ma1TypeInput     = input.string("SMA", "",       inline = "1", group = GRP4, options = ["SMA", "EMA", "SMMA (RMA)", "WMA", "VWMA"])
float  ma1SourceInput   = input(close,          "",       inline = "1", group = GRP4)
int    ma1LengthInput   = input.int(20,           "",       inline = "1", group = GRP4, minval = 1)
color  ma1ColorInput    = input(#f6c309,         "",       inline = "1", group = GRP4)
```

--------------------------------

### Pine Script: Define Overnight Session

Source: https://www.tradingview.com/pine-script-docs/concepts/sessions

This example illustrates an overnight session in Pine Script, starting at 20:00 and ending at 16:30 the next day, applicable all week.

```pinescript
"2000-1630:1234567"
```

--------------------------------

### Pine Script Non-Word Boundary Assertion \B

Source: https://www.tradingview.com/pine-script-docs/concepts/strings

Illustrates the \B assertion, which matches a non-word boundary (any point that is not the start or end of a word character sequence). The example matches 'abc' only if it's not at the start of a word.

```Pine Script
regex.test("\\Babc", "wordabc")
```

--------------------------------

### Pine Script Modulo Operator Example

Source: https://www.tradingview.com/pine-script-docs/language/operators

Illustrates the modulo operator (%) in Pine Script by defining and plotting a custom modulo function. This example helps visualize how the modulo operation is calculated, especially with negative numbers.

```Pine Script
//@version=6  
indicator("Modulo function")  
modulo(series int a, series int b) =>  
    a - b * math.floor(nz(a/b))  
plot(modulo(-1, 100))  

```

--------------------------------

### Pine Script: Iterating Through Arrays with for Loop

Source: https://www.tradingview.com/pine-script-docs/language/loops

This example shows how to use a for loop to iterate through an array in Pine Script. It accesses elements by their index, demonstrating the use of `array.get()` and handling array indexing which starts from 0.

```Pine Script
int lastIndex = array.size(myArray) - 1  
for i = 0 to lastIndex  
   element = array.get(i)
```

--------------------------------

### Pine Script: Visualize Data with Drawings and Labels

Source: https://www.tradingview.com/pine-script-docs/writing/debugging

Illustrates using Pine Script drawings, specifically lines and labels, to visualize data on the chart. This example draws a line and a label to mark the closing price of the previous daily bar.

```Pine Script
//@version=6  
indicator("Common debug outputs - Pine drawings", overlay = true)  

//@variable Is `true` when a new bar opens on the "1D" timeframe.  
bool newDailyBar = timeframe.change("1D")  
//@variable The previous bar's `bar_index` from when `newDailyBar` last occurred.  
int closedIndex = ta.valuewhen(newDailyBar, bar_index - 1, 0)  
//@variable The previous bar's `close` from when `newDailyBar` last occurred.  
float closedPrice = ta.valuewhen(newDailyBar, close[1], 0)  

if newDailyBar  
		// Draw a line from the previous `closedIndex` and `closedPrice` to the current values.  
		line.new(closedIndex[1], closedPrice[1], closedIndex, closedPrice, width = 2)  
		//@variable A string containing debug information to display in a label.  
		string debugText = "'1D'  bar closed at: 
(" + str.tostring(closedIndex) + ", " + str.tostring(closedPrice) + ")"  
		//@variable Draws a label at the current `closedIndex` and `closedPrice`.  
		label debugLabel = label.new(closedIndex, closedPrice, debugText, color = color.purple, textcolor = color.white)  
```

--------------------------------

### Pine Script® Input Alignment Example

Source: https://www.tradingview.com/pine-script-docs/concepts/inputs

Demonstrates how to align input widgets vertically in Pine Script® using the `inline` and `group` parameters, and how to use Unicode spaces for precise label alignment.

```Pine Script®
`//@version=6  
indicator("Aligned inputs", "", true)  
 
var GRP1 = "Not aligned"  
ma1SourceInput    = input(close, "MA source",     inline = "11", group = GRP1)  
ma1LengthInput   = input(close, "Length",       inline = "11", group = GRP1)  
long1SourceInput = input(close, "Signal source", inline = "12", group = GRP1)  
long1LengthInput = input(close, "Length",       inline = "12", group = GRP1)  
 
var GRP2 = "Aligned"  
// The three spaces after "MA source" are Unicode EN spaces (U+2002).  
ma2SourceInput    = input(close, "MA source   ", inline = "21", group = GRP2)  
ma2LengthInput   = input(close, "Length",       inline = "21", group = GRP2)  
long2SourceInput = input(close, "Signal source", inline = "22", group = GRP2)  
long2LengthInput = input(close, "Length",       inline = "22", group = GRP2)  
 
plot(ta.vwma(close, 10))  

```

--------------------------------

### Pine Script Deep Copy Map Example

Source: https://www.tradingview.com/pine-script-docs/language/maps

This Pine Script code demonstrates how to create a deep copy of a map containing labels. It defines a `deepCopy` method that iterates through the original map, creates a copy of each label value, and populates a new map with these copied values. The example then shows the difference in behavior between a shallow copy and a deep copy when modifying the referenced label objects.

```Pine Script
//@version=6
indicator("Deep copy demo")

//@function Returns a deep copy of `this` map.
method deepCopy(map<string, label> this) =>
    //@variable A deep copy of `this` map.
    result = map.new<string, label>()
    // Add key-value pairs with copies of each `value` to the `result`.
    for [key, value] in this
        result.put(key, value.copy())
    result //Return the `result`.

//@variable A map containing `string` keys and `label` values.
var original = map.new<string, label>()

if bar_index == last_bar_index - 1
    // Put a new key-value pair into the `original` map.
    map.put(
        original, "Test",
        label.new(bar_index, 0, "Original", textcolor = color.white, size = size.huge)
     )

    //@variable A shallow copy of the `original` map.
    map<string, label> shallow = original.copy()
    //@variable A deep copy of the `original` map.
    map<string, label> deep = original.deepCopy()

    //@variable The "Test" label from the `shallow` copy.
    label shallowLabel = shallow.get("Test")
    //@variable The "Test" label from the `deep` copy.
    label deepLabel = deep.get("Test")

    // Modify the "Test" label's `y` attribute in the `original` map.
    // This also affects the `shallowLabel`.
    original.get("Test").set_y(label.all.size())

    // Modify the `shallowLabel`. Also modifies the "Test" label in the `original` map.
    shallowLabel.set_text("Shallow copy")
    shallowLabel.set_color(color.red)
    shallowLabel.set_style(label.style_label_up)

    // Modify the `deepLabel`. Does not modify any other label instance.
    deepLabel.set_text("Deep copy")
    deepLabel.set_color(color.navy)
    deepLabel.set_style(label.style_label_left)
    deepLabel.set_x(bar_index + 5)

```

--------------------------------

### Pine Script Matrix Addition and Transpose Example

Source: https://www.tradingview.com/pine-script-docs/faq/data-structures

Demonstrates creating a 3x3 matrix, calculating its transpose, and summing the two matrices. The results are displayed in a table on the chart.

```Pine Script
//@version=6  
indicator("Matrix sum example")  

//@variable An empty matrix of type "float".  
m = matrix.new<float>()  

// Add rows to the matrix containing data.  
m.add_row(0, array.from(1, 2, 3))  
m.add_row(1, array.from(0, 4, 2))  
m.add_row(2, array.from(3, 1, 2))  

var table displayTable = table.new(position.middle_right, 5, 2)  
if barstate.islast  
    matrix<float> t = m.transpose()  
    table.cell(displayTable, 0, 0, "A",                text_color = chart.fg_color)  
    table.cell(displayTable, 0, 1, str.tostring(m),             text_color = chart.fg_color)  
    table.cell(displayTable, 1, 1, "+",                text_color = chart.fg_color)  
    table.cell(displayTable, 2, 0, "A⁻",                text_color = chart.fg_color)  
    table.cell(displayTable, 2, 1, str.tostring(t),             text_color = chart.fg_color)  
    table.cell(displayTable, 3, 1, "=",                text_color = chart.fg_color)  
    table.cell(displayTable, 4, 0, "A + A⁻",             text_color = color.green)  
    table.cell(displayTable, 4, 1, str.tostring(matrix.sum(m, t)), text_color = color.green)  

```

--------------------------------

### Pine Script Word Boundary Assertion \b

Source: https://www.tradingview.com/pine-script-docs/concepts/strings

Demonstrates the \b assertion, which matches a word boundary (the point before or after a word character sequence). The example matches 'abc' only if it starts a word.

```Pine Script
regex.test("\\babc", "abc word")
```

--------------------------------

### Create Basic Line with chart.point

Source: https://www.tradingview.com/pine-script-docs/concepts/lines-and-boxes

Demonstrates drawing a basic line using the `line.new()` function with `chart.point` objects for start and end points. The line connects the open and close prices of each bar with a specified width.

```Pine Script®
//@version=6  
indicator("Creating lines demo", overlay = true)

//@variable The `chart.point` for the start of the line. Contains `index` and `time` information.
firstPoint = chart.point.now(open)
//@variable The `chart.point` for the end of the line. Contains `index` and `time` information.
secondPoint = chart.point.now(close)

// Draw a basic line with a `width` of 5 connecting the `firstPoint` to the `secondPoint`.
// This line uses the `index` field from each point for its x-coordinates.
line.new(firstPoint, secondPoint, width = 5)

// Color the background on the unconfirmed bar.
bgcolor(barstate.isconfirmed ? na : color.new(color.orange, 70), title = "Unconfirmed bar highlight")
```

--------------------------------

### Pine Script: Strategy Alert Message Example

Source: https://www.tradingview.com/pine-script-docs/release-notes

Example of how to set a default alert message for a strategy using the //@strategy_alert_message annotation in Pine Script. This annotation allows users to pre-define the alert message that will appear in the 'Create Alert' window.

```Pine Script
//\t@version=5  
//\t@strategy_alert_message	My	Default	Alert	Message  
strategy("My	Strategy")  
plot(close)  

```

--------------------------------

### Pine Script: Single Alert Demo with State Control

Source: https://www.tradingview.com/pine-script-docs/faq/alerts

This Pine Script example demonstrates how to trigger alerts only on the first instance of a bullish or bearish state change. It uses state tracking with the `var` keyword to manage transitions and plots markers to indicate signal occurrences, differentiating between initial alerts and subsequent signals within a state.

```Pine Script
//@version=6  
indicator("Single alert demo", overlay = true)  
 
// —————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
```

--------------------------------

### Pine Script strategy.exit() with from_entry

Source: https://www.tradingview.com/pine-script-docs/concepts/strategies

This Pine Script code demonstrates the `strategy.exit()` function with the `from_entry` argument. It shows how to place entry orders and then use a single `strategy.exit()` call to manage exits only for entries with a specific ID created before or on the bar of the exit call. The script also includes visual indicators for entry start, exit call, and entry end times, along with highlighting and tracking the lowest entry price.

```Pine Script
`//@version=6  
strategy("Exit persist demo", overlay = true, margin_long = 100, margin_short = 100, pyramiding = 100)  
 
//@variable The time when order creation starts.  
int entryStartTime = input.time(0, "Start time for entries", confirm = true)  
//@variable The time when the `strategy.exit()` call occurs.  
int exitCallTime = input.time(0, "Exit call time", confirm = true)  
//@variable The time when order creation stops.  
int entryEndTime = input.time(0, "End time for entries", confirm = true)  
 
// Raise a runtime error if incorrect timestamps are chosen.  
if exitCallTime <= entryStartTime or entryEndTime <= exitCallTime or entryEndTime <= entryStartTime  
     runtime.error("The input timestamps must follow this condition: entryStartTime < exitCallTime < entryEndTime.")  
 
// Create variables to track entry and exit conditions.  
bool entriesStart = time == entryStartTime  
bool callExit    = time == exitCallTime  
bool entriesEnd  = time == entryEndTime  
bool callEntry   = time >= entryStartTime and time < entryEndTime  
 
// Place a long entry order when `callEntry` is `true`.  
if callEntry      strategy.entry("Entry", strategy.long)  
 
// Call `strategy.exit()` when `callExit` is `true`, which occurs only once.  
// This single call only places exit orders for all entries with the "Entry" ID created before or on the bar where  
// `callExit` occurs. It DOES NOT affect any subsequent entries created after that bar.  
if callExit      strategy.exit("Exit", from_entry = "Entry", loss = 0)  
 
// Draw labels to signify when entries start, when the `strategy.exit()` call occurs, and when order placement stops.  
switch    entriesStart => label.new(    bar_index, high, "Start placing entry orders.", color = color.green, textcolor = color.white,    style = label.style_label_lower_right, size = size.large    )      callExit => label.new(    bar_index, high, "Call `strategy.exit()` once.", color = color.blue, textcolor = color.white,    style = label.style_label_lower_right, size = size.large    )      entriesEnd => label.new(    bar_index, high, "Stop placing orders.", color = color.red, textcolor = color.white,    style = label.style_label_lower_left, size = size.large    )  
 
// Create a line and label to visualize the lowest entry price, i.e., the price required to close the position.  
var line lowestLine = line.new(    entryStartTime + 1000, na, entryEndTime, na, xloc.bar_time, extend.right, color.orange, width = 2    )  
var lowestLabel = label.new(    entryStartTime + 1000, na, "Lowest entry price", color = color.orange,    style = label.style_label_upper_right, xloc = xloc.bar_time    )  
 
// Update the price values of the `lowestLine` and `lowestLabel` after each new entry.  
if callEntry[1]      var float lowestPrice = strategy.opentrades.entry_price(0)      float entryPrice = strategy.opentrades.entry_price(strategy.opentrades - 1)      if not na(entryPrice)          lowestPrice := math.min(lowestPrice, entryPrice)          lowestLine.set_y1(lowestPrice)          lowestLine.set_y2(lowestPrice)          lowestLabel.set_y(lowestPrice)  
 
// Highlight the background when `entriesStart`, `callExit`, and `entriesEnd` occurs.  
bgcolor(entriesStart ? color.new(color.green, 80) : na, title = "Entries start highlight")  
bgcolor(callExit ? color.new(color.blue, 80) : na, title = "Exit call highlight")  
bgcolor(entriesEnd ? color.new(color.red, 80) : na, title = "Entries end highlight")  
`
```

--------------------------------

### Pine Script: Define Overnight Weekday Session

Source: https://www.tradingview.com/pine-script-docs/concepts/sessions

This example shows an overnight session in Pine Script that starts Sunday at 17:00 and ends Monday at 17:00, applying Monday through Friday.

```pinescript
"1700-1700:23456"
```

--------------------------------

### Pine Script v4 vs v5: Time Function Parameter

Source: https://www.tradingview.com/pine-script-docs/migration-guides/to-pine-version-5

Demonstrates the change in the `time` function's parameter from `resolution` in v4 to `timeframe` in v5. It also shows the valid syntax for both versions and a universally compatible call.

```Pine Script
// Valid in v4. Not valid in v5.  
timev4 = time(resolution = "1D")  
// Valid in v5.  
timev5 = time(timeframe = "1D")  
// Valid in v4 and v5.  
timeBoth = time("1D")  
```

--------------------------------

### Pine Script: Rising Function Behavior

Source: https://www.tradingview.com/pine-script-docs/release-notes

Explains the updated behavior of the `rising()` function in Pine Script. The example shows how `rising(close, 3)` is now calculated based on a sequence of decreasing values.

```Pine Script
close[0] > close[1] and close[1] > close[2] and close[2] > close[3]  

```

--------------------------------

### Plot RSI and Median with Compound Conditions and Background Coloring

Source: https://www.tradingview.com/pine-script-docs/writing/debugging

This example demonstrates plotting RSI and its median, and coloring the background based on a compound condition. It calculates five individual conditions and combines them into a single compound condition to control the background color using bgcolor().

```Pine Script®
//@version=6  
indicator("Plotting and coloring compound conditions demo")  

//@variable The length of the RSI and median RSI calculations.  
int lengthInput = input.int(14, "Length", 2)  

//@variable The RSI of `close` with a smoothing factor defined by `lengthInput`.  
float rsi = ta.rsi(close, lengthInput)  
//@variable The median of the `rsi` over `lengthInput` bars.  
float median = ta.median(rsi, lengthInput)  

//@variable Condition #1: Is `true` when the 1-bar `rsi` change switches from 1 to -1.  
bool changeNegative = ta.change(math.sign(ta.change(rsi))) == -2  
```

--------------------------------

### Pine Script Demo for Repetitive Profiling

Source: https://www.tradingview.com/pine-script-docs/writing/profiling-and-optimization

This Pine Script example demonstrates repetitive profiling by using a dummy input to restart the script. It generates pseudorandom values, calculates their average, and plots it. Changing the dummy input's value restarts the script, allowing for performance analysis across different runs.

```Pine Script
`//@version=6  
indicator("Repetitive profiling demo")  
  
//@variable An input not connected to script calculations. Changing its value in the "Inputs" tab restarts the script.  
int dummyInput = input.int(0, "Dummy input")  
  
//@variable An array of pseudorandom values.  
var array<float> randValues = array.new<float>(2500, 0.0)  
  
// Push a new `math.random()` value with a fixed `seed` into the `randValues` array and remove the oldest value.  
array.push(randValues, math.random(seed = 12345))
array.shift(randValues)  
  
// Plot the average of all elements in the `randValues` array.  
plot(array.avg(randValues), "Pseudorandom average")  
`
```

--------------------------------

### Pine Script Regex Search Example

Source: https://www.tradingview.com/pine-script-docs/writing/debugging

Demonstrates a Pine Script regex search query to find logs containing 'average:' followed by a number between 0.5 and 1.0. This showcases advanced pattern matching capabilities.

```Pine Script
search("average: [0.5-1.0]")
```

--------------------------------

### Pine Script v4 to v5: Technical Analysis Functions Renamed to 'ta' Namespace

Source: https://www.tradingview.com/pine-script-docs/migration-guides/to-pine-version-5

Lists technical analysis functions and variables in Pine Script that have been moved to the `ta.` namespace in v5, including examples like `atr()` becoming `ta.atr()` and `rsi(x, y)` becoming `ta.rsi(source, length)`.

```Pine Script
accdist // Renamed to ta.accdist
alma() // Renamed to ta.alma()
 atr() // Renamed to ta.atr()
bb() // Renamed to ta.bb()
bbw() // Renamed to ta.bbw()
cci() // Renamed to ta.cci()
cmo() // Renamed to ta.cmo()
cog() // Renamed to ta.cog()
dmi() // Renamed to ta.dmi()
ema() // Renamed to ta.ema()
hma() // Renamed to ta.hma()
iii // Renamed to ta.iii
kc() // Renamed to ta.kc()
kcw() // Renamed to ta.kcw()
linreg() // Renamed to ta.linreg()
macd() // Renamed to ta.macd()
mfi() // Renamed to ta.mfi()
mom() // Renamed to ta.mom()
nvi // Renamed to ta.nvi
obv // Renamed to ta.obv
pvi // Renamed to ta.pvi
pvt // Renamed to ta.pvt
rma() // Renamed to ta.rma()
roc() // Renamed to ta.roc()
rsi(x, y) // Renamed to ta.rsi(source, length)
sar() // Renamed to ta.sar()
sma() // Renamed to ta.sma()
stoch() // Renamed to ta.stoch()
supertrend() // Renamed to ta.supertrend()
swma(x) // Renamed to ta.swma(source)
tr // Renamed to ta.tr
tr() // Renamed to ta.tr()
tsi() // Renamed to ta.tsi()
vwap // Renamed to ta.vwap
vwap(x) // Renamed to ta.vwap(source)
vwma() // Renamed to ta.vwma()
wad // Renamed to ta.wad
wma() // Renamed to ta.wma()
wpr() // Renamed to ta.wpr()
wvad // Renamed to ta.wvad
```

--------------------------------

### Pine Script Bar Magnifier Demo Strategy

Source: https://www.tradingview.com/pine-script-docs/concepts/strategies

This Pine Script demonstrates the Bar Magnifier feature. It sets up buy and exit limit orders based on a threshold time and calculated prices. The script visualizes the order prices with lines and colors the background when orders are placed. It highlights how the Bar Magnifier can enable both entry and exit orders on the same bar by using lower timeframe data.

```Pine Script
//@version=6  
strategy("Bar Magnifier Demo", overlay = true, use_bar_magnifier = false)

//@variable The UNIX timestamp on or after which place the order.
int orderTime = input.time(timestamp("08 April 2024 00:00"), "Threshold time")

//@variable Is `color.orange` when `time` crosses the `orderTime`; false otherwise.
color orderColor = na

// Entry and exit prices.
float entryPrice = hl2 - (high - low)
float exitPrice  = entryPrice + (high - low) * 0.25

// Entry and exit lines.
var line entryLine = na
var line exitLine  = na

// Place orders when the bar open time equals or exceeds the threshold time for the first time.
if time[1] < orderTime and time >= orderTime
    // Draw new entry and exit lines.
    entryLine := line.new(bar_index, entryPrice, bar_index + 1, entryPrice, color = color.green, width = 2)
    exitLine  := line.new(bar_index, exitPrice, bar_index + 1, exitPrice, color = color.red, width = 2)

    // Update order highlight color.
    orderColor := color.new(color.orange, 80)

    // Place limit orders at the `entryPrice` and `exitPrice`.
    strategy.entry("Buy", strategy.long, limit = entryPrice)
    strategy.exit("Exit", "Buy", limit = exitPrice)

// Update lines while the position is open.
else if strategy.position_size > 0.0
    entryLine.set_x2(bar_index + 1)
    exitLine.set_x2(bar_index + 1)

bgcolor(orderColor)

```

--------------------------------

### Pine Script Strategy with Default Order Size

Source: https://www.tradingview.com/pine-script-docs/concepts/strategies

This example demonstrates setting a default order size for a Pine Script strategy using `default_qty_type` and `default_qty_value`. It also shows how to enter long or short positions with specific quantities using `strategy.entry()`.

```Pine Script
//@version=6
strategy("Buy low, sell high", overlay = true, default_qty_type = strategy.cash, default_qty_value = 5000)

int   length      = input.int(20, "Length", 1)
float longAmount  = input.float(4.0, "Long Amount", 0.0)
float shortAmount = input.float(2.0, "Short Amount", 0.0)

float highest = ta.highest(length)
float lowest  = ta.lowest(length)

switch
    low == lowest   => strategy.entry("Buy", strategy.long, longAmount)
    high == highest => strategy.entry("Sell", strategy.short, shortAmount)

```

--------------------------------

### Implement Multiple Take-Profit Levels with strategy.exit()

Source: https://www.tradingview.com/pine-script-docs/faq/strategies

This example shows how to use multiple `strategy.exit()` calls to implement scaled exits with distinct stop-loss and take-profit levels. Each `strategy.exit()` call can define a separate bracket order, allowing for incremental profit-taking. The example uses persistent global variables to store and plot the exit levels.

```Pine Script
//@version=6  
strategy("Multiple exit demo", overlay = true)  

int exitPercentInput = input.int(1, "Exit %", minval = 1, maxval = 99)  
float exitPercent = exitPercentInput / 100  

//@variable Is `true` on every 100th bar.  
bool buyCondition = bar_index % 100 == 0  

var float stopLoss1 = na, var float takeProfit1 = na  // Exit levels for `Exit1`  
var float stopLoss2 = na, var float takeProfit2 = na  // Exit levels for `Exit2`  

// Place orders when `buyCondition` is true and we are not in a position.  
if buyCondition and strategy.position_size == 0.0  
    stopLoss1 := close * (1 - exitPercent), takeProfit1 := close * (1 + exitPercent)  // Update the levels based on the current price  
    stopLoss2 := close * (1 - (2 * exitPercent)), takeProfit2 := close * (1 + (2 * exitPercent))  
    strategy.entry("Buy", strategy.long, qty = 2)  
    strategy.exit("Exit1", "Buy", stop = stopLoss1, limit = takeProfit1, qty_percent = 50)  
    strategy.exit("Exit2", "Buy", stop = stopLoss2, limit = takeProfit2)  

// Set `stopLoss1` and `takeProfit1` to `na` when price touches either.  
if low <= stopLoss1 or high >= takeProfit1  
    stopLoss1   := na  
    takeProfit1 := na  
// Set `stopLoss2` and `takeProfit2` to `na` when price touches either.  
if low <= stopLoss2 or high >= takeProfit2  
    stopLoss2   := na  
    takeProfit2 := na  

plot(stopLoss1,   "SL1", color.red,   style = plot.style_circles)  
plot(stopLoss2,   "SL2", color.red,   style = plot.style_circles)  
plot(takeProfit1, "TP1", color.green, style = plot.style_circles)  
plot(takeProfit2, "TP2", color.green, style = plot.style_circles)  

```

--------------------------------

### Pine Script: Multiple `request.security` calls

Source: https://www.tradingview.com/pine-script-docs/writing/profiling-and-optimization

This Pine Script example demonstrates making nine separate `request.security()` calls to retrieve different `ta.percentrank()` values from a specified symbol. It then plots all nine requested values.

```Pine Script
//@version=6  
indicator("Minimizing `request.*()` calls demo")  

//@variable The symbol to request data from.  
string symbolInput = input.symbol("BINANCE:BTCUSDT", "Symbol")  

// Request 9 `ta.percentrank()` values from the `symbolInput` context using 9 `request.security()` calls.  
float reqRank1 = request.security(symbolInput, timeframe.period, ta.percentrank(close, 10))  
float reqRank2 = request.security(symbolInput, timeframe.period, ta.percentrank(close, 20))  
float reqRank3 = request.security(symbolInput, timeframe.period, ta.percentrank(close, 30))  
float reqRank4 = request.security(symbolInput, timeframe.period, ta.percentrank(close, 40))  
float reqRank5 = request.security(symbolInput, timeframe.period, ta.percentrank(close, 50))  
float reqRank6 = request.security(symbolInput, timeframe.period, ta.percentrank(close, 60))  
float reqRank7 = request.security(symbolInput, timeframe.period, ta.percentrank(close, 70))  
float reqRank8 = request.security(symbolInput, timeframe.period, ta.percentrank(close, 80))  
float reqRank9 = request.security(symbolInput, timeframe.period, ta.percentrank(close, 90))  

// Plot the `reqRank*` values.  
plot(reqRank1)  
plot(reqRank2)  
plot(reqRank3)  
plot(reqRank4)  
plot(reqRank5)  
plot(reqRank6)  
plot(reqRank7)  
plot(reqRank8)  
plot(reqRank9)  
```

--------------------------------

### Configurable Inputs with input()

Source: https://www.tradingview.com/pine-script-docs/release-notes

Details the addition of the 'step' argument to the input() function, enabling users to define the increment value for indicator inputs. Also covers 'source' type inputs for selecting data sources.

```Pine Script
input(step = 0.1)
input(type = input.source)
```

--------------------------------

### Pine Script v5 Lazy Evaluation Example

Source: https://www.tradingview.com/pine-script-docs/migration-guides/to-pine-version-6

Demonstrates Pine Script v5's strict evaluation of boolean expressions. The `ta.rsi` function is called on every bar, even when the first condition of the 'and' statement is false, ensuring correct calculation.

```Pine Script
//@version=5  
indicator("Evaluation test v5")  

//@variable A signal flag. Is `true` if two conditions `close > open` and `ta.rsi(close, 14) > 50` are both `true`. 
bool signal = false  

if close > open and ta.rsi(close, 14) > 50  
    signal := true  

// Highlight background on bars where `signal` is `true`. 
bgcolor(signal ? color.new(color.green, 90) : na)  

```

--------------------------------

### Pine Script: Basic Order Placement with strategy.order()

Source: https://www.tradingview.com/pine-script-docs/concepts/strategies

This script demonstrates the use of the strategy.order() command in Pine Script to place buy and sell market orders. It places a long order every 100 bars and a short order every 25 bars, highlighting the bars where orders are placed.

```Pine Script
//@version=6
strategy("`strategy.order()` demo", overlay = true)

//@variable Is `true` on every 100th bar, `false` otherwise.
bool buyCondition = bar_index % 100 == 0
//@variable Is `true` on every 25th bar, `false` otherwise.
bool sellCondition = bar_index % 25 == 0

if buyCondition
    // Place a "buy" market order to trade 15 units in the long direction.
    strategy.order("buy", strategy.long, qty = 15)
else if sellCondition
    // Place a "sell" market order to trade 5 units in the short direction.
    strategy.order("sell", strategy.short, qty = 5)

// Highlight the background when the `buyCondition` or `sellCondition` occurs.
bgcolor(buyCondition ? color.new(color.blue, 90) : sellCondition ? color.new(color.red, 90) : na)

```

--------------------------------

### Pine Script v6 Explicit Boolean Casting Example

Source: https://www.tradingview.com/pine-script-docs/migration-guides/to-pine-version-6

Shows the required explicit casting of numeric values to boolean in Pine Script v6 using the bool() function. This is necessary for conditional expressions where a boolean type is expected.

```Pine Script
color expr = bool(bar_index) ? color.green : color.red
```

--------------------------------

### Update plot and hline styles to built-in constants in Pine Script v5

Source: https://www.tradingview.com/pine-script-docs/migration-guides/to-pine-version-5

In v5, `plot()` and `hline()` require built-in constants for `style` and `linestyle` arguments instead of integers. This example demonstrates the conversion from integer inputs to string inputs and then to the correct constants.

```Pine Script
// v4 example with integer styles (causes error in v5)
plotStyle = input(1)
hlineStyle = input(1)
plot(close, style = plotStyle)
hline(100, linestyle = hlineStyle)

```

```Pine Script
// v5 example with string inputs and built-in constants
//@version=5
indicator("")
plotStyleInput = input.string("Line", options = ["Line", "Stepline", "Histogram", "Cross", "Area", "Columns", "Circles"])
hlineStyleInput = input.string("Solid", options = ["Solid", "Dashed", "Dotted"])

plotStyle = plotStyleInput == "Line" ? plot.style_line : 
        plotStyleInput == "Stepline" ? plot.style_stepline : 
        plotStyleInput == "Histogram" ? plot.style_histogram : 
        plotStyleInput == "Cross" ? plot.style_cross : 
        plotStyleInput == "Area" ? plot.style_area : 
        plotStyleInput == "Columns" ? plot.style_columns : 
        plot.style_circles

hlineStyle = hlineStyleInput == "Solid" ? hline.style_solid : 
        hlineStyleInput == "Dashed" ? hline.style_dashed : 
        hline.style_dotted

plot(close, style = plotStyle)
hline(100, linestyle = hlineStyle)

```

--------------------------------

### Rewrite forward-referenced variables for Pine Script v3

Source: https://www.tradingview.com/pine-script-docs/migration-guides/to-pine-version-3

Shows the correct way to handle forward-referenced variables in Pine Script v3, which were allowed in v2. The example demonstrates initializing the variable before its first reference.

```Pine Script
//@version=2  
//...  
d = nz(f[1])  
e = d + 1  
f = e + close
```

```Pine Script
//@version=3  
//...  
f = 0.0  
d = nz(f[1])  
e = d + 1  
f := e + close
```

--------------------------------

### Update transp parameter for plotting functions in Pine Script v5

Source: https://www.tradingview.com/pine-script-docs/migration-guides/to-pine-version-5

In v5, the `transp` parameter is deprecated and must be specified with the color using `color.new()` or `color.rgb()`. This example shows how to update Bollinger Bands plotting to include transparency.

```Pine Script
// v4 example with default transp
//@version=4  
study("Bollinger Bands", overlay = true)  
[middle, upper, lower] = bb(close, 5, 4)  
plot(middle, color=color.blue)
plot(upper, color=color.green)
plot(lower, color=color.green)
fill(p1PlotID, p2PlotID, color = color.green)
bgcolor(crossUp ? color.green : crossDn ? color.red : na)

```

```Pine Script
// v5 example with explicit transp using color.new()
//@version=5  
indicator("Bollinger Bands", overlay = true)
[middle, upper, lower] = ta.bb(close, 5, 4)
plot(middle, color=color.blue)
p1PlotID = plot(upper, color=color.green)
p2PlotID = plot(lower, color=color.green)
crossUp = ta.crossover(high, upper)
crossDn = ta.crossunder(low, lower)
var TRANSP = 90
fill(p1PlotID, p2PlotID, color = color.new(color.green, TRANSP))
bgcolor(crossUp ? color.new(color.green, TRANSP) : crossDn ? color.new(color.red, TRANSP) : na)

```

--------------------------------

### Pine Script: Ensure Order Placement Commands

Source: https://www.tradingview.com/pine-script-docs/faq/strategies

Strategies must use `strategy.order()` or `strategy.entry()` to place trades. This snippet suggests checking Pine Logs to verify if the conditions for these commands are met.

```Pine Script
// Add log.info messages and review the Pine Logs to check whether the conditions to run the commands are met.
// Example:
// if (buyCondition)
//     log.info("Buy condition met, attempting to place order.")
//     strategy.entry("Buy", strategy.long)
// else if (sellCondition)
//     log.info("Sell condition met, attempting to place order.")
//     strategy.entry("Sell", strategy.short)
```

--------------------------------

### Pine Script: Generate Random Holiday Colors with color.rgb()

Source: https://www.tradingview.com/pine-script-docs/concepts/colors

This example utilizes color.rgb() to create random colors with varying transparency for chart elements, simulating a holiday theme. It generates random RGBA values and applies them to plot candles.

```Pine Script
//@version=6
indicator("Holiday candles", "", true)
float r = math.random(0, 255)
float g = math.random(0, 255)
float b = math.random(0, 255)
float t = math.random(0, 100)
color holidayColor = color.rgb(r, g, b, t)
plotcandle(open, high, low, close, color = holidayColor, wickcolor = holidayColor, bordercolor = holidayColor)
```

--------------------------------

### Pine Script v5 Implicit Boolean Casting Example

Source: https://www.tradingview.com/pine-script-docs/migration-guides/to-pine-version-6

Demonstrates how Pine Script v5 implicitly casts numeric values to boolean in conditional expressions. A non-zero numeric value is treated as true, while zero or 'na' is treated as false.

```Pine Script
color expr = bar_index ? color.green : color.red
```

--------------------------------

### Declare Constants in Pine Script

Source: https://www.tradingview.com/pine-script-docs/writing/style-guide

Demonstrates how to declare constant variables in Pine Script using the `const` keyword. It shows examples of defining integer and color constants, as well as string constants used for tooltips and options. Constants are named using `SNAKE_CASE` and declared at the top of the script for readability and maintainability.

```Pine Script
// ———— Constants  
int       MS_IN_MIN     = 60 * 1000  
int       MS_IN_HOUR    = MS_IN_MIN  * 60  
int       MS_IN_DAY     = MS_IN_HOUR * 24  
  
color     GRAY          = #808080ff  
color     LIME          = #00FF00ff  
color     MAROON        = #800000ff  
color     ORANGE        = #FF8000ff  
color     PINK          = #FF0080ff  
color     TEAL          = #008080ff  
color     BG_DIV        = color.new(ORANGE, 90)  
color     BG_RESETS     = color.new(GRAY, 90)  
  
string    RST1          = "No reset; cumulate since the beginning of the chart"  
string    RST2          = "On a stepped higher timeframe (HTF)"  
string    RST3          = "On a fixed HTF"  
string    RST4          = "At a fixed time"  
string    RST5          = "At the beginning of the regular session"  
string    RST6          = "At the first visible chart bar"  
string    RST7          = "Fixed rolling period"  
  
string    LTF1          = "Least precise, covering many chart bars"  
string    LTF2          = "Less precise, covering some chart bars"  
string    LTF3          = "More precise, covering less chart bars"  
string    LTF4          = "Most precise, 1min intrabars"  
  
string    TT_TOTVOL     = "The 'Bodies' value is the transparency of the total volume candle bodies. Zero is opaque, 100 is transparent."  
string    TT_RST_HTF    = "This value is used when '" + RST3 + "' is selected."  
string    TT_RST_TIME   = "These values are used when '" + RST4 + "' is selected.  
  A reset will occur when the time is greater or equal to the bar's open time, and less than its close time.
Hour: 0-23
Minute: 0-59"  
string    TT_RST_PERIOD = "This value is used when '" + RST7 + "' is selected."  
```

--------------------------------

### Pine Script Type Keywords Demo

Source: https://www.tradingview.com/pine-script-docs/language/type-system

This Pine Script example demonstrates the use of type keywords (string, int, float, bool, color) in variable declarations. It calculates a moving average, detects crossovers, and assigns colors based on price action. Type specification is shown as optional for most variables but required when initializing with 'na'.

```Pine Script
//@version=6  
indicator("Type keywords demo", overlay = true)  
 
// The `string`, `int`, `float`, `bool` and `color` keywords are *optional* in the following variable declarations:  
string MA_TITLE    =  "MA"  
int    lengthInput = input.int(100, "Length", minval = 2)  
float  ma       =  ta.sma(close, lengthInput)  
bool  crossUp    =  ta.crossover(close, ma)  
color  maColor   =  close > ma ? color.lime : color.fuchsia  
 
// Specifying a type is required in this declaration, because the variable's initial value is `na`.  
// The `float` keyword tells the compiler that the variable accepts "float" values.  
var float crossValue = na  
 
// Update the `crossValue` variable based on the `crossUp` condition.  
if crossUp 
    crossValue := close  
 
plot(ma, MA_TITLE, maColor)  
plot(crossValue, "Cross value", style = plot.style_circles)  
plotchar(crossUp, "Cross Up", "▲", location.belowbar, size = size.small)  

```

--------------------------------

### Pine Script v6 `for` loop fix for dynamic boundary

Source: https://www.tradingview.com/pine-script-docs/migration-guides/to-pine-version-6

This Pine Script v6 example shows how to fix the behavior of a `for` loop with a dynamic boundary by assigning the boundary expression to a variable outside the loop. This ensures the boundary is evaluated only once, preventing infinite loops in v6 that could occur with the v5 version.

```Pine Script
//@version=6  
indicator("v5 to v6 fixed `to_num` demo")  
  
//@variable The size of the `data` array.   
int sizeInput = input.int(20, "Size", 1)  
  
//@function Appends a new `value` to `this` array and returns the array's size.   
method queue(array<float> this, float value) =>  
    this.push(value)  
    this.size()  
  
//@function Removes the first value from `this` array if the size equals the `sizeInput`.  
method dequeue(array<float> this) =>  
    if this.size() == sizeInput  
        this.shift()  
  
//@variable An array that holds `sizeInput` recent `close` prices.   
var array<float> data = array.new<float>()  
  
//@variable The number of elements in the `data` array that are below the current bar's `ohlc4`.   
int belowCount = 0  
  
// Remove the oldest element from the `data` array when its size reaches the `sizeInput`.   
data.dequeue()  
  
// Calculate the loop boundary once before the loop.   
int loopBoundary = data.queue(close) - 1  
  
// Loop from zero up to the pre-calculated boundary.   
for i = 0 to loopBoundary  
    // Add 1 to `belowCount` when the `data` element at index `i` is less than the `ohlc4` value.   
    if data.get(i) < ohlc4  
        belowCount += 1  
  
// Plot the `belowCount` in a separate pane.   
plot(belowCount, "Closes below OHLC4", color.blue, 3)
```

--------------------------------

### Pine Script Integer Input with Options

Source: https://www.tradingview.com/pine-script-docs/concepts/inputs

Shows how to use the input.int() function with the 'options' parameter to provide a predefined list of integer values for user selection, typically displayed as a dropdown menu. This example uses it to set the length for a Simple Moving Average (SMA).

```Pine Script
//@version=6  
indicator("MA", "", true)  
maLengthInput = input.int(10, options = [3, 5, 7, 10, 14, 20, 50, 100, 200])  
ma = ta.sma(close, maLengthInput)  
plot(ma)  

```

--------------------------------

### Pine Script: Color CCI Line with Gradient

Source: https://www.tradingview.com/pine-script-docs/concepts/colors

This example demonstrates coloring a Commodity Channel Index (CCI) line using color.from_gradient(). It maps the CCI values between -200 and 200 to a gradient of bear and bull colors. The CCI calculation itself is done using the built-in ta.cci() function.

```Pine Script
//@version=6  
indicator(title="CCI line gradient", precision=2, timeframe="")  
var color GOLD_COLOR   = #CCCC00  
var color VIOLET_COLOR = #AA00FF  
var color BEIGE_COLOR  = #9C6E1B  
float srcInput = input.source(close, title="Source")  
int   lenInput = input.int(20, "Length", minval = 5)  
color bullColorInput = input.color(GOLD_COLOR,   "Bull")  
color bearColorInput = input.color(BEIGE_COLOR, "Bear")  
float signal = ta.cci(srcInput, lenInput)  
color signalColor = color.from_gradient(signal, -200, 200, bearColorInput, bullColorInput)  
plot(signal, "CCI", signalColor)  
bandTopPlotID = hline(100,  "Upper Band", color.silver, hline.style_dashed)  
bandBotPlotID = hline(-100, "Lower Band", color.silver, hline.style_dashed)  
fill(bandTopPlotID, bandBotPlotID, color.new(BEIGE_COLOR, 90), "Background")  

```

--------------------------------

### Pine Script: Pair Price and Time Inputs for Interactive Chart Points

Source: https://www.tradingview.com/pine-script-docs/concepts/inputs

This example demonstrates pairing `input.price()` and `input.time()` with matching `inline` arguments to create interactive points on the chart. These points can be moved by the user to adjust input values simultaneously, and are used here to draw a polyline.

```Pine Script®
//@version=6  
indicator("Price and time input demo", overlay = true)   

// Create price and time inputs with the same `inline` arguments to set them together on the chart.   

// Price and time for the first point.   
float price1Input = input.price(0, "Price 1", inline = "1", confirm = true)   
int   time1Input  = input.time(0,  "Time 1",  inline = "1", confirm = true)   
// Price and time for the second point.   
float price2Input = input.price(0, "Price 2", inline = "2", confirm = true)   
int   time2Input  = input.time(0,  "Time 2",  inline = "2", confirm = true)   
// Price and time for the third point.   
float price3Input = input.price(0, "Price 3", inline = "3", confirm = true)   
int   time3Input  = input.time(0,  "Time 3",  inline = "3", confirm = true)   
// Price and time for the fourth point.   
float price4Input = input.price(0, "Price 4", inline = "4", confirm = true)   
int   time4Input  = input.time(0,  "Time 4",  inline = "4", confirm = true)   

//@variable An array of chart points created from the time and price inputs.   
var array<chart.point> points = array.from(   
      chart.point.from_time(time1Input, price1Input),   
      chart.point.from_time(time2Input, price2Input),   
      chart.point.from_time(time3Input, price3Input),   
      chart.point.from_time(time4Input, price4Input)   
 )   

// Draw a closed, curved polyline connecting the points from the `points` array on the last bar.   
if barstate.islast    var polyline shape = polyline.new(points, true, true, xloc.bar_time, color.purple, color.new(color.blue, 60)) 
```

--------------------------------

### Pine Script Start of Line Assertion ^

Source: https://www.tradingview.com/pine-script-docs/concepts/strings

Explains the ^ assertion, which matches the starting point of a line. It can match the start of the string or immediately after a newline character when the (?m) modifier is used.

```Pine Script
regex.test("(?m)^[xyz]", "\nx")
```

--------------------------------

### Pine Script: Access Specific Trade Entry Price

Source: https://www.tradingview.com/pine-script-docs/faq/strategies

Retrieve the entry price for a specific trade in Pine Script using the `strategy.opentrades.entry_price(trade_id)` function. To get the entry price of the most recent open trade, use `strategy.opentrades - 1` as the trade ID, as trade indexes start from zero.

```Pine Script
if strategy.opentrades > 0
    lastTradeEntryPrice = strategy.opentrades.entry_price(strategy.opentrades - 1)

```

--------------------------------

### Importing a Pine Script Library

Source: https://www.tradingview.com/pine-script-docs/concepts/libraries

Demonstrates how to import a library into a Pine Script. It specifies the username, library name, version, and an optional alias for referencing the library's functions. Auto-completion is available when typing the username.

```Pine Script
import PineCoders/AllTimeHighLow/1 as allTime
```

--------------------------------

### Pine Script Matrix Sum and Diff Example

Source: https://www.tradingview.com/pine-script-docs/language/matrices

This Pine Script code demonstrates matrix operations including creation, transposition, addition (`matrix.sum`), and subtraction (`matrix.diff`). It defines a helper function `debugLabel` to display matrix information on the chart. The script initializes a 3x3 matrix, calculates its transpose, and then computes and displays the sum and difference between the original matrix and its transpose.

```Pine Script
//@version=6  
indicator("Matrix sum and diff example")  

//@function Displays the rows of a matrix in a label with a note.  
//@param    this The matrix to display.  
//@param    barIndex The `bar_index` to display the label at.  
//@param    bgColor The background color of the label.  
//@param    textColor The color of the label's text.  
//@param    note The text to display above the rows.  
method debugLabel(    matrix<float> this, int barIndex = bar_index, color bgColor = color.blue, 
    color textColor = color.white, string note = "" 
) => 
    labelText = note + "\n" + str.tostring(this) 
    if barstate.ishistory 
       label.new(      barIndex, 0, labelText, color = bgColor, style = label.style_label_center, 
             textcolor = textColor, size = size.huge 
    ) 
  
  //@variable A 3x3 matrix. 
  m = matrix.new<float>() 
  
  // Add rows to `m`. 
  m.add_row(0, array.from(0.5, 1.0, 1.5)) 
  m.add_row(1, array.from(2.0, 2.5, 3.0)) 
  m.add_row(2, array.from(3.5, 4.0, 4.5)) 
  
  if bar_index == last_bar_index - 1 
    // Display `m`. 
    m.debugLabel(note = "A") 
    // Get and display the transpose of `m`. 
    matrix<float> t = m.transpose() 
    t.debugLabel(bar_index + 10, note = "A¡") 
    // Calculate the sum of the two matrices. The resulting matrix is symmetric. 
    matrix.sum(m, t).debugLabel(bar_index + 20, color.green, note = "A + A¡") 
    // Calculate the difference between the two matrices. The resulting matrix is antisymmetric. 
    matrix.diff(m, t).debugLabel(bar_index + 30, color.red, note = "A - A¡") 

```

--------------------------------

### Pine Script Float Literals

Source: https://www.tradingview.com/pine-script-docs/language/type-system

Examples of float literals in Pine Script, demonstrating standard decimal format and scientific notation (E notation).

```Pine Script
3.14159
-3.0
6.02e23
1.6e-19
```

--------------------------------

### Pine Script v5 vs v6 Lazy Evaluation Comparison

Source: https://www.tradingview.com/pine-script-docs/migration-guides/to-pine-version-6

Illustrates the difference in behavior between Pine Script v5 (strict evaluation) and v6 (lazy evaluation) when handling array operations within conditional statements. The v5 example shows a potential runtime error if not handled carefully, while v6 avoids it due to lazy evaluation.

```Pine Script
// Pine v5 example with potential runtime error
//@version=5  
indicator("Lazy evaluation error showcase")  

array<bool> myArray = array.new<bool>()  

if close > open  
   myArray.push(true)  

// Causes a runtime error in v5 when trying to call `array.first()` on an empty array. 
// Works in v6 because `array.first()` is only called if the array is not empty. 
if myArray.size() != 0 and myArray.first()  
   label.new(bar_index, high, "Test")  
  
// A correct approach for v5: `array.first()` is only called when we're sure the array is not empty. 
if myArray.size() != 0  
   if myArray.first()  
     label.new(bar_index, high, "Test")  

```

--------------------------------

### Pine Script alert() Example with Vstop

Source: https://www.tradingview.com/pine-script-docs/faq/alerts

Utilizes the vstop() function to calculate a volatility stop and trend. It triggers alerts using alert() when the trend direction changes or when the stop value updates.

```Pine Script
//@version=6  
indicator("Vstop alert demo", overlay = true)  
  
import TradingView/ta/7 as TVta  
  
// Calculate ATR trailing stop and determine trend direction.  
[stopValue, trendUp] = TVta.vStop(close, 20, 2)  
  
// Round the stop value to mintick for accuracy in comparison operators.  
float stop = math.round_to_mintick(stopValue)  
  
// Check for trend changes.  
bool  trendReversal = trendUp != trendUp[1]  
bool  trendToDn     = trendReversal and not trendUp  
bool  trendToUp     = trendReversal and     trendUp  
// Create color variables for the plot display.  
color plotColor     = trendUp ? color.green : color.red  
color lineColor     = trendReversal ? color(na) : plotColor  
  
// Plot the stop value on the chart. Plot a circle on trend changes.  
plot(stop, "V-Stop", lineColor)  
plot(trendReversal ? stop : na, "Trend Change Circle", plotColor, 3, plot.style_circles)  
  
// Convert the stop value to string for use in the alert messages.  
string stopStr = str.tostring(stop)  
  
// If the trend changed to up, send a long alert with the initial stop value.  
if trendToUp  
    alert("Long alert. Stop @ " + stopStr, alert.freq_once_per_bar_close)  
  
// If the trend changed to down, send a short alert with the initial stop value.  
if trendToDn  
    alert("Short alert. Stop @ " + stopStr, alert.freq_once_per_bar_close)  
  
// If the stop value has progressed, send an alert to update the stop value.  
if (trendUp and stop > stop[1] or not trendUp and stop < stop[1]) and not trendReversal  
    alert('Update stop to ' + stopStr, alert.freq_once_per_bar_close)  

```

--------------------------------

### Pine Script License Comment

Source: https://www.tradingview.com/pine-script-docs/writing/style-guide

This code snippet shows the standard license comment for open-source Pine Script scripts, typically using the Mozilla Public License 2.0. It also includes a placeholder for the copyright owner.

```Pine Script
// This source code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/  
// © username  
```

--------------------------------

### Loop Through Array Elements with while Loop

Source: https://www.tradingview.com/pine-script-docs/language/arrays

Illustrates the use of a 'while' loop to iterate through an array. This method requires manual management of an index counter. The example fetches close prices from a lower timeframe and displays them, similar to the 'for' loop examples.

```Pine Script
//@version=6  
indicator("`while` loop", overlay = true)  
array<float> a = request.security_lower_tf(syminfo.tickerid, "1", close)  
  
string labelText = ""  
int i = 0  
while i < array.size(a)  
    labelText += str.tostring(array.get(a, i)) + "\n"  
    i += 1  
  
label.new(bar_index, high, text = labelText)  
```

--------------------------------

### Pine Script: Create Timestamp from Year, Month, Day

Source: https://www.tradingview.com/pine-script-docs/concepts/time

This example demonstrates creating a Unix timestamp by providing year, month, and day as separate arguments to the `timestamp()` function. The resulting timestamp is then formatted.

```pinescript
printCell(0, 2, "`dateTimestamp2`", "header")
printCell(1, 2, "`timestamp(2021, 1, 1, 0, 0)`", "code")
printCell(2, 2, str.tostring(dateTimestamp2))
printCell(3, 2, str.format_time(dateTimestamp2, "yyyy.MM.dd  HH:mm (Z)"))
```

--------------------------------

### Update session days for time() and time_close() in Pine Script v5

Source: https://www.tradingview.com/pine-script-docs/migration-guides/to-pine-version-5

The default session days for `time()` and `time_close()` have changed from Monday-Friday (`"23456"`) to Sunday-Saturday (`"1234567"`) in v5. This example shows how to maintain v4 behavior by explicitly specifying the days.

```Pine Script
// v4 behavior in v5 by specifying days
t0 = time("1D", "1000-1200")
// v5 equivalent of v4 behavior
t1 = time("1D", "1000-1200:23456")
// v5 default behavior
t2 = time("1D", "1000-1200:1234567")

```

--------------------------------

### Pine Script v6: Plotting with color.new() for transparency

Source: https://www.tradingview.com/pine-script-docs/migration-guides/to-pine-version-6

Demonstrates the recommended way to set plot transparency in Pine Script v6 using the color.new() function, replacing the removed 'transp' parameter.

```Pine Script
//@version=6  
indicator("Transparency demo v6")  
  
color myColor = close > open ? color.green : color.red  
plot(close, color = color.new(myColor, 80))  
```

--------------------------------

### Pine Script: Initial Bollinger Bands Calculation

Source: https://www.tradingview.com/pine-script-docs/language/methods

This code snippet demonstrates the initial calculation of Bollinger Bands using array methods for mean and standard deviation. It shows how to compute the high and low bands based on these values.

```Pine Script
// Identify if `n` bars have passed.  
if bar_index % n == 0  
    // Update the queue.  
    sourceArray.push(sourceInput)  
    sourceArray.shift()  
    // Update the mean and standard deviation values.  
    sampleMean := sourceArray.avg()  
    sampleDev  := sourceArray.stdev() * multiplier  
  
// Calculate band values.  
float highBand = sampleMean + sampleDev  
float lowBand  = sampleMean - sampleDev  
```

--------------------------------

### Pine Script: Plot User-Selected Price Source

Source: https://www.tradingview.com/pine-script-docs/concepts/inputs

Illustrates the use of input.source() to allow users to choose between different price values (like open, high, low, close) or the output of other indicators. This example plots the selected source.

```Pine Script
//@version=6
indicator("Source input", "", true)
srcInput = input.source(high, "Source")
plot(srcInput, "Src", color.new(color.purple, 70), 6)

```

--------------------------------

### Pine Script Color Functions Demo

Source: https://www.tradingview.com/pine-script-docs/language/type-system

Illustrates the use of `color.rgb()` and `color.new()` functions in Pine Script to create and modify colors dynamically. This example shows how to define a base color using RGB values and then adjust its transparency based on the day of the week, applying it to the chart background.

```Pine Script
//@version=6
indicator("color.*() functions demo")

// A color with custom red, green, and blue components. The variable's type is "const color".
color BASE_COLOR = color.rgb(0, 99, 165) 

// A calculated transparency value based on the current day of the week. This variable's type is "series int".
int transparency = 50 + int(40 * dayofweek / 7)

// A modified copy of `BASE_COLOR` with dynamic transparency. 
// This variable's type is "series color", because its calculation depends on a "series int" value.
color modifiedColor = color.new(BASE_COLOR, transparency)

// Color the background using the `modifiedColor` value.
bgcolor(modifiedColor)
```

--------------------------------

### Pine Script Basic Indicator Example

Source: https://www.tradingview.com/pine-script-docs/language/script-structure

A minimal Pine Script indicator that plots the closing price of a security. It includes the version declaration, an indicator declaration statement, and a plot function call.

```Pine Script
//@version=6
indicator("My Script")
plot(close)
```

--------------------------------

### Pine Script v5: History Referencing on Literals

Source: https://www.tradingview.com/pine-script-docs/migration-guides/to-pine-version-6

Demonstrates the use of the history-referencing operator `[]` with literals and built-in constants in Pine Script v5. While functional, this usage is generally redundant as literals represent fixed values. The example shows plotting a historical literal, setting background color based on a historical constant, and attempting to reference a historical string literal.

```Pine Script
//@version=5  
indicator("History-referencing on literals demo")  

// These lines all use history-referencing on literals, which works in v5, but is not really useful to do here.   
plot(6[1], "6[1]", linewidth = 3)
plot(color.red[10], "color.red[10]", linewidth = 3)
bgcolor(true[10] ? color.orange[3] : na)
if barstate.islastconfirmedhistory
    // Since "string literal" is only defined in the last bar scope, history-referencing here returns `na`.    
    labelText = "string literal"[20]    
    label.new(bar_index - 3, 3, labelText + ", more text", textcolor = color.white, size = size.large)    
    // Label output will only show ", more text" in v5, since `labelText` is `na`.    

// In v6, using any history-referencing on literals or built-in constants causes an error. 

```

--------------------------------

### Pine Script: Place a Stop-Limit Order

Source: https://www.tradingview.com/pine-script-docs/concepts/strategies

This Pine Script code demonstrates how to place a stop-limit order. It triggers a limit order when the price reaches the stop level, and the limit order is then filled at the specified limit price. The example includes visual aids like labels and lines.

```Pine Script
//@version=6  
strategy("Stop-Limit order demo", overlay = true, margin_long = 100, margin_short = 100)

//@function Displays text passed to `txt` when called and shows the `price` level on the chart.
debugLabel(price, txt, lblColor, lineWidth = 1) =>
    label.new(
      bar_index, high, text = txt, color = lblColor, textcolor = color.white,
      style = label.style_label_lower_right, size = size.large
    )
    line.new(bar_index, close, bar_index, price, style = line.style_dotted, color = lblColor, width = lineWidth)
    line.new(
      bar_index, price, bar_index + 1, price, color = lblColor, extend = extend.right,
      style = line.style_dashed, width = lineWidth
    )

var float stopPrice  = na
var float limitPrice = na

// Generate a long stop-limit order with a label and lines 100 bars before the last bar.
if last_bar_index - bar_index == 100
    stopPrice  := close + syminfo.mintick * 800
    limitPrice  := low
    debugLabel(limitPrice, "", color.gray)
    debugLabel(stopPrice, "Long Stop-Limit order created", color.teal)
    strategy.entry("Long", strategy.long, stop = stopPrice, limit = limitPrice)

// Draw a line and label when the strategy activates the limit order.
if high >= stopPrice
    debugLabel(limitPrice, "Limit order activated", color.green, 2)
    stopPrice := na
```

--------------------------------

### Pine Script: Line Wrapping for Readability

Source: https://www.tradingview.com/pine-script-docs/writing/style-guide

Demonstrates how to use indentation for line wrapping in Pine Script to improve the readability of long function calls, such as the `plot` function with multiple arguments.

```Pine Script
`plot(  
   series = close,  
   title = "Close",  
   color = color.blue,  
   show_last = 10  
 )  
`
```

--------------------------------

### Pine Script: Color CCI Band Based on Bars Since Cross

Source: https://www.tradingview.com/pine-script-docs/concepts/colors

This advanced example colors the background band of a CCI indicator based on the number of bars since the CCI crossed the centerline. It uses color.from_gradient() to create a gradient for the band color, transitioning from no color to a specified end color based on a calculated step count.

```Pine Script
//@version=6  
indicator(title="CCI line gradient", precision=2, timeframe="")  
var color GOLD_COLOR   = #CCCC00  
var color VIOLET_COLOR = #AA00FF    
var color GREEN_BG_COLOR = color.new(color.green, 70)  
var color RED_BG_COLOR   = color.new(color.maroon, 70)  
float srcInput      = input.source(close, "Source")  
int   lenInput      = input.int(20, "Length", minval = 5)  
int   stepsInput    = input.int(50, "Gradient levels", minval = 1)  
color bullColorInput   = input.color(GOLD_COLOR, "Line: Bull", inline = "11")  
color bearColorInput   = input.color(VIOLET_COLOR, "Bear", inline = "11")  
color bullBgColorInput = input.color(GREEN_BG_COLOR, "Background: Bull", inline = "12")  
color bearBgColorInput = input.color(RED_BG_COLOR, "Bear", inline = "12")  
  
// Plot colored signal line.  
float signal = ta.cci(srcInput, lenInput)  
color signalColor = color.from_gradient(signal, -200, 200, color.new(bearColorInput, 0), color.new(bullColorInput, 0))  
plot(signal, "CCI", signalColor, 2)  
  
// Detect crosses of the centerline.  
bool signalX = ta.cross(signal, 0)  
// Count no of bars since cross. Capping it to the no of steps from inputs.  
int gradientStep = math.min(stepsInput, nz(ta.barssince(signalX)))  
// Choose bull/bear end color for the gradient.  
color endColor = signal > 0 ? bullBgColorInput : bearBgColorInput  
// Get color from gradient going from no color to `endColor`   
color bandColor = color.from_gradient(gradientStep, 0, stepsInput, na, endColor)  
bandTopPlotID = hline(100,  "Upper Band", color.silver, hline.style_dashed)  
bandBotPlotID = hline(-100, "Lower Band", color.silver, hline.style_dashed)  
fill(bandTopPlotID, bandBotPlotID, bandColor, title = "Band")  

```

--------------------------------

### Initialize Array with array.unshift()

Source: https://www.tradingview.com/pine-script-docs/language/arrays

This example shows how to initialize an array using array.unshift(), which inserts new elements at the beginning of the array. This results in the array being populated in reverse order compared to using array.push().

```Pine Script®
// Declare array and set its values on the first bar only.  
var fillColors = array.new<color>(0)  
if barstate.isfirst   
  // Initialize the array elements with progressively lighter shades of the fill color.    array.unshift(fillColors, color.new(FILL_COLOR, 90))    array.unshift(fillColors, color.new(FILL_COLOR, 85))    array.unshift(fillColors, color.new(FILL_COLOR, 80))    array.unshift(fillColors, color.new(FILL_COLOR, 75))    array.unshift(fillColors, color.new(FILL_COLOR, 70))  

```

--------------------------------

### Pine Script v6: No History Referencing on Literals

Source: https://www.tradingview.com/pine-script-docs/migration-guides/to-pine-version-6

Illustrates the corrected behavior in Pine Script v6 where the history-referencing operator `[]` is disallowed on literals and built-in constants, preventing compilation errors. This example shows the equivalent code without the problematic `[]` operators, ensuring correct execution. It plots a literal, sets background color based on a constant, and defines a string label without historical referencing.

```Pine Script
//@version=6  
indicator("History-referencing on literals demo")  

// We no longer use history-referencing on literals in v6.   
plot(6, "6", linewidth = 3)
plot(color.red, "color.red", linewidth = 3)
bgcolor(true ? color.orange : na)
if barstate.islastconfirmedhistory
    labelText = "string literal"    
    label.new(bar_index - 3, 3, labelText + ", more text", textcolor = color.white, size = size.large)    
    // Label output shows "string literal, more text" in v6, since `labelText` is defined without history-referencing anymore.    

```

--------------------------------

### Pine Script Possessive Quantifier Example

Source: https://www.tradingview.com/pine-script-docs/concepts/strings

Demonstrates the use of a possessive quantifier (\w++) which consumes characters without releasing them. This example shows how it can prevent a match if subsequent parts of the pattern require those consumed characters.

```Pine Script
regex.test("\\w++abc", "word123abc")
```

--------------------------------

### Pine Script: Documenting Exported Functions with Annotations

Source: https://www.tradingview.com/pine-script-docs/writing/publishing

This snippet demonstrates how to use compiler annotations to document exported functions and types in Pine Script libraries, making them visible on hover and in parameter hints.

```Pine Script
// Example of documenting exported functions in a Pine Script library

//@version=5
library("MyMathLibrary")

// Exported function with documentation annotation
// @description Calculates the sum of two numbers.
// @param a The first number.
// @param b The second number.
// @returns The sum of a and b.
export float add(float a, float b)
    runtime.info("Adding {{a}} and {{b}}") // Example runtime info
    return a + b

// Exported type with documentation annotation
// @description Represents a point in 2D space.
// @field x The x-coordinate.
// @field y The y-coordinate.
export struct Point
    float x
    float y

// Example usage (would be in a separate script importing this library)
// import MyMathLibrary
// result = MyMathLibrary.add(5.0, 3.0)
// myPoint = MyMathLibrary.Point{x=1.0, y=2.0}
```

--------------------------------

### Pine Script: Array Negative Indexing Examples

Source: https://www.tradingview.com/pine-script-docs/language/arrays

Demonstrates positive and negative indexing for accessing elements in a Pine Script® array. Shows how to retrieve elements using indices from the beginning and end of the array.

```Pine Script®
array<string> myArray = array.from("first", "second", "third", "fourth", "last")  
  
// Positive indexing: Indexes forwards from the beginning of the array.  
myArray.get(0)                        // Returns "first" element  
myArray.get(myArray.size() - 1)       // Returns "last" element  
myArray.get(4)                        // Returns "last" element  
  
// Negative indexing: Indexes backwards from the end of the array.  
myArray.get(-1)                       // Returns "last" element  
myArray.get(-myArray.size())          // Returns "first" element  
myArray.get(-5)                       // Returns "first" element  
```

--------------------------------

### Pine Script: Replace substrings in a string

Source: https://www.tradingview.com/pine-script-docs/concepts/strings

Demonstrates replacing substrings using str.replace() and str.replace_all(). It shows how to replace punctuation, specific characters, all occurrences of a character, and insert newlines. The example also illustrates replacing zero-width boundaries and formatting the results into a displayable string.

```Pine Script®
//@version=6  
indicator("Replacing substrings demo")  

if barstate.isfirst  
  //@variable A string containing the sequence `Hello world!`.  
  string originalString = "Hello world!"  
  //@variable A copy of the `originalString` with `!` replaced by `!!!`.  
  string changePunctuation = str.replace(originalString, "!", "!!!")  
  //@variable A copy of the `originalString` with the second `o` replaced by `0`.  
  string changeLetter = str.replace(originalString, "o", "0", 1)  
  //@variable A copy of the `originalString` with all `l` characters replaced by 1.  
  string changeLetters = str.replace_all(originalString, "l", "1")  
  //@variable A copy of the `originalString` with all zero-width boundaries replaced by `\n-`.  
  string insertNewlines = str.replace_all(originalString, "", "\n")  
  //@variable A copy of the `originalString` without changes, as `H` does not occur two times.  
  string unchanged = str.replace(originalString, "H ", "_", 1)  

  //@variable A formatting string with the following initial structure: `{0}\n{1}\n{2}\n{3}\n{4}\n{5}`.  
  //          The script creates the string by replacing zero-width boundaries in the sequence `012345` with   
  //          `}\n{` using `str.replace_all()`,then removing the extra `}\n` and `\n{` from the start and end of the   
  //          call's result with two additional `str.replace()` calls.    
  string formatString = str.replace(str.replace(str.replace_all("012345", "", "}\n{"), "}\n", ""), "\n{", "", 5)  

  // Create a copy of the `formatString` with the first `}` replaced by `}\n-----------------------`, then reassign   
  // the variable to use that copy.   
  formatString := str.replace(formatString, "}", "}\n-----------------------")  

  //@variable A formatted string containing the original and modified "Hello world!" strings.   
  string displayText = str.format(  
          formatString, originalString, changePunctuation, changeLetter, changeLetters, insertNewlines, unchanged                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
```

--------------------------------

### Calculate and Plot Matrix Rank

Source: https://www.tradingview.com/pine-script-docs/language/matrices

Demonstrates how to calculate the rank of two matrices using `matrix.rank()` and plot the results. It shows examples of a full-rank matrix and a rank-deficient matrix.

```Pine Script
//@version=6  
indicator("Matrix rank example")  

//@variable A 3x3 full-rank matrix.  
m1 = matrix.new<float>()  
//@variable A 3x3 rank-deficient matrix.  
m2 = matrix.new<float>()  

// Add linearly independent vectors to `m1`.  
m1.add_row(0, array.from(3, 2, 3))  
m1.add_row(1, array.from(4, 6, 6))  
m1.add_row(2, array.from(7, 4, 9))  

// Add linearly dependent vectors to `m2`.  
m2.add_row(0, array.from(1, 2, 3))  
m2.add_row(1, array.from(2, 4, 6))  
m2.add_row(2, array.from(3, 6, 9))  

// Plot `matrix.rank()` values.  
plot(m1.rank(), color = color.green, linewidth = 3)   
plot(m2.rank(), color = color.red, linewidth = 3)   
```

--------------------------------

### Plot Dual-Color Bars with plotbar()

Source: https://www.tradingview.com/pine-script-docs/concepts/bar-plotting

Demonstrates the usage of the `plotbar()` function to draw conventional bars without wicks or borders. This example colors the bars green or red based on the relationship between the open and close prices, similar to the candle coloring example.

```Pine Script
//@version=6  \nindicator("Dual-color\u00a0bars")  \npaletteColor\u00a0=\u00a0close\u00a0>=\u00a0open\u00a0?\u00a0color.lime\u00a0:\u00a0color.red  \nplotbar(open,\u00a0high,\u00a0low,\u00a0close,\u00a0color\u00a0=\u00a0paletteColor)\u00a0  \n
```

--------------------------------

### Pine Script Timestamp Regex Search Example

Source: https://www.tradingview.com/pine-script-docs/writing/debugging

Illustrates a Pine Script regex search query for logs with prefixed timestamps between 09:30 and 16:00. This highlights filtering by time patterns.

```Pine Script
search("^(09:30|09:3[1-9]|09:[4-5][0-9]|1[0-5]:[0-5][0-9]|16:00)")
```

--------------------------------

### Pine Script: Strategy.close() and Strategy.close_all() with Immediately Parameter

Source: https://www.tradingview.com/pine-script-docs/release-notes

Highlights new overloaded versions of `strategy.close()` and `strategy.close_all()` that include an `immediately` parameter. Setting `immediately` to `true` ensures orders execute on the current tick, bypassing next-bar execution restrictions.

--------------------------------

### Creating a Custom Matrix Label

Source: https://www.tradingview.com/pine-script-docs/language/loops

An example script that creates a 3x3 matrix of random values and then iterates through its rows to generate a formatted string for display in a label. It calculates the average of each row and indicates if it's above 0.5.

```Pine Script
//@version=6
indicator("for row in matrix demo", "Custom matrix label")

//@variable Generates a random value between 0 and 1, rounded to 4 decimal places. 
rand() =>
    math.round(math.random(), 4)

if barstate.islastconfirmedhistory
    //@variable A matrix of randomized values to format and display in a `label`. 
    matrix<float> randomMatrix = matrix.new<float>()
    // Add a row of 9 randomized values and reshape the matrix to 3x3. 
    randomMatrix.add_row(
         0, array.from(rand(), rand(), rand(), rand(), rand(), rand(), rand(), rand(), rand())
    )
    randomMatrix.reshape(3, 3)

    //@variable A custom "string" representation of `randomMatrix` information. Modified within a loop. 
    string labelText = "Matrix rows: \n"

    // Loop through the rows in the `randomMatrix`. 
    for row in randomMatrix
        //@variable The average element value within the `row`. 
        float rowAvg = row.avg()
        //@variable An upward arrow when the `rowAvg` is above 0.5, a downward arrow otherwise. 
        string directionChar = rowAvg > 0.5 ? "⬆" : "⬇"
        // Add a "string" representing the `row` array, its average, and the `directionChar` to the `labelText`. 
        labelText += str.format("Row: {0} Avg: {1} {2}\n", row, rowAvg, directionChar)
    
    // Draw a `label` displaying the `labelText` on the current bar. 
    label.new(
         bar_index, 0, labelText, color = color.purple, textcolor = color.white, size = size.huge, 
         style = label.style_label_center, textalign = text.align_left
    )
```

--------------------------------

### Use Array as Stack (Push/Pop)

Source: https://www.tradingview.com/pine-script-docs/language/arrays

Demonstrates using Pine Script arrays as a LIFO (Last-In, First-Out) stack with `array.push()` and `array.pop()`. The example tracks successive lows in rallies, pushing new lows onto the stack and popping them to plot the lowest lows when certain conditions are met.

```Pine Script
//@version=6  
indicator("Lows from new highs", "", true)  
var lows = array.new<float>(0)  
flushLows = false  

//@function Removes the last element from the `id` stack when `cond` is `true`.  
array_pop(id, cond) => cond and array.size(id) > 0 ? array.pop(id) : float(na)  

if ta.rising(high, 1)  
    // Rising highs; push a new low on the stack.  
    lows.push(low)  
    // Force the return type of this `if` block to be the same as that of the next block.  
    bool(na)  
else if lows.size() >= 4 or low < array.min(lows)  
    // We have at least 4 lows or price has breached the lowest low;  
    // sort lows and set flag indicating we will plot and flush the levels.  
    array.sort(lows, order.ascending)  
    flushLows := true  

// If needed, plot and flush lows.  
lowLevel = array_pop(lows, flushLows)  
plot(lowLevel, "Low 1", low > lowLevel ? color.silver : color.purple, 2, plot.style_linebr)  
lowLevel := array_pop(lows, flushLows)  
plot(lowLevel, "Low 2", low > lowLevel ? color.silver : color.purple, 3, plot.style_linebr)  
lowLevel := array_pop(lows, flushLows)  
plot(lowLevel, "Low 3", low > lowLevel ? color.silver : color.purple, 4, plot.style_linebr)  
lowLevel := array_pop(lows, flushLows)  
plot(lowLevel, "Low 4", low > lowLevel ? color.silver : color.purple, 5, plot.style_linebr)  

if flushLows  
    // Clear remaining levels after the last 4 have been plotted.  
    lows.clear()  

```

--------------------------------

### Pine Script: Define Short Minute Session

Source: https://www.tradingview.com/pine-script-docs/concepts/sessions

This example defines a very short, one-minute session in Pine Script for Mondays and Fridays.

```pinescript
"1000-1001:26"
```

--------------------------------

### Pine Script: Draw Line and Labels Using Chart Points

Source: https://www.tradingview.com/pine-script-docs/language/type-system

This script demonstrates how to draw a line and labels on a TradingView chart using chart points. It utilizes `chart.point.from_index()` to define the starting point based on the previous bar's index and high, and `chart.point.now()` to define the ending point using the current bar's low. The line connects these two points, and labels are displayed at each point showing their respective price values.

```Pine Script
//@version=6  
indicator("Chart points demo", overlay = true)  

//@variable References a chart point containing the previous bar's `bar_index` and `high` values.  
firstPoint = chart.point.from_index(bar_index - 1, high[1])  
//@variable References a chart point containing the current bar's `bar_index`, `time`, and `low` values.  
chart.point secondPoint = chart.point.now(low)  

//@variable References a line connecting the coordinates from the objects referenced by `firstPoint` and `secondPoint`.   
line myLine = line.new(firstPoint, secondPoint, color = color.purple, width = 3)  

// Draw a label at the `index` and `price` coordinates of the chart point referenced by `firstPoint`.  
// The label displays a string representing the first chart point's `price` value.    
label.new(  
     firstPoint, str.tostring(firstPoint.price), color = color.green,  
     style = label.style_label_down, textcolor = color.white  
 )  

// Draw a label at the `index` and `price` coordinates of the chart point referenced by `secondPoint`.  
// The label displays a string representing the second chart point's `price` value.   
label.new(  
     secondPoint, str.tostring(secondPoint.price), color = color.red,  
     style = label.style_label_up, textcolor = color.white  
 )  
```

--------------------------------

### Pine Script: Dynamic SMA Calculation

Source: https://www.tradingview.com/pine-script-docs/release-notes

Shows an example of calculating a Simple Moving Average (SMA) with a dynamically determined length based on the average of `highestbars` and `lowestbars`. This allows for adaptive indicator calculations.

```Pine Script
//@version=4
study("My Script", overlay = true)
length = input(10, "Length", input.integer, minval = 1, maxval = 100)
avgBar = avg(highestbars(length), lowestbars(length))
float dynLen = nz(abs(avgBar) + 1, length)
dynSma = sma(close, int(dynLen))
plot(dynSma)

```

--------------------------------

### Pine Script: Error Example - Loop-Dependent Expression in request.security()

Source: https://www.tradingview.com/pine-script-docs/concepts/other-timeframes-and-data

This script demonstrates a common Pine Script error where the `expression` argument in `request.security()` depends on loop variables. This is not allowed and will cause a compilation error, as shown in the example.

```Pine Script
//@version=6  
indicator("Loop-dependent expression demo", format = format.volume)  
 
//@variable An array of "string" values representing different symbols to request.  
var array<string> symbols = array.from(  
    "EURUSD", "USDJPY", "GBPUSD", "AUDUSD", "USDCAD", "USDCHF", "NZDUSD", "EURJPY", "GBPJPY", "EURGBP"  
 )  
 
//@variable An array containing the data retrieved for each requested symbol.  
array<float> requestedData = array.new<float>()  
 
// Retrieve `volume` data for each symbol in the `symbols` array, weighted using the element index.  
// Causes a compilation error because the `expression` in `request.security()` cannot depend on loop variables  
// or mutable variables that change within the loop's scope.  
for [i, symbol] in symbols  
    float data = request.security("OANDA:" + symbol, timeframe.period, volume * (10 - i))  
    requestedData.push(data)  
 
// Calculate the average, maximum, and minimum tick volume in the `requestedData`.  
float avgVolume = requestedData.avg()  
float maxVolume = requestedData.max()  
float minVolume = requestedData.min()  
 
// Plot the `avgVolume`, `maxVolume`, and `minVolume`.  
plot(avgVolume, "Average volume", color.gray,   3)  
plot(maxVolume, "Highest volume", color.teal,   3)  
plot(minVolume, "Lowest volume",  color.maroon, 3)  

```

--------------------------------

### Pine Script: Bracket Order with R:R Ratio

Source: https://www.tradingview.com/pine-script-docs/faq/strategies

This Pine Script code demonstrates how to create a bracket order with a configurable risk-to-reward ratio. It uses inputs for stop loss size and R:R multiple, defines entry conditions based on moving average crossovers, and sets exit orders with calculated profit and loss levels. The script also visualizes the entry price, stop-loss price, and take-profit price.

```Pine Script
//@version=6  
strategy("R:R demo", overlay = true)

// Declare the stop size in ticks and the risk-to-reward ratio as inputs.
int  lossSizeInput  =  input.int(300,  "Loss size (in ticks)",  minval = 0)
float riskRewardInput =  input.float(2.0, "Risk/Reward multiple",  minval = 0)

// Create long and short entry conditions on MA crossover/crossunder, as long as we are not in a position.
float ma1 =  ta.sma(close, 14), float ma2 =  ta.sma(close, 28)
bool buyCondition  =  ta.crossover(ma1,  ma2) and strategy.position_size == 0
bool sellCondition =  ta.crossunder(ma1, ma2) and strategy.position_size == 0

// Place orders when `buyCondition` or `sellCondition` is true.
if buyCondition
    strategy.entry("buy", strategy.long)
if sellCondition
    strategy.entry("sell", strategy.short)

// Define exit point for the entries based on a predefined loss size.
// Calculate the profit target by multiplying the loss size with the user-defined risk-to-reward ratio.
strategy.exit("exit", loss = lossSizeInput, profit = lossSizeInput * riskRewardInput)

// Calculate the price equivalent of the profit and loss level.
float tradeBias     =  math.sign(strategy.position_size)
float stopLossPrice  =  strategy.position_avg_price - (tradeBias * lossSizeInput * syminfo.mintick)
float takeProfitPrice =  strategy.position_avg_price + (tradeBias * lossSizeInput * syminfo.mintick * riskRewardInput)

// Plot the entry price, the stop price, and the price of the take-profit order.
plotEntry =  plot(strategy.position_avg_price, "Entry price", color.new(color.gray, 70), style = plot.style_linebr)
plotStop  =  plot(stopLossPrice,            "Stop-loss price",  color.red,  style = plot.style_linebr)
plotTP  =  plot(takeProfitPrice,           "Take-profit price", color.green, style = plot.style_linebr)

// Highlight the R:R ratio by shading the area between the entry and the stop and the entry and the take-profit.
fill(plotStop, plotEntry, color.new(color.red,  80))
fill(plotTP, plotEntry, color.new(color.green, 80))
```

--------------------------------

### Pine Script: Get Map Keys and Values

Source: https://www.tradingview.com/pine-script-docs/language/maps

Demonstrates retrieving keys and values from a Pine Script map into arrays. The script displays the map size, keys, and values in a label, showcasing the preserved insertion order.

```Pine Script
//@version=6  
indicator("Keys and values demo")  

if bar_index % 50 == 0  
  //@variable A map containing pairs of `string` keys and `float` values.  
  m = map.new<string, float>()  

  // Put pairs into `m`. The map will maintain this insertion order.  
  m.put("First", math.round(math.random(0, 100)))   
  m.put("Second", m.get("First") + 1)   
  m.put("Third", m.get("Second") + 1)   

  //@variable An array containing the keys of `m` in their insertion order.  
  array<string> keys = m.keys()   
  //@variable An array containing the values of `m` in their insertion order.  
  array<float> values = m.values()   

  //@variable A label displaying the `size` of `m` and the `keys` and `values` arrays.  
  label debugLabel = label.new(  
      bar_index, 0,   
      str.format("Pairs: {0}\nKeys: {1}\nValues: {2}", m.size(), keys, values),   
      color = color.navy, style = label.style_label_center,   
      textcolor = color.white, size = size.huge  
  )   

```

--------------------------------

### Highlight Custom Trading Session with Pine Script

Source: https://www.tradingview.com/pine-script-docs/faq/times-dates-and-sessions

This Pine Script code defines a custom trading session based on user input and visualizes it on the chart. It draws vertical lines at the start and end times of the session and fills the area between them. The script also includes a label displaying the session's start and end times. It incorporates logic to find the next session if the current bar is outside any defined session and includes a runtime error for chart timeframes below 5 minutes.

```Pine Script
//@version=6  
indicator("Highlight trading session", overlay=true)  

string sessionInput = input.session("0900-1700:1234567", "Session")  

if timeframe.in_seconds(timeframe.period) < 300  
    runtime.error("This script only supports chart timeframes of 5 minutes or more.")  

// Keep track of when the session started.  
int sessionStart = na, int sessionEnd = na  
int barsSince = ta.barssince(na(time(timeframe.period, sessionInput)))

if barstate.islast  
    if na(time(timeframe.period, sessionInput))  // If this bar is not in a session..
       for i = 1 to 499  // ..search forward for the next session.  
         int barStartTime = time(timeframe.period, sessionInput, bars_back = -i)
         if not na(barStartTime) and na(sessionStart)
            sessionStart := barStartTime
         if not na(sessionStart) and na(barStartTime)
            sessionEnd := time_close(timeframe.period, sessionInput, bars_back = -(i - 1))
            break
  else  // If this bar is in a session..
       if na(barsSince)
         sessionStart := na
       else
         int startBack = barsSince - 1  // ..find the start of the session..
         sessionStart := time(timeframe.period, sessionInput, bars_back = startBack)
       for i = 1 to 499  // ..and search forwards for the end of the session.  
         int barStartTime = time(timeframe.period, sessionInput, bars_back = -i)
         if na(barStartTime) and na(sessionEnd)
            sessionEnd := time_close(timeframe.period, sessionInput, bars_back = -(i - 1))
            break  

if not na(sessionStart) and not na(sessionEnd)  // If we found the start and end of the session..
    // ..set up the drawings
    var line   left_line = na,   line.delete(left_line)
    var line   right_line = na,  line.delete(right_line)
    var linefill session_fill = na, linefill.delete(session_fill)
    var label   sessionLabel = na, label.delete(sessionLabel)
    // ..draw the lines
    left_line := line.new(x1 = sessionStart, y1 = low - syminfo.mintick, x2 = sessionStart, y2 = high + syminfo.mintick,
         xloc = xloc.bar_time, extend = extend.both, color = color.green, width = 2)
    right_line := line.new(x1 = sessionEnd, y1 = low - syminfo.mintick, x2 = sessionEnd, y2 = high + syminfo.mintick,
         xloc = xloc.bar_time, extend = extend.both, color = color.green, width = 2)
    // ..draw the fill
    session_fill := linefill.new(left_line, right_line, color.new(color.green, 90))
    // ..and draw a label to show the session times.  
    sessionLabel := label.new(x = sessionEnd, y = open, xloc = xloc.bar_time, yloc = yloc.price, text = "Start: " 
         +  str.format_time(sessionStart, "MM-dd HH:mm") + "\n" + "End: " 
         +  str.format_time(sessionEnd, "MM-dd HH:mm"), color = color.new(color.green, 50),
         style = label.style_label_left, textcolor = chart.fg_color, size = size.normal)

```

--------------------------------

### Pine Script Basic Strategy Example

Source: https://www.tradingview.com/pine-script-docs/language/script-structure

A basic Pine Script strategy that enters long positions on a crossover of two Simple Moving Averages and enters short positions on a crossunder. It includes strategy declaration, condition definitions, and order entry calls.

```Pine Script
//@version=6
strategy("My Strategy", overlay=true, margin_long=100, margin_short=100)

longCondition = ta.crossover(ta.sma(close, 14), ta.sma(close, 28))
if (longCondition)
    strategy.entry("My Long Entry Id", strategy.long)

shortCondition = ta.crossunder(ta.sma(close, 14), ta.sma(close, 28))
if (shortCondition)
    strategy.entry("My Short Entry Id", strategy.short)
```

--------------------------------

### Create Projection Fan with Multiple Lines

Source: https://www.tradingview.com/pine-script-docs/concepts/lines-and-boxes

Illustrates drawing a fan of lines using `line.new()` within a for loop. Each line projects a hypothetical price value for the next bar, based on the previous bar's hl2 and the current bar's high/low prices.

```Pine Script®
//@version=6  
indicator("Creating lines demo", "Simple projection fan", true, max_lines_count = 500)

//@variable The number of fan lines drawn on each chart bar.
int linesPerBar = input.int(20, "Line drawings per bar", 2, 100)

//@variable The distance between each y point on the current bar.
float step = (high - low) / (linesPerBar - 1)

//@variable The `chart.point` for the start of each line. Does not contain `time` information.
firstPoint = chart.point.from_index(bar_index - 1, hl2[1])
```

--------------------------------

### Pine Script Logical Operators: not, and, or

Source: https://www.tradingview.com/pine-script-docs/language/operators

Demonstrates the usage of Pine Script's logical operators: 'not' for negation, 'and' for conjunction, and 'or' for disjunction. Includes examples of their truth tables.

```Pine Script
a and b
a or b
not a
```

--------------------------------

### Pine Script: Reverse Matrix Elements

Source: https://www.tradingview.com/pine-script-docs/language/matrices

Illustrates reversing the order of all elements within a matrix using the matrix.reverse() function. The example creates a 3x3 matrix, reverses it, and displays both the original and reversed versions.

```Pine Script
//@version=6
indicator("Reversing demo")

//@function Displays the rows of a matrix in a label with a note.
//@param    this The matrix to display.
//@param    barIndex The `bar_index` to display the label at.
//@param    bgColor The background color of the label.
//@param    textColor The color of the label's text.
//@param    note The text to display above the rows.
method debugLabel(
    matrix<float> this, int barIndex = bar_index, color bgColor = color.blue,
    color textColor = color.white, string note = ""
 ) =>
      labelText = note + "\n" + str.tostring(this)
      if barstate.ishistory
            label.new(
                   barIndex, 0, labelText, color = bgColor, style = label.style_label_center,
                   textcolor = textColor, size = size.huge
             )

//@variable A 3x3 matrix.
matrix<float> m = matrix.new<float>()

// Add rows to `m`.
m.add_row(0, array.from(1, 2, 3))
m.add_row(1, array.from(4, 5, 6))
m.add_row(2, array.from(7, 8, 9))

if bar_index == last_bar_index - 1
      // Display the contents of `m`.
      m.debugLabel(note = "Original")
      // Reverse `m`, then display its contents.
      m.reverse()
      m.debugLabel(bar_index + 10, color.red, note = "Reversed")
```

--------------------------------

### Profile Code Block

Source: https://www.tradingview.com/pine-script-docs/writing/profiling-and-optimization

Pseudocode illustrating the Profiler's method for wrapping a block of Pine Script code. It captures the start time before the block and registers the elapsed time and line range after execution.

```Pine Script
long _startX = System.timeNow()  
<code_block_to_analyze>  
registerPerf(System.timeNow() - _startX, lineX, lineY)  

```

--------------------------------

### Display Time Information in a Table using Pine Script

Source: https://www.tradingview.com/pine-script-docs/concepts/time

This snippet shows how to create and populate a table in Pine Script to display formatted start and end times, along with the calculated time span between them. It utilizes `table.new` for table creation and `displayTable.cell` for adding content.

```pinescript
if barstate.islastconfirmedhistory
    //@variable A table that that displays formatted start and end times and their custom-formatted time difference.
    var table displayTable = table.new(position.middle_center, 1, 2, color.aqua)
    //@variable A "string" containing formatted `startTimeInput` and `endTimeInput` values.
    string timeText = "Start date and time: "     + str.format_time(startTimeInput, "dd/MM/yy HH:mm:ss (z)")
                         + "\n  End date and time: " + str.format_time(endTimeInput, "dd/MM/yy HH:mm:ss (z)")
    //@variable A "string" representing the span between `startTimeInput` and `endTimeInput` in mixed time units.
    string userTimeSpan = formatTimeSpan(
        startTimeInput, endTimeInput, weeksInput, daysInput, hoursInput, minutesInput, secondsInput, millisecondsInput
    )
    // Display the `timeText` in the table.
    displayTable.cell(0, 0, timeText,
         text_color = color.white, text_size = size.large, text_halign = text.align_left)
    // Display the `userTimeSpan` in the table.
    displayTable.cell(0, 1, "Time span: " + userTimeSpan,
          text_color = color.white, text_size = size.large, text_halign = text.align_left, bgcolor = color.navy)
```

--------------------------------

### Pine Script: Get Matrix Element and Display in Table

Source: https://www.tradingview.com/pine-script-docs/language/loops

This snippet demonstrates how to retrieve a value from a 2D array (taMatrix) using get(i, j) and then display it as a formatted string in a table cell. It specifies the column, row, text content, and text color for the table cell.

```Pine Script
//@variable
The value stored in the `taMatrix` at the `i` row and `j` column.  
float elementValue =  taMatrix.get(i, j)
// Initialize a cell in the `displayTable` at the `i + 2` row and `j + 1` column showing a "string"  
// representation of the `elementValue`.  
displayTable.cell(
    column = j + 1, row = i + 2, text = str.tostring(elementValue, "#.##"), text_color = chart.fg_color
)
```

--------------------------------

### Pine Script: Vertical Alignment for Declarations

Source: https://www.tradingview.com/pine-script-docs/writing/style-guide

Shows how to use vertical alignment with tabs or spaces for Pine Script code sections, particularly useful for declaring constants or inputs to facilitate easier mass edits.

```Pine Script
`// Colors used as defaults in inputs.  
color COLOR_AQUA  = #0080FFff  
color COLOR_BLACK = #000000ff  
color COLOR_BLUE  = #013BCAff  
color COLOR_CORAL = #FF8080ff  
color COLOR_GOLD  = #CCCC00ff  
`
```

--------------------------------

### Pine Script: Place a Stop Order

Source: https://www.tradingview.com/pine-script-docs/concepts/strategies

This Pine Script code demonstrates how to place a stop order. It activates a new market order when the price reaches a specified level. The example includes drawing labels and lines to visualize the stop price and order activation.

```Pine Script
//@version=6  
strategy("Stop order demo", overlay = true, margin_long = 100, margin_short = 100)

//@function Displays text passed to `txt` when called and shows the `price` level on the chart.
debugLabel(price, txt) =>
    label.new(
      bar_index, high, text = txt, color = color.teal, textcolor = color.white,
      style = label.style_label_lower_right, size = size.large
    )
    line.new(bar_index, high, bar_index, price, style = line.style_dotted, color = color.teal)
    line.new(
      bar_index, price, bar_index + 1, price, color = color.teal, extend = extend.right,
      style = line.style_dashed
    )


// Generate a long stop order with a label and lines 100 bars before the last bar.
if last_bar_index - bar_index == 100
    stopPrice = close + syminfo.mintick * 800
    debugLabel(stopPrice, "Long Stop order created")
    strategy.entry("Long", strategy.long, stop = stopPrice)
```

--------------------------------

### Pine Script: User-Defined Type (UDT) for Objects

Source: https://www.tradingview.com/pine-script-docs/faq/programming

This Pine Script example demonstrates the creation and usage of a user-defined type (UDT) to define an object structure. It shows how to declare a type, create an instance of that type, and access its fields.

```Pine Script
//@version=5  
indicator("Object demo")  

// Define a new type named `pivot`.  
type pivot  
    int   x  
    float y  
    bool   isHigh  
  
// Create a new `pivot` with specific values.  
pivot newPivot = pivot.new(bar_index, close, true)  

// Plot the `y` component of `newPivot`.  
plot(newPivot.y)  

```

--------------------------------

### Pine Script Plot Count Example

Source: https://www.tradingview.com/pine-script-docs/writing/limitations

Demonstrates various Pine Script functions and their respective plot count usage. This example illustrates how different arguments and function calls affect the total plot count, with a focus on functions like plot, plotarrow, plotbar, plotcandle, plotchar, plotshape, alertcondition, bgcolor, and fill.

```Pine Script
//\t//@version=6  
//tindicator("Plot count example")  
//t 
//tbool isUp = close > open  
//tcolor isUpColor = isUp ? color.green : color.red  
//tbool isDn = not isUp  
//tcolor isDnColor = isDn ? color.red : color.green  
//t 
//t//tUses one plot count each.  
//tp1 = plot(close, color = color.white)  
//tp2 = plot(open, color = na)  
//t 
//t//tUses two plot counts for the `close` and `color` series.  
//tplot(close, color = isUpColor)  
//t 
//t//tUses one plot count for the `close` series.  
//tplotarrow(close, colorup = color.green, colordown = color.red)  
//t 
//t//tUses two plot counts for the `close` and `colorup` series.  
//tplotarrow(close, colorup = isUpColor)  
//t 
//t//tUses three plot counts for the `close`, `colorup`, and the `colordown` series.  
//tplotarrow(close - open, colorup = isUpColor, colordown = isDnColor)  
//t 
//t//tUses four plot counts for the `open`, `high`, `low`, and `close` series.  
//tplotbar(open, high, low, close, color = color.white)  
//t 
//t//tUses five plot counts for the `open`, `high`, `low`, `close`, and `color` series.  
//tplotbar(open, high, low, close, color = isUpColor)  
//t 
//t//tUses four plot counts for the `open`, `high`, `low`, and `close` series.  
//tplotcandle(open, high, low, close, color = color.white, wickcolor = color.white, bordercolor = color.purple)  
//t 
//t//tUses five plot counts for the `open`, `high`, `low`, `close`, and `color` series.  
//tplotcandle(open, high, low, close, color = isUpColor, wickcolor = color.white, bordercolor = color.purple)  
//t 
//t//tUses six plot counts for the `open`, `high`, `low`, `close`, `color`, and `wickcolor` series.  
//tplotcandle(open, high, low, close, color = isUpColor, wickcolor = isUpColor , bordercolor = color.purple)  
//t 
//t//tUses seven plot counts for the `open`, `high`, `low`, `close`, `color`, `wickcolor`, and `bordercolor` series.  
//tplotcandle(open, high, low, close, color = isUpColor, wickcolor = isUpColor , bordercolor = isUp ? color.lime : color.maroon)  
//t 
//t//tUses one plot count for the `close` series.  
//tplotchar(close, color = color.white, text = "|", textcolor = color.white)  
//t 
//t//tUses two plot counts for the `close`` and `color` series.  
//tplotchar(close, color = isUpColor, text = "—", textcolor = color.white)  
//t 
//t//tUses three plot counts for the `close`, `color`, and `textcolor` series.  
//tplotchar(close, color = isUpColor, text = "O", textcolor = isUp ? color.yellow : color.white)  
//t 
//t//tUses one plot count for the `close` series.  
//tplotshape(close, color = color.white, textcolor = color.white)  
//t 
//t//tUses two plot counts for the `close` and `color` series.  
//tplotshape(close, color = isUpColor, textcolor = color.white)  
//t 
//t//tUses three plot counts for the `close`, `color`, and `textcolor` series.  
//tplotshape(close, color = isUpColor, textcolor = isUp ? color.yellow : color.white)  
//t 
//t//tUses one plot count.  
//talertcondition(close > open, "close > open", "Up bar alert")  
//t 
//t//tUses one plot count.  
//tbgcolor(isUp ? color.yellow : color.white)  
//t 
//t//tUses one plot count for the `color` series.  
//tfill(p1, p2, color = isUpColor)  
```

--------------------------------

### Pine Script: Remove Rows and Columns from Matrix

Source: https://www.tradingview.com/pine-script-docs/language/matrices

Demonstrates removing specific rows and columns from a Pine Script matrix using `matrix.remove_row()` and `matrix.remove_col()`. This example builds upon the previous insertion example, showing how removing elements affects the matrix's dimensions and index values, visualized with the `debugLabel` function.

```Pine Script
// Removing example

// Remove the first row (index 0) and the last column (index 3) from the matrix.
// The matrix will now have 3 rows and 3 columns.
m.remove_row(0)

m.remove_col(3)

// Display the matrix after removals, indicating the changes.
debugLabel(m, bar_index + 30, color.red, note = "Removed row 0\nand column 3")
```

--------------------------------

### Pine Script: Demo History Referencing for Open Price

Source: https://www.tradingview.com/pine-script-docs/language/execution-model

This script demonstrates how to retrieve and plot the current bar's open price, the previous bar's open price, and an open price from a user-specified number of bars back using the history-referencing operator `[]`. It helps visualize how past data is accessed.

```Pine Script
//@version=6  
indicator("History referencing demo", overlay = true, behind_chart = false)  
 
//@variable The number of bars back from which to retrieve the `open` price for `pastOpen`. 
int offsetInput = input.int(10, "Bar offset", 0)  
 
//@variable The current bar's opening price. `open[0]` is equivalent to using `open` without the `[]` operator. 
float currOpen = open[0]  
//@variable The last committed `open` value. Represents the previous bar's value, or `na` if no previous bar exists. 
float prevOpen = open[1]  
//@variable The `open` value committed `offsetInput` bars back, or `na` if no bar exists at that offset. 
float pastOpen = open[offsetInput]  
 
// Plot `currOpen`, `prevOpen`, and `pastOpen` for comparison. 
plot(currOpen, "Current `open`",              color.blue,  2) 
plot(prevOpen, "Previous bar `open`",          color.purple,  3) 
plot(pastOpen, "Past `open` from custom offset", color.orange,  4) 
```

--------------------------------

### Pine Script Math Functions (v4/v5)

Source: https://www.tradingview.com/pine-script-docs/migration-guides/to-pine-version-5

Details mathematical functions available in Pine Script, including their v4 and v5 syntax. These functions cover basic arithmetic, trigonometry, and rounding operations.

```Pine Script
abs(x)
math.abs(number)
acos(x)
math.acos(number)
asin(x)
math.asin(number)
atan(x)
math.atan(number)
avg()
math.avg()
ceil(x)
math.ceil(number)
cos(x)
math.cos(angle)
exp(x)
math.exp(number)
floor(x)
math.floor(number)
log(x)
math.log(number)
log10(x)
math.log10(number)
max()
math.max()
min()
math.min()
pow()
math.pow()
random()
math.random()
round(x, precision)
math.round(number, precision)
round_to_mintick(x)
math.round_to_mintick(number)
sign(x)
math.sign(number)
sin(x)
math.sin(angle)
sqrt(x)
math.sqrt(number)
sum()
math.sum()
tan(x)
math.tan(angle)
todegrees()
math.todegrees()
toradians()
math.toradians()
```

--------------------------------

### Pine Script: Strategy.exit() Qty Percent Behavior Change

Source: https://www.tradingview.com/pine-script-docs/release-notes

Demonstrates the updated behavior of the `qty_percent` parameter in `strategy.exit()`. Percentages now apply to the initial position size, not the remaining position, for successive exit orders.

```Pine Script
//@version=5
strategy("strategy.exit() example", overlay = true)
strategy.entry("Long", strategy.long, qty = 100)
strategy.exit("Exit Long1", "Long", trail_points = 50, trail_offset = 0, qty_percent = 20)
strategy.exit("Exit Long2", "Long", trail_points = 100, trail_offset = 0, qty_percent = 20)

```

--------------------------------

### Pine Script: Plot upward arrow using plotshape()

Source: https://www.tradingview.com/pine-script-docs/concepts/text-and-shapes

This example demonstrates using plotshape() to display a pre-defined upward arrow shape below bars that meet specific rising conditions, similar to the plotchar() example. It utilizes the `shape.arrowup` argument for the style parameter.

```Pine Script
//@version=6  
indicator("", "", true)  
longSignal = ta.rising(close, 2) and ta.rising(high, 2) and (na(volume) or ta.rising(volume, 2))  
plotshape(longSignal, "Long", shape.arrowup, location.belowbar)  

```

--------------------------------

### Pine Script: Conditional Background and Bar Coloring

Source: https://www.tradingview.com/pine-script-docs/writing/debugging

Demonstrates using `bgcolor()` and `barcolor()` functions in Pine Script to visually indicate conditions. This example highlights the chart background and bar color when the closing price is rising over two bars.

```Pine Script
//@version=6  
indicator("Common debug outputs - Background and bar colors")  

//@variable Is `true` if the `close` is rising over 2 bars.  
bool risingPrice = ta.rising(close, 2)  

// Highlight the chart background and color the main chart bars based on `risingPrice`.  
bgcolor(risingPrice ? color.new(color.green, 70) : na, title= "`risingPrice` highlight")  
barcolor(risingPrice ? color.aqua : chart.bg_color, title = "`risingPrice` bar color")  
```

--------------------------------

### Pine Script Integer Input with Minval

Source: https://www.tradingview.com/pine-script-docs/concepts/inputs

Illustrates the use of the input.int() function with the 'minval' parameter to set a minimum allowed value for an integer input. This example restricts the length input for an SMA to be at least 2.

```Pine Script
//@version=6  
indicator("MA", "", true)  
maLengthInput = input.int(10, minval = 2)  
ma = ta.sma(close, maLengthInput)  
plot(ma)  

```

--------------------------------

### Conditional Execution and Performance Registration

Source: https://www.tradingview.com/pine-script-docs/writing/profiling-and-optimization

Illustrates pseudocode for handling conditional logic (`if`, `else if`) and registering performance metrics for each branch. It shows how the profiler estimates time spent in conditional statements.

```pseudocode
long _start22 = System.timeNow() // Start time for the `if` block that begins on line 22.
if lcg.generate(10) < 0.5 // `if` statement is not independently wrapped.

    long _start23 = System.timeNow() // Start time for line 23.
    val0 *= 1.0 + (2.0 * lcg.generate(50) - 1.0) * 0.1
    registerPerf(System.timeNow() - _start23, line23) // Register performance info for line 23.

else if lcg.generate(10) < 0.5 // `else if` statement is not independently wrapped.

    long _start25 = System.timeNow() // Start time for line 25.
    val1 *= 1.0 + (2.0 * lcg.generate(50) - 1.0) * 0.1
    registerPerf(System.timeNow() - _start25, line25) // Register performance info for line 25.

else if lcg.generate(10) < 0.5 // `else if` statement is not independently wrapped.

    long _start27 = System.timeNow() // Start time for line 27.
    val2 *= 1.0 + (2.0 * lcg.generate(50) - 1.0) * 0.1
    registerPerf(System.timeNow() - _start27, line27) // Register performance info for line 27.

registerPerf(System.timeNow() - _start22, line22, line28) // Register performance info for the block (line 22 - 28).
```

--------------------------------

### Pine Script: Error example with const string requirement

Source: https://www.tradingview.com/pine-script-docs/language/type-system

This Pine Script example illustrates a compilation error that occurs when a 'simple string' variable is used where a 'const string' is required, specifically for the 'title' argument of the indicator() function. It shows that combining a literal string with a runtime value like syminfo.ticker results in a 'simple string'.

```Pine Script
//\@version=6  
  
//@variable Holds a value intended for use as the `title` argument in the `indicator()` call.  
//         However, this variable's type is "simple string", not "const string", because  
//         the value of `syminfo.ticker` is not available until *after* compilation.  
var scriptTitle = "My indicator for " + syminfo.ticker  
  
// This statement causes an error. The `indicator()` statement cannot use a "simple string"  
// value as its `title` argument. It requires a "const string" value.  
indicator(title = scriptTitle)  
  
plot(close - open)  

```

--------------------------------

### Pine Script: Using Keyword Arguments Correctly

Source: https://www.tradingview.com/pine-script-docs/language/built-ins

Demonstrates the correct way to use keyword arguments in Pine Script functions, allowing for reordering of arguments as long as all arguments are specified using keywords or the initial positional arguments are not skipped.

```Pine Script
indicator("Example", "Ex", true, max_bars_back = 100)
```

--------------------------------

### Pine Script: Plot Equity and Highlight Open Positions

Source: https://www.tradingview.com/pine-script-docs/concepts/strategies

This Pine Script example demonstrates how to plot the strategy's total equity over time and conditionally highlight the background of the chart pane when there is an open position. The background color changes based on whether the open position is profitable or not.

```pine-script
// 	Plot 	the 	current 	equity 	in 	a 	separate 	pane 	and 	highlight 	the 	pane's 	background 	while 	there 	is 	an 	open 	position.  
plot(strategy.equity, 	"Total 	equity", 	strategy.equity 	> 	strategy.initial_capital 	? 	color.teal 	: 	color.maroon, 	3)  
bgcolor(  
			strategy.openprofit 	> 	0 	? 	color.new(color.teal, 	80) 	: 	strategy.openprofit 	< 	0 	? 	color.new(color.maroon, 	80) 	: 	na, 	  
			title 	= 	"Open 	position 	highlight"  
		)  
```

--------------------------------

### Pine Script Strategy with Persistent Exits

Source: https://www.tradingview.com/pine-script-docs/concepts/strategies

This script defines a trading strategy that places multiple entry orders within a specified time frame and a single exit order that applies to all open entries. It uses `strategy.entry()` for entries and `strategy.exit()` without a `from_entry` argument for a persistent exit. The script also includes input parameters for start, exit, and end times, runtime error handling for invalid time ranges, and visual indicators using labels and `bgcolor()` to mark significant events.

```Pine Script
//@version=6
strategy("Exit persist demo", overlay = true, margin_long = 100, margin_short = 100, pyramiding = 100)

//@variable The time when order creation starts. 
int entryStartTime = input.time(0, "Start time for entries", confirm = true)
//@variable The time when the `strategy.exit()` call occurs. 
int exitCallTime = input.time(0, "Exit call time", confirm = true)
//@variable The time when order creation stops. 
int entryEndTime = input.time(0, "End time for entries", confirm = true)

// Raise a runtime error if incorrect timestamps are chosen. 
if exitCallTime <= entryStartTime or entryEndTime <= exitCallTime or entryEndTime <= entryStartTime
    runtime.error("The input timestamps must follow this condition: entryStartTime < exitCallTime < entryEndTime.")

// Create variables to track entry and exit conditions. 
bool entriesStart = time == entryStartTime
bool callExit    = time == exitCallTime
bool entriesEnd  = time == entryEndTime
bool callEntry   = time >= entryStartTime and time < entryEndTime

// Place a long entry order when `callEntry` is `true`. 
if callEntry
    strategy.entry("Entry", strategy.long)

// Call `strategy.exit()` when `callExit` is `true`, which occurs only once. 
// This single call persists and creates exit orders for EVERY entry in the position because it does not 
// specify a `from_entry` ID. 
if callExit
    strategy.exit("Exit", loss = 0)

// Draw labels to signify when entries start, when the `strategy.exit()` call occurs, and when order placement stops. 
switch 
    entriesStart => label.new(
       bar_index, high, "Start placing entry orders.", color = color.green, textcolor = color.white, 
       style = label.style_label_lower_right, size = size.large
    ) 
    callExit => label.new(
       bar_index, high, "Call `strategy.exit()` once.", color = color.blue, textcolor = color.white, 
       style = label.style_label_lower_right, size = size.large
    ) 
    entriesEnd => label.new(
       bar_index, high, "Stop placing orders.", color = color.red, textcolor = color.white, 
       style = label.style_label_lower_left, size = size.large
    ) 

// Create a line and label to visualize the lowest entry price, i.e., the price required to close the position. 
var line lowestLine = line.new(
    entryStartTime + 1000, na, entryEndTime, na, xloc.bar_time, extend.right, color.orange, width = 2
    )
var lowestLabel = label.new(
    entryStartTime + 1000, na, "Lowest entry price", color = color.orange, 
      style = label.style_label_upper_right, xloc = xloc.bar_time
    )

// Update the price values of the `lowestLine` and `lowestLabel` after each new entry. 
if callEntry[1]
    var float lowestPrice = strategy.opentrades.entry_price(0)
    float entryPrice = strategy.opentrades.entry_price(strategy.opentrades - 1)
    if not na(entryPrice)
       lowestPrice := math.min(lowestPrice, entryPrice)
       lowestLine.set_y1(lowestPrice)
       lowestLine.set_y2(lowestPrice)
       lowestLabel.set_y(lowestPrice)

// Highlight the background when `entriesStart`, `callExit`, and `entriesEnd` occurs. 
bgcolor(entriesStart ? color.new(color.green, 80) : na, title = "Entries start highlight")
bgcolor(callExit ? color.new(color.blue, 80) : na, title = "Exit call highlight")
bgcolor(entriesEnd ? color.new(color.red, 80) : na, title = "Entries end highlight")
```

--------------------------------

### Pine Script: Demo of Avoiding Redrawing with Boxes

Source: https://www.tradingview.com/pine-script-docs/writing/profiling-and-optimization

This Pine Script code demonstrates the performance difference between redrawing boxes and updating their properties using setter functions. It initializes two arrays of boxes on the first bar and then, on each subsequent bar, it either deletes and recreates boxes or updates existing ones. The example highlights that updating properties is more efficient.

```Pine Script
`
```

--------------------------------

### Profile Single Line of Code

Source: https://www.tradingview.com/pine-script-docs/writing/profiling-and-optimization

Pseudocode demonstrating how the Profiler wraps a single line of Pine Script code to measure its execution time. It records the start time before the code and registers the elapsed time and line number after execution.

```Pine Script
long _startX = System.timeNow()  
<code_line_to_analyze>  
registerPerf(System.timeNow() - _startX, lineX)  

```

--------------------------------

### Pine Script: Define Weekday Session

Source: https://www.tradingview.com/pine-script-docs/concepts/sessions

This example shows how to define a 24-hour session that only applies from Monday to Friday in Pine Script.

```pinescript
"0000-0000:23456"
```

--------------------------------

### Pine Script: Define Specific Day Session

Source: https://www.tradingview.com/pine-script-docs/concepts/sessions

This example defines a session from 9:30 to 17:00 specifically for Sundays, Wednesdays, and Fridays using Pine Script.

```pinescript
"0930-1700:146"
```

--------------------------------

### Pine Script Variable Declarations using =

Source: https://www.tradingview.com/pine-script-docs/language/operators

Demonstrates various valid ways to declare and assign initial values to variables in Pine Script using the `=` assignment operator.

```Pine Script
i = 1
MS_IN_ONE_MINUTE = 1000 * 60
showPlotInput = input.bool(true, "Show plots")
pHi = ta.pivothigh(5, 5)
plotColor = color.green
```

--------------------------------

### Pine Script Enum Input with Limited Options

Source: https://www.tradingview.com/pine-script-docs/concepts/inputs

Illustrates how to restrict the options available in an input.enum() dropdown by providing an 'options' argument. This example limits the 'SignalType' selection to only 'long' and 'short' signals.

```Pine Script
SignalType sigInput = input.enum(SignalType.long, "Signal type", options = [SignalType.long, SignalType.short])

```

--------------------------------

### Pine Script v5 Duplicate Parameter Warning

Source: https://www.tradingview.com/pine-script-docs/migration-guides/to-pine-version-6

Shows how Pine Script v5 handles duplicate parameters in function calls. It compiles with a warning, and only the first specified value for a parameter is used.

```Pine Script
// In v5, compiles but raises warning. Only uses first value, so plot color will be `blue`. 
plot(close, "Close", color = color.blue, linewidth = 2, color = color.red) 

```

--------------------------------

### Pine Script Tuple Declaration Example

Source: https://www.tradingview.com/pine-script-docs/language/variable-declarations

Shows how to use tuple declarations in Pine Script to simultaneously declare multiple variables from a function that returns multiple values, such as the Bollinger Bands function.

```Pine Script
[bbMiddle, bbUpper, bbLower] = ta.bb(close, 5, 4)  

```

--------------------------------

### Pine Script: Calling a function with multiple return values

Source: https://www.tradingview.com/pine-script-docs/language/user-defined-functions

Shows the syntax for calling a function that returns multiple values and assigning them to separate variables. The example plots the two returned values.

```Pine Script
[res0, res1] = fun(open, close)
plot(res0)
plot(res1)
```

--------------------------------

### Return Tuple from Switch Statement in Pine Script

Source: https://www.tradingview.com/pine-script-docs/language/type-system

Illustrates an equivalent switch statement that returns a two-item tuple, similar to the if statement example. This showcases alternative syntax for returning multiple values.

```Pine Script
[v1, v2] = switch
    close > open => [high, close]
    =>           [close, low]

```

--------------------------------

### Pine Script: Define Multi-Period Session

Source: https://www.tradingview.com/pine-script-docs/concepts/sessions

This example demonstrates a Pine Script session string that includes two distinct time periods within a single day, with a break in between.

```pinescript
"0900-1600,1700-2000"
```

--------------------------------

### Pine Script Variable Type Qualifiers Example

Source: https://www.tradingview.com/pine-script-docs/release-notes

Demonstrates the usage of 'const', 'simple', and 'series' type qualifiers for variable declaration in Pine Script. This allows for explicit control over variable types and their behavior across chart bars.

```Pine Script
//@version=5
indicator("My script")

//@variable A constant `string` used as the `title` in the `plot()` function.
const string plotTitle = "My plot"
//@variable An `int` variable whose value is consistent after the first chart bar.
simple int a = 10
//@variable An `int` variable whose value can change on every bar.
series int b = bar_index

plot(b % a, title = plotTitle)
```

--------------------------------

### Persistent na Result Demo

Source: https://www.tradingview.com/pine-script-docs/language/type-system

An example script demonstrating how 'na' values can cause issues in calculations, specifically with the math.max() function when comparing 'na' with other values.

```Pine Script
//@version=6  
indicator("Persistent `na` result demo", overlay = true)  
  
```

--------------------------------

### Plot Weighted Average in Pine Script

Source: https://www.tradingview.com/pine-script-docs/writing/debugging

Calculates and plots a weighted moving average with custom weights. This example demonstrates basic plotting of a calculated series on the chart.

```Pine Script
//@version=6  
indicator("Plotting without affecting the scale demo", "Weighted average", true, precision = 5)  

//@variable The number of bars in the average.  
int lengthInput = input.int(20, "Length", 1)  

//@variable The weight applied to the price on each bar.  
float weight = math.pow(close - open, 2)  

//@variable The numerator of the average.  
float numerator = math.sum(weight * close, lengthInput)  
//@variable The denominator of the average.  
float denominator = math.sum(weight, lengthInput)  

//@variable The weighted average over `lengthInput` bars.  
float average = numerator / denominator  

// Plot the `average`.  
plot(average, "Weighted average", linewidth = 3)  

```

--------------------------------

### Pine Script® - Managing Recent Prices

Source: https://www.tradingview.com/pine-script-docs/migration-guides/to-pine-version-6

This code snippet demonstrates initializing an array `data` to store recent closing prices, using `dequeue` to remove old data when the array reaches a limit, and `queue` to add new data. It then iterates through the array to count how many prices are below the `ohlc4` value and plots this count.

```Pine Script®
// Variable to hold recent close prices
var array<float> data = array.new<float>()

// Variable to count prices below OHLC4
int belowCount = 0

// Remove oldest element if array size reaches limit
data.dequeue()

// Add current close price to the array and get the new size minus 1
int lastCount = data.queue(close) - 1

// Loop through the array to count prices below OHLC4
for i = 0 to lastCount
    if data.get(i) < ohlc4
        belowCount += 1

// Plot the count of prices below OHLC4
plot(belowCount, "Closes below OHLC4", color.blue, 3)
```

--------------------------------

### Pine Script Generic Input Examples

Source: https://www.tradingview.com/pine-script-docs/concepts/inputs

Demonstrates the usage of the generic input() function in Pine Script, showcasing how it supports different data types including integers, floats, booleans, colors, strings, and source values. The function automatically detects the input type based on the default value provided.

```Pine Script
//@version=6  
indicator("`input()`", "", true)  
a = input(1, "input int")  
b = input(1.0, "input float")  
c = input(true, "input bool")  
d = input(color.orange, "input color")  
e = input("1", "input string")  
f = input(close, "series float")  
plot(na)  

```

--------------------------------

### Pine Script Ticker Creation Functions (v4/v5)

Source: https://www.tradingview.com/pine-script-docs/migration-guides/to-pine-version-5

Details functions for creating custom tickers in Pine Script, with v4 and v5 syntax. These are useful for applying different chart types or creating unique data series.

```Pine Script
heikinashi()
ticker.heikinashi()
kagi()
ticker.kagi()
linebreak()
ticker.linebreak()
pointfigure()
ticker.pointfigure()
renko()
ticker.renko()
tickerid()
ticker.new()
```

--------------------------------

### Pine Script Indicator for Empirical Distribution

Source: https://www.tradingview.com/pine-script-docs/language/methods

This is the main indicator script that sets up inputs for source, length, and steps. It then queues the source data, normalizes it, calculates the eCDF, and displays the results using a custom label function. It also includes background coloring for the last 'length' bars.

```Pine Script
//@version=6  
indicator("Empirical Distribution", overlay = true)

float sourceInput = input.source(close, "Source")
int length       = input.int(20, "Length")
int n          = input.int(20, "Steps")

// @function        Maintains a queue of the size of `srcArray`.
//          It appends a `value` to the array and removes its oldest element at position zero.
// @param srcArray  (array<float>) The array where the queue is maintained.
// @param value     (float) The new value to be added to the queue.
//          The queue's oldest value is also removed, so its size is constant.
// @param takeSample (bool) A new `value` is only pushed into the queue if this is true.
// @returns        (array<float>) `srcArray` object.
method maintainQueue(array<float> srcArray, float value, bool takeSample = true) =>
    if takeSample
      srcArray.push(value)
      srcArray.shift()
  srcArray

// @function        Replaces elements in a `srcArray` between `lowerBound` and `upperBound` with an `innerValue`,
//          and replaces elements outside the range with an `outerValue`.
// @param srcArray   (array<float>) Array to modify.
// @param innerValue  (float) Value to replace elements within the range with.
// @param outerValue  (float) Value to replace elements outside the range with.
// @param lowerBound  (float) Lowest value to replace with `innerValue`.
// @param upperBound  (float) Highest value to replace with `innerValue`.
// @returns        (array<float>) `srcArray` object.
method fill(array<float> srcArray, float innerValue, float outerValue, float lowerBound, float upperBound) =>
    for [i, element] in srcArray
      if (element >= lowerBound or na(lowerBound)) and (element <= upperBound or na(upperBound))
        srcArray.set(i, innerValue)
    else
      srcArray.set(i, outerValue)
  srcArray

// @function        Estimates the empirical CDF of a `srcArray`.
// @param srcArray (array<float>) Array to calculate on.
// @param steps    (int) Number of steps in the estimation.
// @returns        (array<float>) Array of estimated CDF ratios.
method eCDF(array<float> srcArray, int steps) =>
    float min = srcArray.min()
    float rng = srcArray.range() / steps
    array<float> cdfArray = array.new<float>()
    // Add averages of `srcArray` filtered by value region to the `cdfArray`.
    float val = min
    for i = 1 to steps
      val += rng
      cdfArray.push(srcArray.copy().fill(1.0, 0.0, min, val).avg())
  cdfArray

// @function        Rescales the elements within a `srcArray` to the interval [0, 1].
// @param srcArray  (array<float>) Array to normalize.
// @returns        (array<float>) Normalized copy of the `srcArray`.
method featureScale(array<float> srcArray) =>
    float min = srcArray.min()
    float rng = srcArray.range()
    array<float> scaledArray = array.new<float>()
    // Push normalized `element` values into the `scaledArray`.
    for element in srcArray
      scaledArray.push((element - min) / rng)
  scaledArray

// @function        Draws a label containing eCDF estimates in the format "{price}: {percent}%"
// @param srcArray  (array<float>) Array of source values.
// @param cdfArray  (array<float>) Array of CDF estimates.
// @returns        (void)
makeLabel(array<float> srcArray, array<float> cdfArray) =>
    float max    = srcArray.max()
    float rng    = srcArray.range() / cdfArray.size()
    string results = ""
    var label lbl  = label.new(0, 0, "", style = label.style_label_left, text_font_family = font.family_monospace)
    // Add percentage strings to `results` starting from the `max`.
    cdfArray.reverse()
    for [i, element] in cdfArray
      results += str.format("{0}:  {1}%
", max - i * rng, element * 100)
    // Update `lbl` attributes.
    lbl.set_xy(bar_index + 1, srcArray.avg())
    lbl.set_text(results)

var array<float> sourceArray = array.new<float>(length)

// Add background color for the last `length` bars.
bgcolor(bar_index > last_bar_index - length ? color.new(color.orange, 80) : na)

// Queue `sourceArray`, feature scale, then estimate the distribution over `n` steps.
array<float> distArray = sourceArray.maintainQueue(sourceInput).featureScale().eCDF(n)
// Draw label.
makeLabel(sourceArray, distArray)

```

--------------------------------

### Log UDT Field Data for Debugging

Source: https://www.tradingview.com/pine-script-docs/writing/debugging

This script extends the previous example by adding logging functionality to inspect the internal state of the UDT object. It uses `log.info()` and `log.warning()` to display the contents of the 'prices', 'times', and 'sampleMult' fields in the Pine Logs pane, aiding in script verification and debugging.

```Pine Script
//@version=6
indicator("Debugging objects of UDTs demo")

//@type              A structure for storing time and price information once every `sampleMult` bars.
//@field prices      References an array of "float" price values.
//@field times       References an array of "int" UNIX timestamps.
//@field sampleMult  Number of bars per sample.
type Data
    array<float> prices
    array<int>   times
    int          sampleMult

//@variable The initial seed for the `math.random()` function.
int seedInput = input.int(1234, "Seed", 1)

//@variable References a `Data` object with arrays of 10 elements and a random `sampleMult` value.
var Data data = Data.new(array.new<float>(10), array.new<int>(10), int(math.random(1, 11, seedInput)))

// Queue new data through the `prices` and `times` arrays of the `Data` object once every `data.sampleMult` bars.
if bar_index % data.sampleMult == 0
    data.prices.push(close)
    data.times.push(time)
    data.prices.shift()
    data.times.shift()

    // Log formatted text containing information from the `Data` object's `prices`, `times`, and `sampleMult`
    // fields with the "info" or "warning" level.
    string fString = "Data object fields:\n\nprices: {0}\n\ntimes: {1}\n\nsampleMult: {2}\n-------"
    switch
        barstate.isconfirmed => log.info(fString, str.tostring(data.prices), str.tostring(data.times), data.sampleMult)
        => log.warning(fString, str.tostring(data.prices), str.tostring(data.times), data.sampleMult)

//@variable The time-based slope calculated from the `data` array fields.
float slope = array.covariance(data.prices, data.times) / data.times.variance()

// Plot the `slope` value.
plot(slope, "Slope", slope > 0 ? color.teal : color.maroon, 3)
```

--------------------------------

### Pine Script Minimum Quantifier {n,}

Source: https://www.tradingview.com/pine-script-docs/concepts/strings

Explains the minimum quantifier {n,}, which matches a pattern at least n times consecutively. The example demonstrates matching one or more 'a' characters followed by two or more 'b' characters.

```Pine Script
regex.test("a{1,}b{2,}", "aaabbbb")
```

--------------------------------

### Pine Script: Conditional Order Entry (v5 vs v6)

Source: https://www.tradingview.com/pine-script-docs/migration-guides/to-pine-version-6

Demonstrates the removal of the 'when' parameter in Pine Script v6 for conditional order creation. In v5, the 'when' parameter was used, while in v6, 'if' statements are required to achieve the same conditional logic.

```Pine Script
// v5 example
//@version=5  
strategy("Conditional strategy", overlay=true)  

longCondition = ta.crossover(ta.sma(close, 14), ta.sma(close, 28))  
strategy.entry("My Long Entry Id", strategy.long, when = longCondition)  

shortCondition = ta.crossunder(ta.sma(close, 14), ta.sma(close, 28))  
strategy.entry("My Short Entry Id", strategy.short, when = shortCondition)  
```

```Pine Script
// v6 example
//@version=6  
strategy("Conditional strategy", overlay=true)  

longCondition = ta.crossover(ta.sma(close, 14), ta.sma(close, 28))  
if longCondition  
    strategy.entry("My Long Entry Id", strategy.long)  

shortCondition = ta.crossunder(ta.sma(close, 14), ta.sma(close, 28))  
if shortCondition  
    strategy.entry("My Short Entry Id", strategy.short)  
```

--------------------------------

### Pine Script v6 Strategy Order Trimming and Access

Source: https://www.tradingview.com/pine-script-docs/migration-guides/to-pine-version-6

Illustrates a Pine Script v6 strategy that manages order limits by trimming excess orders. It shows how to track total orders, access the first non-trimmed trade using `strategy.closedtrades.first_index`, and demonstrates that referencing trimmed trades returns `na`.

```Pine Script
//@version=6  
strategy("Strategy order limit demo", overlay=true, pyramiding=5)  

//@variable Count of total orders placed.  
var int totalOrders = 0  

// Place several long orders on every even bar.  
if bar_index % 2 == 0  
    for i = 1 to 5  
        strategy.entry("Entry " + str.tostring(i), strategy.long, qty = 5)  
        totalOrders += 1  
// Place short orders on every odd bar.  
else  
    strategy.entry("Short", strategy.short, qty = 25)  
    totalOrders += 1  

// Display total orders and index of first non-trimmed trade in a table cell on last bar.  
if barstate.islastconfirmedhistory  
    var table t = table.new(position.bottom_right, 1, 3, color.yellow, color.black, 1)  
    // Display total orders and closed trades counts.  
    string ordersText = "Total orders: " + str.tostring(totalOrders, "#,###")  
         + "\n Closed trades: " + str.tostring(strategy.closedtrades, "#,###")  
    t.cell(0, 0, ordersText, text_halign = text.align_right, text_size = size.large)  

    // Display the first non-trimmed trade index and its entry price.  
    string firstTradeIndex = str.tostring(strategy.closedtrades.first_index, "#,###")  
    string firstTradePrice = str.tostring(strategy.closedtrades.entry_price(strategy.closedtrades.first_index), "$##.##")  
    string firstTradeText = str.format("Index of first non-trimmed trade: {0}\nEntry price of trade #{0}: {1}", firstTradeIndex, firstTradePrice)  
    t.cell(0, 1, firstTradeText, text_halign = text.align_right, text_size = size.large, bgcolor = #61dd5165)  

    // Trying to reference the trimmed trades (e.g., first closed trade) returns `na`.  
    if totalOrders > 9000  
        string trimmedTradePrice = "Entry price of trade #0: " + str.tostring(strategy.closedtrades.entry_price(0))  
        t.cell(0, 2, trimmedTradePrice, text_size = size.large, bgcolor = #dd51c665)  

```

--------------------------------

### Pine Script: Plotting Array Size from Multiple Contexts

Source: https://www.tradingview.com/pine-script-docs/writing/profiling-and-optimization

This example demonstrates plotting the array size from both the chart's context and a '1D' timeframe context simultaneously. It requires two arrays and executes operations across both datasets, impacting script execution counts.

```Pine Script
//@version=6
indicator("When requesting other contexts demo")

//@variable An array containing the `close` value from every available price update.
varip array<float> pricesArray = array.new<float>()

// Push a new `close` value into the `pricesArray` on each update.
array.push(pricesArray, close)

// Plot the size of the `pricesArray` from the daily timeframe and the chart's context.
// Including both in the outputs requires executing line 5 and line 8 across BOTH datasets.
plot(request.security(syminfo.tickerid, "1D", array.size(pricesArray)), "Total number of daily price updates")
plot(array.size(pricesArray), "Total number of chart price updates")

```

--------------------------------

### Pine Script Multiline Mode

Source: https://www.tradingview.com/pine-script-docs/concepts/strings

The `m` modifier enables multiline mode, causing `^` and `$` to match the start and end of any line within the string, not just the entire string.

```Pine Script
(?m)^abc
```

--------------------------------

### Pine Script Bollinger Bands with Array Methods

Source: https://www.tradingview.com/pine-script-docs/language/methods

This script calculates Bollinger Bands using Pine Script's array methods, such as `sourceArray.push()`, `sourceArray.shift()`, `sourceArray.avg()`, and `sourceArray.stdev()`. This approach offers a more concise syntax by calling methods directly on the array object.

```Pine Script
//@version=6  
indicator("Custom Sample BB", overlay = true)  
  
float sourceInput  = input.source(close, "Source")  
int   samplesInput = input.int(20, "Samples")  
int   n            = input.int(10, "Bars")  
float multiplier   = input.float(2.0, "StdDev")  
  
var array<float> sourceArray = array.new<float>(samplesInput)  
var float        sampleMean  = na  
var float        sampleDev   = na  
  
// Identify if `n` bars have passed.  
if bar_index % n == 0  
    // Update the queue.  
    sourceArray.push(sourceInput)  
    sourceArray.shift()  
    // Update the mean and standard deviation values.  
    sampleMean  := sourceArray.avg()  
    sampleDev   := sourceArray.stdev() * multiplier  
  
// Calculate band values.  
float highBand = sampleMean + sampleDev  
float lowBand  = sampleMean - sampleDev  
  
plot(sampleMean, "Basis", color.orange)  
plot(highBand, "Upper", color.lime)  
plot(lowBand, "Lower", color.red)  

```

--------------------------------

### Pine Script: Set Max Labels Count

Source: https://www.tradingview.com/pine-script-docs/writing/limitations

This example demonstrates how to set the maximum number of recent labels shown on the chart to 100 using the `max_labels_count` parameter in the `indicator` declaration.

```Pine Script
//@version=6
indicator("Label limits example", max_labels_count = 100, overlay = true)
label.new(bar_index, high, str.tostring(high, format.mintick))
```

--------------------------------

### Pine Script: Alertcondition with Plot Placeholders

Source: https://www.tradingview.com/pine-script-docs/concepts/alerts

This example shows how to use plot placeholders within the message argument of alertcondition(). It demonstrates referencing plot values by their index and by their title.

```Pine Script
alertcondition(volume > ta.sma(volume,20), "Volume alert", "Volume ({{plot_0}}) > average ({{plot_1}})")  

```

```Pine Script
//@version=6  
indicator("")  
r = ta.rsi(close, 14)  
xUp = ta.crossover(r, 50)  
plot(r, "RSI", display = display.none)  
alertcondition(xUp, "xUp alert", message = 'RSI is bullish at: {{plot("RSI")}}')  

```

--------------------------------

### Pine Script: Demo for Minimizing Historical Buffer Calculations

Source: https://www.tradingview.com/pine-script-docs/writing/profiling-and-optimization

This Pine Script example demonstrates minimizing historical buffer calculations by drawing a histogram of source values over 500 bars. It uses a for loop to look back through historical values and calculates chart points for a polyline. The script also plots the number of bars executed to verify buffer calculation efficiency.

```Pine Script

```

--------------------------------

### Pine Script: Nested if statements

Source: https://www.tradingview.com/pine-script-docs/language/conditional-structures

Shows an example of nested 'if' statements, where a condition within another condition is checked. It also advises against deep nesting for performance reasons.

```Pine Script
if condition1  
    if condition2  
        if condition3  
            expression  

```

--------------------------------

### Pine Script Strategy Margin Calculation Example

Source: https://www.tradingview.com/pine-script-docs/concepts/strategies

Demonstrates the calculation of margin call size for a Supertrend Strategy on NASDAQ:TSLA with specific order size and margin settings. It shows how the emulator liquidates shares when the price drops, preventing further losses.

```Pine Script
// Example calculation steps for margin call:
// 1. Money Spent = Quantity * Entry Price
// 2. MVS = Position Size * Current Price
// 3. Open Profit = MVS - Money Spent (or -1 * difference if short)
// 4. Equity = Initial Capital + Net Profit + Open Profit
// 5. Margin Ratio = Margin Percent / 100
// 6. Margin = MVS * Margin Ratio
// 7. Available Funds = Equity - Margin
// 8. Loss = Available Funds / Margin Ratio
// 9. Cover Amount = TRUNCATE(Loss / Current Price)
// 10. Margin Call Size = Cover Amount * 4
```

--------------------------------

### Pine Script Strategy Using Default Size When Qty is Zero

Source: https://www.tradingview.com/pine-script-docs/concepts/strategies

This example modifies the previous script to use the strategy's default order size when the specified `longAmount` or `shortAmount` is 0. It uses ternary expressions to conditionally set the `qty` argument in `strategy.entry()`.

```Pine Script
//@version=6
strategy("Buy low, sell high", overlay = true, default_qty_type = strategy.cash, default_qty_value = 5000)

int   length      = input.int(20, "Length", 1)
float longAmount  = input.float(0.0, "Long Amount", 0.0)
float shortAmount = input.float(0.0, "Short Amount", 0.0)

float highest = ta.highest(length)
float lowest  = ta.lowest(length)

switch
    low == lowest   => strategy.entry("Buy", strategy.long, longAmount == 0.0 ? na : longAmount)
    high == highest => strategy.entry("Sell", strategy.short, shortAmount == 0.0 ? na : shortAmount)

```

--------------------------------

### Pine Script Trailing Stop Order Demo

Source: https://www.tradingview.com/pine-script-docs/concepts/strategies

This Pine Script code demonstrates a trailing stop order. It sets up a long entry and then uses strategy.exit() with trail_price and trail_offset to create a trailing stop that activates at a specified level and trails the price by a certain number of ticks. The script also includes visual aids like labels and plots to show the activation level and the trailing stop's movement.

```Pine Script
//@version=6  
strategy("Trailing stop order demo", overlay = true,  margin_long = 100,  margin_short = 100)  
 
//@variable The distance from the entry price required to activate the trailing stop.  
int activationOffsetInput = input.int(1000, "Activation level offset (in ticks)", 0)  
//@variable The distance the stop follows behind the highest `high` after activation.  
int trailOffsetInput = input.int(2000, "Trailing stop offset (in ticks)", 0)  
 
//@variable Draws a label and an optional line at the specified `price`.  
debugDrawings(float price,  string txt,  color drawingColor,  bool drawLine = false) =>  
    // Draw a label showing the `txt` at the `price` on the current bar.  
    label.new(  
       bar_index,  price,  text = txt,  color = drawingColor,  textcolor = color.white,  
       style = label.style_label_lower_right,  size = size.large  
    )  
    // Draw a horizontal line at the `price` starting from the current bar when `drawLine` is `true`.  
    line.new(  
       bar_index,  price,  bar_index + 1,  price,  color = drawingColor,  extend = extend.right,  
       style = line.style_dashed  
    )  
 
//@variable The level required to activate the trailing stop.  
var float activationLevel = na  
//@variable The price of the trailing stop.  
var float trailingStop = na  
//@variable The value that the trailing stop would have if it was currently active.  
float theoreticalStopPrice = high - trailOffsetInput * syminfo.mintick  
 
// Place a long market order 100 bars before the last historical bar.  
if last_bar_index - bar_index == 100  
  strategy.entry("Long", strategy.long)  
 
// Create and visualize the exit order on the next bar.  
if last_bar_index - bar_index == 99  
  // Update the `activationLevel`.  
  activationLevel := open + syminfo.mintick * activationOffsetInput  
  // Create the trailing stop order that activates at the `activationLevel` and trails behind the `high` by  
  // `trailOffsetInput` ticks.  
  strategy.exit(  
    "Trailing Stop", from_entry = "Long", trail_price = activationLevel,  
    trail_offset = trailOffsetInput  
  )  
  // Create drawings to signify the activation level.  

```

--------------------------------

### Pine Script: Check Substrings for Spread Symbol and Bar Replay

Source: https://www.tradingview.com/pine-script-docs/concepts/strings

This example demonstrates using str.startswith() to validate a spread symbol input and str.contains() to detect Bar Replay mode. It constructs a spread symbol, requests security data, and plots candles with conditional coloring based on the replay mode.

```Pine Script
//@version=6
indicator("Checking for substrings demo")

//@variable A spread symbol created from two symbol inputs. The first input is an empty string by default.
var string spreadInput = input.symbol("", "Symbol 1") + " / " + input.symbol("BATS:SPY", "Symbol 2")

//@variable Is `true` if the `spreadInput` starts with ` /`, meaning the first input is empty.
var bool missingNumerator = str.startswith(spreadInput, " /")
//@variable A copy of the spreadInput` that inserts the chart's standard ticker ID when `missingNumerator` is `true`.
var string spread = missingNumerator ? str.replace(spreadInput, " /", ticker.standard() + " /") : spreadInput

// Request a tuple of OHLC data from the `spread` context.
[o, h, l, c] = request.security(" " + spread, "", [open, high, low, close])

//@variable Is `true` if the chart's ticker ID contains `replay`, meaning Bar Replay mode is active.
var bool isReplay = str.contains(syminfo.tickerid, "replay")

// Define variable to hold colors for up and down candles. Their values depend on whether `isReplay` is `true`.
var color upColor = isReplay ? color.blue : color.teal
var color dnColor = isReplay ? color.maroon : color.red

// Plot the candles in a separate pane.
plotcandle(o, h, l, c, "Spread candles", c > o ? upColor : dnColor)

// Log the original `spreadInput`, the final `spread` value, and the `isReplay` value` in the Pine Logs pane.
if barstate.isfirst
    log.info("\n\nOriginal input: {0}\nFinal spread: {1}\nReplay chart: {2}", spreadInput, spread, isReplay)
```

--------------------------------

### Pine Script: Create Timestamp with UTC Timezone

Source: https://www.tradingview.com/pine-script-docs/concepts/time

This example shows how to create a Unix timestamp explicitly using UTC as the timezone with the `timestamp()` function. The formatted output reflects the UTC conversion.

```pinescript
printCell(0, 4, "`dateTimestamp4`", "header")
printCell(1, 4, "`timestamp(\"UTC0\", 2021, 1, 1, 0, 0)`", "code")
printCell(2, 4, str.tostring(dateTimestamp4))
printCell(3, 4, str.format_time(dateTimestamp4, "yyyy.MM.dd  HH:mm (Z)"))
```

--------------------------------

### Pine Script Data Request Functions (v4/v5)

Source: https://www.tradingview.com/pine-script-docs/migration-guides/to-pine-version-5

Lists functions for requesting external data in Pine Script, showing v4 and v5 syntax. These are used to fetch financial, economic, and historical data.

```Pine Script
financial()
request.financial()
quandl()
request.quandl()
security(<...>, resolution, <...>)
request.security(<...>, timeframe, <...>)
splits()
request.splits()
dividends()
request.dividends()
earnings()
request.earnings()
```

--------------------------------

### Plot Debug Series Without Scale Impact in Pine Script

Source: https://www.tradingview.com/pine-script-docs/writing/debugging

Plots the main average along with debug plots for weight, numerator, and denominator. This example shows how to plot multiple series, which can affect readability if not managed.

```Pine Script
//@version=6  
indicator("Plotting without affecting the scale demo", "Weighted average", true, precision = 5)  

//@variable The number of bars in the average.  
int lengthInput = input.int(20, "Length", 1)  

//@variable The weight applied to the price on each bar.  
float weight = math.pow(close - open, 2)  

//@variable The numerator of the average.  
float numerator = math.sum(weight * close, lengthInput)  
//@variable The denominator of the average.  
float denominator = math.sum(weight, lengthInput)  

//@variable The weighted average over `lengthInput` bars.  
float average = numerator / denominator  

// Plot the `average`.  
plot(average, "Weighted average", linewidth = 3)  

// Create debug plots for the `weight`, `numerator`, and `denominator`.  
plot(weight,      "weight",      color.purple)  
plot(numerator,   "numerator",   color.teal)  
plot(denominator, "denominator", color.maroon)  

```

--------------------------------

### Pine Script Chained Ternary Operators for Multiple Conditions

Source: https://www.tradingview.com/pine-script-docs/language/operators

Provides an example of chaining ternary operators in Pine Script to achieve behavior similar to a switch statement, evaluating multiple conditions sequentially.

```Pine Script
timeframe.isintraday ? color.red : timeframe.isdaily ? color.green : timeframe.ismonthly ? color.blue : na
```

--------------------------------

### Pine Script: Set Take-Profit and Stop-Loss Orders

Source: https://www.tradingview.com/pine-script-docs/concepts/strategies

This example demonstrates setting take-profit and stop-loss orders using the strategy.exit() command in Pine Script. It defines exit prices based on a percentage of the entry price and plots these levels on the chart. The code includes logic to update and reset these exit levels.

```Pine Script
`//@version=6  
strategy("Take-profit and stop-loss demo", overlay = true)  
 
//@variable Is `true` on every 100th bar.  
bool buyCondition = bar_index % 100 == 0  
 
//@variable The current take-profit order price.   
var float takeProfit = na 
//@variable The current stop-loss order price.   
var float stopLoss = na 
 
if buyCondition 
    // Update the `takeProfit` and `stopLoss` values.   
    if strategy.opentrades == 0 
       takeProfit := close * 1.01 
       stopLoss   := close * 0.99 
    // Place a long market order.   
    strategy.entry("buy", strategy.long) 
    // Place a take-profit order at the `takeProfit` price and a stop-loss order at the `stopLoss` price.   
    strategy.exit("exit", "buy", limit = takeProfit, stop = stopLoss) 
 
// Set `takeProfit` and `stopLoss` to `na` when the position closes.   
if ta.change(strategy.closedtrades) > 0 
    takeProfit := na 
    stopLoss   := na 
 
// Plot the `takeProfit` and `stopLoss` values.   
plot(takeProfit, "TP", color.green, style = plot.style_circles) 
plot(stopLoss, "SL", color.red, style = plot.style_circles) 
`
```

--------------------------------

### Pine Script: Create Static JSON Alerts

Source: https://www.tradingview.com/pine-script-docs/faq/alerts

This example demonstrates creating JSON messages for alerts using static strings in Pine Script. It defines separate alert conditions with predefined JSON payloads for buy and sell signals based on EMA crossovers.

```Pine Script
// Define EMA cross conditions to trigger alerts, and plot the ema on the chart.
float ema = ta.ema(close, 21)
bool crossUp 		= ta.crossover(close, ema)
bool crossDown 		= ta.crossunder(close, ema)
plot(ta.ema(close, 21))

// ————— Method 1 - Separate alerts with static messages. 
string alertMessage1a = '{"method": 1, "action": "buy", "direction": "long", "text": "Price crossed above EMA"}'
string alertMessage1b = '{"method": 1, "action": "sell", "direction": "short", "text": "Price crossed below EMA"}'
alertcondition(crossUp, 		"Method 1 - Cross up", 		alertMessage1a)
alertcondition(crossDown, 	"Method 1 - Cross down", alertMessage1b)
```

--------------------------------

### Pine Script: `input()` Function with Options Argument

Source: https://www.tradingview.com/pine-script-docs/release-notes

The `options` argument for the `input()` function, added in April 2017, allows script authors to define a predefined set of choices for user inputs, improving user experience and script control.

```Pine Script
// Example of input() with options
maType = input(title="Moving Average Type", defval="SMA", options=["SMA", "EMA", "WMA"])

// Use maType in your script logic
```

--------------------------------

### Pine Script: Get Previous Bar Close Time

Source: https://www.tradingview.com/pine-script-docs/concepts/time

Demonstrates how to retrieve the closing time of the previous bar on price-based charts using the `time_close()` function with the `bar_back` argument.

```Pine Script
time_close(bar_back = 1)
```

--------------------------------

### Pine Script: Same-Bar Exit with calc_on_order_fills

Source: https://www.tradingview.com/pine-script-docs/faq/strategies

This script demonstrates setting stop-loss and take-profit orders on the same bar as the entry using the `calc_on_order_fills = true` strategy setting. It calculates exit levels based on the average entry price and plots the stop-loss and take-profit levels.

```Pine Script
//@version=6  
strategy("Exit demo using `calc_on_order_fills`", overlay = true, calc_on_order_fills = true)  
  
float stopSizeInput   = input.float(1.0, "SL %", minval = 0.0) / 100.0  
float profitSizeInput = input.float(1.0, "TP %", minval = 0.0) / 100.0  
  
//@variable Is `true` on every 100th bar.  
bool buyCondition = bar_index % 100 == 0  
  
//@variable Stop-loss price for exit commands.  
var float stopLoss   = na  
//@variable Take-profit price for exit commands.  
var float takeProfit = na  
  
// Place orders when `buyCondition` is true and we are not in a position.  
if buyCondition and strategy.position_size == 0.0  
    strategy.entry("buy", strategy.long)  
  
// If we are in a position, set the exit orders.  
if strategy.position_size != 0.0  
    stopLoss   := strategy.position_avg_price * (1.0 - stopSizeInput)  
    takeProfit := strategy.position_avg_price * (1.0 + profitSizeInput)  
    strategy.exit("exit", "buy", stop = stopLoss, limit = takeProfit)  
  
// Set `stopLoss` and `takeProfit` to `na` when price touches either, i.e., when the strategy simulates an exit.  
if low <= stopLoss or high >= takeProfit  
    stopLoss   := na  
    takeProfit := na  
  
plot(stopLoss,   "SL", color.red,   style = plot.style_linebr)  
plot(takeProfit, "TP", color.green, style = plot.style_linebr)  
```

--------------------------------

### Pine Script Alert Placeholders

Source: https://www.tradingview.com/pine-script-docs/release-notes

Introduces new alert placeholders for accessing symbol currency information. `{{syminfo.currency}}` retrieves the currency code, and `{{syminfo.basecurrency}}` gets the base currency code for currency pair symbols.

```Pine Script
syminfo.currency
syminfo.basecurrency
```

--------------------------------

### Pine Script: Create Float Array using Template

Source: https://www.tradingview.com/pine-script-docs/release-notes

Demonstrates the creation of a float array using the new template syntax `array.new<float>()`. This example initializes an array with a specified length and a default value, then manipulates it by removing the oldest element and adding a new one in each iteration.

```Pine Script
//@version=5
indicator("array.new<float> example")
length = 5
var a = array.new<float>(length, close)
if array.size(a) == length
    array.remove(a, 0)
    array.push(a, close)
plot(array.sum(a) / length, "SMA")
```

--------------------------------

### Pine Script: Demonstrate Global and Local Scope

Source: https://www.tradingview.com/pine-script-docs/faq/programming

This example demonstrates the concept of global and local variable scope in Pine Script. It shows how accessing a local variable from the global scope results in an 'Undeclared identifier' error.

```Pine Script
//@version=5  
indicator("Scope demo")  

// Global scope  
int globalValue = close > open ? 1 : -1  

if barstate.isconfirmed  
  // Local scope  
  int localValue = close > open ? 1 : -1  

plot(localValue, "Local variable", chart.fg_color, 2)  

```

--------------------------------

### Pine Script Strategy: Order Execution Demo

Source: https://www.tradingview.com/pine-script-docs/concepts/strategies

This Pine Script strategy demonstrates order execution by creating a long market order every 20 bars and closing all open positions. It includes a helper function `debugLabel` to display messages on the chart and utilizes `strategy.entry()` for entering trades and `strategy.close_all()` for exiting.

```Pine Script
//@version=6  
strategy("Order execution demo", "My strategy", true, margin_long = 100, margin_short = 100)  
 
//@function Displays the specified `txt` in a label at the `high` of the current bar.   
debugLabel(string txt) =>   
      label.new(         bar_index, high, text = txt, color=color.lime, style = label.style_label_lower_right,         textcolor = color.black, size = size.large         )   
 
//@variable Is `true` on every 20th bar, `false` otherwise.   
bool longCondition = bar_index % 20 == 0   
 
// Draw a label and place a long market order when `longCondition` occurs.   
if longCondition 
    debugLabel("Long entry order created")   
    strategy.entry("My Long Entry Id", strategy.long)   
 
// Place a closing market order whenever there is an open position.   
strategy.close_all() 
```

--------------------------------

### Plot with User Input Color in Pine Script

Source: https://www.tradingview.com/pine-script-docs/concepts/plots

This example illustrates how to allow users to select the plot color through an input option. The `input()` function is used to define a color input.

```Pine Script
//@version=6  
indicator("", "", true)  
color lineColorInput  = input(#1848CC, "Line color")  
plot(close, color = lineColorInput)
```

--------------------------------

### Create pivotPoint object in Pine Script®

Source: https://www.tradingview.com/pine-script-docs/language/objects

Demonstrates creating a new object from the `pivotPoint` UDT. It shows instantiation with default values and with specified values for the `x` and `y` fields.

```Pine Script®
foundPoint = pivotPoint.new()  

```

```Pine Script®
foundPoint = pivotPoint.new(time, high)  

```

```Pine Script®
foundPoint = pivotPoint.new(x = time, y = high)  

```

--------------------------------

### Reverse Array in Pine Script

Source: https://www.tradingview.com/pine-script-docs/language/arrays

Demonstrates how to reverse the order of elements in an array using the array.reverse() function. The example initializes an array, adds elements, and then reverses it, displaying the result using a label.

```Pine Script
//@version=6  
indicator("`array.reverse()`")  
a = array.new<float>(0)  
array.push(a, 0)  
array.push(a, 1)  
array.push(a, 2)  
if barstate.islast  
    array.reverse(a)   
    label.new(bar_index, 0, "a: " + str.tostring(a))   
```

--------------------------------

### Pine Script Valid Identifiers

Source: https://www.tradingview.com/pine-script-docs/language/identifiers

Demonstrates valid identifier names in Pine Script, including variables and functions. Identifiers must start with a letter or underscore and can be followed by letters, underscores, or digits. They are case-sensitive.

```Pine Script
myVar
_myVar
my123Var
functionName
MAX_LEN
max_len
maxLen
```

--------------------------------

### Pine Script: Initial Strategy Setup without OCA Cancel

Source: https://www.tradingview.com/pine-script-docs/concepts/strategies

This Pine Script code sets up a basic strategy that places two stop orders when moving averages cross and no position is open. It does not utilize the `strategy.oca.cancel` feature, which can lead to both stop orders filling before a potential `strategy.close_all()` call.

```Pine Script
//@version=6  
strategy("OCA Cancel Demo", overlay=true)  
  
float ma1 = ta.sma(close, 5)  
float ma2 = ta.sma(close, 9)  
  
if ta.cross(ma1, ma2)  
    if strategy.position_size == 0  
        strategy.order("Long",  strategy.long, stop = high)  
        strategy.order("Short", strategy.short, stop = low)  
    else  
        strategy.close_all()  
  
plot(ma1, "Fast MA", color.aqua)  
plot(ma2, "Slow MA", color.orange)  

```

--------------------------------

### Pine Script: Demonstrate Integer Division Behavior

Source: https://www.tradingview.com/pine-script-docs/migration-guides/to-pine-version-6

Illustrates how integer division differs in Pine Script v5 and v6, particularly with 'const int' versus 'input int' types. It shows how v5 truncates fractional parts for 'const int' division, while v6 preserves them. The code also demonstrates casting results to 'int' to achieve truncation.

```Pine Script
//\t//@version=5  
//tindicator("`int` division demo")  
//t 
//t//t`float` division produces fractional remainder in both v5 and v6.  
//tplot( 5.0 / 2.0, "`float` values", color.blue)  
//t 
//t//t`const int` division produces rounded-down result in v5. In v6, it produces a fractional remainder.  
//tplot( 5 / 2,           "`const int` values",     color.orange)  
//tplot( int(5) / int(2), "values wrapped `int()`", color.red)  
//t 
//t//t Wrapped `int()` division produces rounded down result in both v5 and v6.  
//tplot( int(5 / 2), "result wrapped `int()`", color.green)  
//t 
//t//t Using `input int` type in division preserves the fractional remainder in both v5 and v6.  
//tinputNum = input.int(2, "Division int", minval = 1)  
//tplot( 5 / inputNum, "`input int` value", color.purple)
```

--------------------------------

### Pine Script Float Input for Bollinger Bands

Source: https://www.tradingview.com/pine-script-docs/concepts/inputs

Demonstrates the use of input.float() with 'minval' and 'step' parameters to define a floating-point input for calculating Bollinger Bands. This example sets a factor for the standard deviation calculation, allowing values like 0.5, 1.0, 1.5, etc.

```Pine Script
//@version=6  
indicator("MA", "", true)  
maLengthInput = input.int(10, minval = 1)  
bbFactorInput = input.float(1.5, minval = 0, step = 0.5)  
ma      = ta.sma(close, maLengthInput)  
bbWidth = ta.stdev(ma, maLengthInput) * bbFactorInput  
bbHi    = ma + bbWidth  
bbLo    = ma - bbWidth  
plot(ma)  
plot(bbHi, "BB Hi", color.gray)  
plot(bbLo, "BB Lo", color.gray)  

```

--------------------------------

### Pine Script: Insert Rows and Columns into Matrix

Source: https://www.tradingview.com/pine-script-docs/language/matrices

Illustrates how to dynamically insert rows and columns into a Pine Script matrix using `matrix.add_row()` and `matrix.add_col()`. The example shows the matrix's shape changes and element values after each insertion, using a `debugLabel` function to visualize the process step-by-step.

```Pine Script
//@version=6
indicator("Rows and columns demo")

// Helper function to display matrix rows in a label.
method debugLabel(matrix<float> this, int barIndex = bar_index, color bgColor = color.blue, color textColor = color.white, string note = "") =>
    labelText = note + "\n" + str.tostring(this)
    if barstate.ishistory
        label.new(
            barIndex, 0, labelText, color = bgColor, style = label.style_label_center,
            textcolor = textColor, size = size.huge
        )

// Create an empty matrix.
var m = matrix.new<float>()

// Execute matrix operations on the last bar before the current one for demonstration.
if bar_index == last_bar_index - 1
    // Display the initial empty matrix.
    debugLabel(m, bar_index - 30, note = "Empty matrix")

    // Insert an array at row 0. Matrix becomes 1x3.
    m.add_row(0, array.from(5, 6, 7))
    debugLabel(m, bar_index - 20, note = "New row at\nindex 0")

    // Insert an array at row 1. Matrix becomes 2x3.
    m.add_row(1, array.from(9, 10, 11))
    debugLabel(m, bar_index - 10, note = "New row at\nindex 1")

    // Insert an array at row 0. Matrix becomes 3x3, shifting existing rows.
    m.add_row(0, array.from(1, 2, 3))
    debugLabel(m, bar_index, note = "New row at\nindex 0")

    // Insert an array at column 3. Matrix becomes 3x4.
    m.add_col(3, array.from(4, 8, 12))
    debugLabel(m, bar_index + 10, note = "New column at\nindex 3")

    // Insert an array at row 3. Matrix becomes 4x4.
    m.add_row(3, array.from(13, 14, 15, 16))
    debugLabel(m, bar_index + 20, note = "New row at\nindex 3")

```

--------------------------------

### Pine Script: Persistent Execution Counter

Source: https://www.tradingview.com/pine-script-docs/language/execution-model

Initializes and increments a persistent variable `executionNum` using `varip`. This variable tracks the number of times the script has executed, starting from -1 and incrementing by 1 on each execution.

```Pine Script
//@variable Tracks the current execution number, where 0 represents the first execution. 
varip int executionNum = -1 
```

```Pine Script
// Add 1 to the `executionNum` value. 
executionNum += 1
```

--------------------------------

### Pine Script Indicator with Timeframe Input

Source: https://www.tradingview.com/pine-script-docs/concepts/inputs

Shows how to set indicator properties like timeframe and timeframe_gaps using parameters in the indicator() function. This example sets the timeframe to 'D' (daily) and disables timeframe gaps.

```Pine Script
//@version=6
indicator("MA", "", true, timeframe = "D", timeframe_gaps = false)
plot(ta.vwma(close, 10))

```

--------------------------------

### Using a Library in an Indicator

Source: https://www.tradingview.com/pine-script-docs/concepts/libraries

An example of a Pine Script indicator that utilizes an imported library. It plots the highest high and lowest low values obtained from the library's functions, including a case where the 'close' price is passed as an argument.

```Pine Script
//@version=6
indicator("Using AllTimeHighLow library", "", true)
import PineCoders/AllTimeHighLow/1 as allTime

plot(allTime.hi())
plot(allTime.lo())
plot(allTime.hi(close))
```

--------------------------------

### Script Sharing and Community Features

Source: https://www.tradingview.com/pine-script-docs/release-notes

Covers the implementation of Pine Script sharing, enabling users to share their scripts within the TradingView community. Also mentions improvements to script discovery and organization.

```Pine Script
// Script sharing functionality is integrated into the platform.
```

--------------------------------

### Pine Script: Draw Line with Max Bars Forward

Source: https://www.tradingview.com/pine-script-docs/writing/limitations

This example demonstrates how to draw a line using bar index x-coordinates and limit the number of bars forward it can be projected using the `maxval` parameter in `input.int()`.

```Pine Script
`
```

--------------------------------

### Pine Script: Plotting BarsInRange (Used Code)

Source: https://www.tradingview.com/pine-script-docs/writing/profiling-and-optimization

This Pine Script example plots the `barsInRange` value, making the previously unused calculations now relevant. The compiler includes these calculations, and the Profiler will display performance information for them.

```Pine Script®
//@version=6  
indicator("Unused code demo")  

//@variable The number of historical bars in the calculation.  
int lengthInput = input.int(100, "Length", 1)  

//@variable The number of closes over `lengthInput` bars between the current bar's `high` and `low`.  
int barsInRange = 0  

for i = 1 to lengthInput  
    //@variable The `close` price from `i` bars ago.    
    float pastClose = close[i]  
    // Add 1 to `barsInRange` if the `pastClose` is between the current bar's `high` and `low`.  
    if pastClose > low and pastClose < high    
      barsInRange += 1  

// Plot the `barsInRange` value. The above calculations will execute since the output requires them.  
plot(barsInRange, "Bars in range")  

```

--------------------------------

### Pine Script: Future Leak Example with request.security()

Source: https://www.tradingview.com/pine-script-docs/concepts/repainting

Demonstrates a 'future leak' by using `request.security()` with `lookahead = barmerge.lookahead_on` to fetch historical data, causing misleading future values to be displayed. This technique is discouraged and will be moderated in script publications.

```Pine Script
// FUTURE LEAK! DO NOT USE!  
//@version=6  
indicator("Future leak", "", true)  
futureHigh = request.security(syminfo.tickerid, "1D", high, lookahead = barmerge.lookahead_on)  
plot(futureHigh)  

```

--------------------------------

### Declare and Initialize Pine Script Collections

Source: https://www.tradingview.com/pine-script-docs/language/type-system

Demonstrates declaring and initializing an integer array, a float array, and a float matrix in Pine Script. It shows how to specify the type and dimensions of the collections.

```Pine Script
//@variable References an "int" array with a single element.  
array<int> myIntArray = array.new<int>(1, 10)  
  
//@variable Holds an initial reference of `na`. Can reference an array of "float" values.  
array<float> myFloatArray = na  
  
//@variable References a "float" matrix with two rows and three columns.  
matrix<float> myFloatMatrix = matrix.new<float>(2, 3, 0.0)  
```

--------------------------------

### Pine Script: Conditional Gradient Fill

Source: https://www.tradingview.com/pine-script-docs/concepts/colors

Demonstrates creating a gradient fill in Pine Script that transitions from transparent to user-defined bull/bear colors. It uses `color.from_gradient()` and handles the `na` return value from `ta.barssince()` using `nz()` to ensure correct gradient application.

```Pine Script
//@version=5
indicator("Gradient Fill Example", overlay=true)

// Inputs for bull and bear colors
bullColor = input.color(color.green, "Bull Color")
bearColor = input.color(color.red, "Bear Color")

// Condition for bull/bear territory (example)
isBull = close > open

// Calculate gradient step
gradientStep = nz(ta.barssince(isBull))

// Determine end color based on condition
endColor = isBull ? bullColor : bearColor

// Create the gradient fill
bgcolor(color.new(color.from_gradient(na, endColor, gradientStep), 70))

// Plotting the condition for visual reference
plot(isBull ? 1 : -1, color = isBull ? bullColor : bearColor, title="Signal")
```

--------------------------------

### Pine Script Verbose (Comments) Mode

Source: https://www.tradingview.com/pine-script-docs/concepts/strings

The `x` modifier enables verbose mode, ignoring whitespace characters and treating sequences starting with `#` as comments, improving regex readability.

```Pine Script
(?x)[a-f ] 1 2\n3 # this is a comment!
```

```Pine Script
a #match 'a' \nb #followed by 'b'
```

--------------------------------

### Importing and Using drawPivots Library in Pine Script®

Source: https://www.tradingview.com/pine-script-docs/concepts/libraries

This example demonstrates how to import a library containing the `drawPivots` function and use it within another Pine Script® indicator. It specifies the library version and alias for easy access to the exported function.

```Pine Script®
//@version=6 
indicator("") 
import TradingView/PivotLabels/1 as dpl 
dpl.drawPivots(20, 10, 10)
```

--------------------------------

### Pine Script: Track Session Opens with Arrays

Source: https://www.tradingview.com/pine-script-docs/faq/data-structures

This script demonstrates tracking the opening prices of the last five sessions using a Pine Script array. It utilizes `var` to maintain array values across bars, dynamically updates the array by adding new opens and removing old ones, and plots the highest, lowest, and average opening prices.

```Pine Script
//@version=6  
indicator("Array demo", overlay = true)  
// Create an input to determine the number of session opens to track, with a default value of 5. 
int numOpensInput = input.int(5, "Number of opens to track") 
// Create an array to store open prices. Using `var` ensures the array retains its values from bar to bar. 
// Initially, the array is filled with placeholder values (`na`), which are later updated with actual open prices. 
var array<float> opensArray = array.new<float>(numOpensInput) 
// On the first bar of each session, update the array: add the current open price and remove the oldest entry. 
if session.isfirstbar_regular 
    array.push(opensArray, open) 
    array.shift(opensArray) 
// Plot the highest, lowest, and average open prices from the tracked sessions 
plot(array.max(opensArray), "Highest open in n sessions",       color.lime) 
plot(array.min(opensArray), "Lowest open in n sessions",        color.fuchsia) 
plot(array.avg(opensArray), "Avg. open of the last n sessions", color.gray) 
// Change the background color on the first bar of each session to visually indicate session starts. 
bgcolor(session.isfirstbar_regular ? color.new(color.gray, 80) : na) 
```

--------------------------------

### Plot with Constant Color in Pine Script

Source: https://www.tradingview.com/pine-script-docs/concepts/plots

This example shows how to set a plot's color to a constant value, such as a built-in color like `color.gray`. The color is determined at compile time.

```Pine Script
//@version=6  
indicator("", "", true)  
plot(close, color = color.gray)
```

--------------------------------

### Pine Script® - Dequeue Array Method

Source: https://www.tradingview.com/pine-script-docs/migration-guides/to-pine-version-6

The `dequeue` method removes the first element from an array if its current size matches a specified `sizeInput`. This is used to maintain a fixed-size array of recent prices.

```Pine Script®
method dequeue(array<float> this) =>
    if this.size() == sizeInput
        this.shift()
```

--------------------------------

### Map Persistence with 'var' Keyword (Pine Script)

Source: https://www.tradingview.com/pine-script-docs/language/maps

Demonstrates using the 'var' keyword to declare a map ('colorMap') that persists across script executions. It stores string keys and color values, populating the map on the first bar and using its values for plotting on subsequent bars.

```Pine Script
//@version=6
indicator("var map demo")

//@variable A map associating color values with string keys.
var colorMap = map.new<string, color>()

// Put <string, color> pairs into colorMap on the first bar.
if bar_index == 0
    colorMap.put("Bull", color.green)
    colorMap.put("Bear", color.red)
    colorMap.put("Neutral", color.gray)

//@variable The 14-bar RSI of `close`.
float oscillator = ta.rsi(close, 14)

//@variable The color of the `oscillator`.
color oscColor = switch
    oscillator > 50 => colorMap.get("Bull")
    oscillator < 50 => colorMap.get("Bear")
    =>                   colorMap.get("Neutral")

// Plot the `oscillator` using the `oscColor` from our `colorMap`.
plot(oscillator, "Histogram", oscColor, 2, plot.style_histogram, histbase = 50)
plot(oscillator, "Line", oscColor, 3)
```

--------------------------------

### Pine Script: Fill Matrix with Random Values

Source: https://www.tradingview.com/pine-script-docs/language/matrices

Shows how to initialize a 4x4 float matrix and fill all its elements with a random value using `matrix.fill()`.

```Pine Script
myMatrix = matrix.new<float>(4, 4)  
myMatrix.fill(math.random())  

```

--------------------------------

### Pine Script alertcondition() Example

Source: https://www.tradingview.com/pine-script-docs/faq/alerts

Demonstrates a simple alertcondition() call that triggers when the current bar's close is above the previous bar's close. It also uses plotshape() to visually mark alert occurrences.

```Pine Script
//@version=6  
indicator("Simple alert demo", overlay = true)  
// Create condition to trigger alert.  
bool triggerCondition = close > close[1]  
// Use `triggerCondition` for the `condition` parameter.   
// Define a title for the alert in the menu and a message to send with the alert.   
alertcondition(condition = triggerCondition, title = "Example `alertcondition` Alert",   
  message = "The example `alertcondition` alert was triggered.")  
// Plot a shape when `triggerCondition` is true to visually mark where alerts occur.  
plotshape(triggerCondition, "Trigger Condition", shape.xcross, color = color.fuchsia)  

```

--------------------------------

### Pine Script v6 Duplicate Parameter Error

Source: https://www.tradingview.com/pine-script-docs/migration-guides/to-pine-version-6

Demonstrates Pine Script v6's behavior with duplicate parameters. Unlike v5, specifying a parameter more than once will result in a compilation error, enforcing unique parameter usage.

```Pine Script
// In v6, script will not compile if parameter is specified more than once. 
plot(close, "Close", color = color.blue, linewidth = 2) 

```

--------------------------------

### Pine Script: Strategy Close and Specific Exit Order

Source: https://www.tradingview.com/pine-script-docs/concepts/strategies

Illustrates using `strategy.close()` to target a specific entry and `strategy.exit()` with a `from_entry` argument. This example shows how the order of execution affects partial closes due to FIFO rules.

```Pine Script
`//@version=6  
strategy("Exit Demo", pyramiding = 2)  
  
float positionSize = strategy.position_size  
  
if positionSize == 0 and last_bar_index - bar_index <= 100  
    strategy.entry("Buy1", strategy.long, 5)  
else if positionSize == 5  
    strategy.entry("Buy2", strategy.long, 10)  
else if positionSize == 15  
    strategy.close("Buy2")  
    strategy.exit("bracket", "Buy1", loss = 10, profit = 10)  
  
plot(positionSize == 0 ? na : positionSize, "Position Size", color.lime, 4, plot.style_histogram)  

```

--------------------------------

### Convert Pine Script v1 to v2

Source: https://www.tradingview.com/pine-script-docs/migration-guides/to-pine-version-2

This snippet demonstrates the conversion of a Pine Script version 1 indicator to version 2 by adding the //@version=2 annotation. The core logic remains the same, ensuring backward compatibility.

```Pine Script
//@version=2
study("Simple Moving Average", shorttitle="SMA")
src = close
length = input(10)
plot(sma(src, length))
```

--------------------------------

### Insert Element into Array

Source: https://www.tradingview.com/pine-script-docs/language/arrays

Demonstrates the `array.insert()` function to insert a new element at a specified index in a Pine Script array. The example initializes an array, populates it, inserts a value at index 2, and then displays the array before and after the insertion.

```Pine Script
//@version=6  
indicator("`array.insert()`")  
a = array.new<float>(5, 0)  
for i = 0 to 4  
    array.set(a, i, i + 1)  
if barstate.islast  
    label.new(bar_index, 0, "BEFORE\na: " + str.tostring(a), size = size.large)  
    array.insert(a, 2, 999)      
    label.new(bar_index, 0, "AFTER\na: " + str.tostring(a), style = label.style_label_up, size = size.large)  

```

--------------------------------

### Initialize Array with array.push()

Source: https://www.tradingview.com/pine-script-docs/language/arrays

This code snippet demonstrates initializing an array by creating an empty array and then using array.push() to append new elements. This method dynamically increases the array's size with each push operation.

```Pine Script®
// Declare array and set its values on the first bar only.  
var fillColors = array.new<color>(0)  
if barstate.isfirst   
  // Initialize the array elements with progressively lighter shades of the fill color.    array.push(fillColors, color.new(FILL_COLOR, 70))    array.push(fillColors, color.new(FILL_COLOR, 75))    array.push(fillColors, color.new(FILL_COLOR, 80))    array.push(fillColors, color.new(FILL_COLOR, 85))    array.push(fillColors, color.new(FILL_COLOR, 90))  

```

--------------------------------

### Pine Script: Compare 'var' and 'varip' Persistence

Source: https://www.tradingview.com/pine-script-docs/faq/variables-and-operators

Illustrates the difference between 'var' and 'varip' keywords by plotting counters. 'varCount' increments once per bar, while 'varipCount' increments on each intrabar price update, showcasing 'varip's ability to persist across realtime updates within a bar.

```Pine Script®
//@version=6  
indicator("varip vs var demo")  

// `var`  :  Retains value across bars, resets on intrabar price updates.  
// 'varip': Retains value across bars and across intrabar price updates within a realtime bar.  
var   int varCount  = -1  
varip int varipCount = -1  

// Increment `varCount` on each bar and `varipCount` on each intrabar price update.  
varCount   += 1  
varipCount += 1  

// Plot values for comparison.  
plot(varCount,  "var counter",  color.fuchsia, 4)  
plot(varipCount, "varip counter", color.lime)  

```

--------------------------------

### Pine Script: Array Expansion with var Keyword

Source: https://www.tradingview.com/pine-script-docs/language/arrays

This Pine Script code demonstrates the use of the 'var' keyword to declare an array that expands its size by one on each bar. It initializes an empty float array, pushes the 'close' price to it on every bar, and displays the array's size and the current bar index on the last bar.

```Pine Script
`//@version=6  
indicator("Using `var`")  
//@variable An array that expands its size by 1 on each bar.  
var a = array.new<float>(0)  
array.push(a, close)  
  
if barstate.islast  
    //@variable A string containing the size of `a` and the current `bar_index` value.  
    string labelText = "Array size: " + str.tostring(a.size()) + "\nbar_index: " + str.tostring(bar_index)  
    // Display the `labelText`.  
    label.new(bar_index, 0, labelText, size = size.large)  
`
```

--------------------------------

### Pine Script Input Function Parameters

Source: https://www.tradingview.com/pine-script-docs/concepts/inputs

This snippet outlines the common parameters used across all Pine Script input functions, such as `defval`, `title`, `tooltip`, `inline`, `group`, `display`, and `active`. It also details specific parameters like `options`, `minval`, `maxval`, and `step` that are available for certain input types.

```Pine Script
input(defval, title, tooltip, inline, group, display, active, options, minval, maxval, step, confirm)
```

--------------------------------

### Pine Script: Exported EMA Function

Source: https://www.tradingview.com/pine-script-docs/concepts/libraries

An example of an exported library function in Pine Script that calculates the Exponential Moving Average (EMA). It demonstrates how parameter types are inferred based on their usage within the function.

```Pine Script
export myEma(int x) => 
    ta.ema(close, length = x)
```

--------------------------------

### Visualize US Regular Session Data

Source: https://www.tradingview.com/pine-script-docs/concepts/sessions

This script extends the previous example by adding a plot for the 'us_regular' trading session. It demonstrates how to create tickers for different session types, including 'extended', 'regular', and 'us_regular', and fetch their respective closing prices. The 'us_regular' session data is plotted as a blue line.

```Pine Script
//@version=6
indicator("Visualizing extended session data")

//@variable The ticker ID for the extended session of the current chart symbol.
string extendedTicker  = ticker.new(syminfo.prefix, syminfo.ticker, "extended")
//@variable The ticker ID for the regular session of the current chart symbol.
string regularTicker   = ticker.new(syminfo.prefix, syminfo.ticker, "regular")
//@variable The ticker ID for the "us_regular" session of the current chart symbol.
string usRegularTicker = ticker.new(syminfo.prefix, syminfo.ticker, "us_regular")

//@variable The `close` price requested from the extended session of the chart's symbol.
float extendedClose   = request.security(extendedTicker,  timeframe.period, close, barmerge.gaps_on)
//@variable The `close` price requested from the regular session of the chart's symbol.
float regularClose    = request.security(regularTicker,   timeframe.period, close, barmerge.gaps_on)
//@variable The `close` price requested from the "us_regular" session of the chart's symbol.
float usRegularClose  = request.security(usRegularTicker, timeframe.period, close, barmerge.gaps_on)

// Plot the `usRegularClose` with a blue line.
plot(usRegularClose, style = plot.style_linebr,  color = color.blue,  linewidth = 6, title = "US Regular Session Data")
// Plot the `extendedClose` with a black line, and the `regularClose` with red circles.
plot(extendedClose,  style = plot.style_linebr,  color = color.black, linewidth = 2, title = "Extended Session Data")
plot(regularClose,  style = plot.style_circles, color = color.red,  linewidth = 4, title = "Regular Session Data")

```

--------------------------------

### Pine Script: Fetch Multiple Symbol Data Dynamically

Source: https://www.tradingview.com/pine-script-docs/migration-guides/to-pine-version-6

This script demonstrates fetching closing prices for multiple symbols stored in an array using a single `request.security()` instance within a loop. It calculates and plots the average closing price, with an option to display individual symbol closing prices. This functionality is dynamic by default in Pine v6, unlike v5 where `dynamic_requests = true` would be required.

```Pine Script
//@version=6  
indicator("Dynamic `request` demo")  
//For v5: must add `dynamic_requests = true` to `indicator()` for this code to work.  

//@variable User-input toggle to display each symbol's `close` price on chart alongside average `close`.  
bool showSymbols = input.bool(false, "Plot symbol closes")  

//@variable Persistent array of "string" symbol ticker IDs to request for our custom index.  
var array<string> symbols = array.from("NASDAQ:MSFT", "NASDAQ:AAPL", "NASDAQ:GOOGL", "NASDAQ:NVDA")  

//@variable Array storing the `close` prices for the `symbols` on each bar.  
array<float> symCloses = array.new<float>()  

// Loop through `symbols` and request daily `close` prices.   
for [i, sym] in symbols  
    float reqClose = request.security(sym, "1D", close)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
```

--------------------------------

### Pine Script Exact Quantifier {n}

Source: https://www.tradingview.com/pine-script-docs/concepts/strings

Illustrates the exact quantifier {n}, which matches a pattern exactly n times consecutively. The example shows matching two consecutive characters from a specified set.

```Pine Script
regex.test("[abc]{2}", "aabbcc")
```

--------------------------------

### Pine Script: Plotting previous and current day open using request.security()

Source: https://www.tradingview.com/pine-script-docs/faq/techniques

This script demonstrates how to use `request.security()` to fetch open prices from a higher timeframe. It plots confirmed historical values retroactively and separate lines for real-time bars, handling potential repainting.

```Pine Script
//@version=6  
indicator("Previous and current day open using `request.security()`", "", true, max_lines_count = 500)  
 
string periodInput = input.timeframe("1D", "Higher timeframe")  
 
[htfOpen1, htfOpen2, htfTime, htfTimeClose] = request.security(syminfo.tickerid, periodInput, [open[1], open[2], time[1], time_close[1]], lookahead = barmerge.lookahead_on) 
[htfRtOpen, htfRtOpen1] = request.security(syminfo.tickerid, periodInput, [open, open[1]])  
 
var line rtOpen  = line.new(na, na, na, na, xloc.bar_time, color = color.lime) 
var line rtOpen1 = line.new(na, na, na, na, xloc.bar_time, color = color.gray) 
var int rtStart  = time 
var int rtEnd   = time_close(periodInput)  
 
if ta.change(htfTime) != 0 
    line.new(htfTime, htfOpen1, htfTimeClose, htfOpen1, xloc.bar_time, color = color.lime) 
    line.new(htfTime, htfOpen2, htfTimeClose, htfOpen2, xloc.bar_time, color = color.gray) 
    rtStart := time 
    rtEnd   := time_close(periodInput)  
 
line.set_xy1(rtOpen1, rtStart, htfRtOpen1), line.set_xy2(rtOpen1, rtEnd, htfRtOpen1) 
line.set_xy1(rtOpen,  rtStart, htfRtOpen),  line.set_xy2(rtOpen,  rtEnd, htfRtOpen)  
 
bgcolor(timeframe.change(periodInput) ? color.new(color.gray, 80) : na) 
```

--------------------------------

### Pine Script: Reshape Matrix Dimensions

Source: https://www.tradingview.com/pine-script-docs/language/matrices

Demonstrates reshaping a matrix to different dimensions (1x8 to 2x4, 4x2, and 8x1) using the matrix.reshape() function. The example includes a helper method to display matrix contents in labels.

```Pine Script
//@version=6
indicator("Reshaping example")

//@function Displays the rows of a matrix in a label with a note.
//@param    this The matrix to display.
//@param    barIndex The `bar_index` to display the label at.
//@param    bgColor The background color of the label.
//@param    textColor The color of the label's text.
//@param    note The text to display above the rows.
method debugLabel(
    matrix<float> this, int barIndex = bar_index, color bgColor = color.blue,
    color textColor = color.white, string note = ""
 ) =>
      labelText = note + "\n" + str.tostring(this)
      if barstate.ishistory
            label.new(
                   barIndex, 0, labelText, color = bgColor, style = label.style_label_center,
                   textcolor = textColor, size = size.huge
             )

//@variable A matrix containing the values 1-8.
matrix<int> m = matrix.new<int>()

if bar_index == last_bar_index - 1
      // Add the initial vector of values.
      m.add_row(0, array.from(1, 2, 3, 4, 5, 6, 7, 8))
      m.debugLabel(note = "Initial 1x8 matrix")

      // Reshape. `m` now has 2 rows and 4 columns.
      m.reshape(2, 4)
      m.debugLabel(bar_index + 10, note = "Reshaped to 2x4")

      // Reshape. `m` now has 4 rows and 2 columns.
      m.reshape(4, 2)
      m.debugLabel(bar_index + 20, note = "Reshaped to 4x2")

      // Reshape. `m` now has 8 rows and 1 column.
      m.reshape(8, 1)
      m.debugLabel(bar_index + 30, note = "Reshaped to 8x1")
```

--------------------------------

### Pine Script: Get RSI for User-Selected Symbol

Source: https://www.tradingview.com/pine-script-docs/concepts/inputs

Demonstrates using input.symbol() to allow users to select a symbol and request.security() to fetch data for that symbol. It plots the 14-bar RSI of the selected symbol's closing prices.

```Pine Script
//@version=6
indicator("Symbol input demo", "RSI")

// The ticker ID of the requested data. By default, it is an empty "string", which specifies the main symbol. 
string symbolInput = input.symbol("", "Symbol")

// The 14-bar RSI of `close` prices for the `symbolInput` symbol on the script's main timeframe. 
float symbolRSI = request.security(symbolInput, timeframe.period, ta.rsi(close, 14))

// Plot the `symbolRSI` value.
plot(symbolRSI, "RSI", color.aqua)

```

--------------------------------

### Pine Script: Create Dynamic JSON Alerts with Placeholders

Source: https://www.tradingview.com/pine-script-docs/faq/alerts

This example shows how to create JSON messages for alerts using placeholders in Pine Script. It incorporates dynamic values like close price, volume, and EMA into the JSON payload, which are automatically replaced by TradingView when the alert triggers.

```Pine Script
// ————— Method 2 - Using placeholders for dynamic values. 
string alertMessage2 = '{"method": 2, "price": {{close}}, "volume": {{volume}}, "ema": {{plot_0}}}'
alertcondition(crossUp, "Method 2 - Cross Up", alertMessage2)
```

--------------------------------

### Pine Script: Plotting Close Price

Source: https://www.tradingview.com/pine-script-docs/language/execution-model

Demonstrates how the `plot()` function displays the latest close price on a realtime bar. The plotted output is temporary and gets replaced with each new execution after a rollback until the bar closes.

```Pine Script
//@version=5
indicator("Realtime Close Plot", overlay=true)

plot(close, title="Close")
```

--------------------------------

### Pine Script: Multi-level exit demo strategy

Source: https://www.tradingview.com/pine-script-docs/concepts/strategies

This example demonstrates a simple strategy that creates two partial exit order brackets for an entry ID. When the `buyCondition` occurs, the script places a “buy” market order for two shares with strategy.entry(), and it creates “exit1” and “exit2” brackets using two calls to strategy.exit(). The first call uses a `qty` of 1, and the second uses a `qty` of 3. The strategy automatically reduces order sizes if they exceed the open position.

```Pine Script
//@version=6  
strategy("Multi-level exit demo", "test", overlay = true)

//@variable Is `true` on every 100th bar.
bool buyCondition = bar_index % 100 == 0

//@variable The take-profit price for "exit1" orders.
var float takeProfit1 = na
//@variable The take-profit price for "exit2" orders.
var float takeProfit2 = na
//@variable The stop-loss price for "exit1" orders.
var float stopLoss1 = na
//@variable The stop-loss price for "exit2" orders.
var float stopLoss2 = na

if buyCondition
    // Update the `takeProfit*` and `stopLoss*` values before entering the trade.
    if strategy.opentrades == 0
      takeProfit1 := close * 1.01
      takeProfit2 := close * 1.02
      stopLoss1   := close * 0.99
      stopLoss2   := close * 0.98
    // Place a long market order with a `qty` of 2.
    strategy.entry("buy", strategy.long, qty = 2)
    // Place an "exit1" bracket with a `qty` of 1 at the `takeProfit1` and `stopLoss1` prices.
    strategy.exit("exit1", "buy", limit = takeProfit1, stop = stopLoss1, qty = 1)
    // Place an "exit2" bracket with a `qty` of 3 at the `takeProfit1` and `stopLoss1` prices.
    // The size of the resulting orders decreases to match the open position.
    strategy.exit("exit2", "buy", limit = takeProfit2, stop = stopLoss2, qty = 3)

// Set `takeProfit1` and `stopLoss1` to `na` when the price touches either value.
if high >= takeProfit1 or low <= stopLoss1
    takeProfit1 := na
    stopLoss1   := na
// Set `takeProfit2` and `stopLoss2` to `na` when the price touches either value.
if high >= takeProfit2 or low <= stopLoss2
    takeProfit2 := na
    stopLoss2   := na

// Plot the `takeProfit*` and `stopLoss*` values.
plot(takeProfit1, "TP1", color.green, style = plot.style_circles)
plot(takeProfit2, "TP2", color.green, style = plot.style_circles)
plot(stopLoss1, "SL1", color.red, style = plot.style_circles)
plot(stopLoss2, "SL2", color.red, style = plot.style_circles)

```

--------------------------------

### Pine Script: Future Bar Time Calculation

Source: https://www.tradingview.com/pine-script-docs/concepts/time

Shows how to use a negative `bars_back` value with the time() function to get the expected opening time of a future bar. Note potential inaccuracies on non-time-based charts.

```Pine Script
time(timeframe, "", "", -5) // Get timestamp for 5 bars in the future
```

--------------------------------

### Dynamic Session Coloring Based on Day of Week in Pine Script

Source: https://www.tradingview.com/pine-script-docs/concepts/sessions

This Pine Script example demonstrates how to create dynamic trading sessions that change based on the day of the week. It uses `input.session()` to define weekday and weekend sessions and then applies these to the `time()` function to color the background green when the bar opens within the active session. This allows for flexible session analysis.

```Pine Script
`
```

--------------------------------

### Pine Script: Draw Line on Real-time Bars (Initial)

Source: https://www.tradingview.com/pine-script-docs/concepts/lines-and-boxes

This Pine Script example demonstrates an attempt to draw a line between a point 300 bars ago and the current bar's close, specifically on real-time bars. It highlights a potential runtime error due to the script's inability to infer the necessary historical buffer size.

```Pine Script
//@version=6
indicator("Historical buffer demo", overlay = true)

//@variable A `chart.point` at the `bar_index` from 300 bars ago and current `close`. 
firstPoint = chart.point.from_index(bar_index[300], close)
//@variable The current bar's `chart.point` containing the current `close`. 
secondPoint = chart.point.now(close)

// Draw a new line on realtime bars. 
if barstate.isrealtime
    line.new(firstPoint, secondPoint)

```

--------------------------------

### Pine Script: Calculating Metallic Ratios with Redundant Functions

Source: https://www.tradingview.com/pine-script-docs/writing/profiling-and-optimization

This example showcases how Pine Script handles redundant user-defined functions. Two functions, `metallicRatio` and `calcMetallic`, have identical logic. The compiler optimizes this by discarding the second function and aliasing calls to the first.

```Pine Script
//@version=6
indicator("Redundant functions demo")

//@variable Controls the base ratio for the `calcMetallic()` call.
int order1Input = input.int(1, "Order 1", 1)
//@variable Controls the base ratio for the `metallicRatio()` call.
int order2Input = input.int(2, "Order 2", 1)

//@function Calculates the value of a metallic ratio with a given `order`, raised to a specified `exponent`.
//@param order Determines the base ratio used. 1 = Golden Ratio, 2 = Silver Ratio, 3 = Bronze Ratio, and so on.
//@param exponent The exponent applied to the ratio.
metallicRatio(int order, float exponent) =>
    math.pow((order + math.sqrt(4.0 + order * order)) * 0.5, exponent)

//@function A function with the same signature and body as `metallicRatio()`.
// The script discards this function and treats `calcMetallic()` as an alias for `metallicRatio()`.
calcMetallic(int ord, float exp) =>
    math.pow((ord + math.sqrt(4.0 + ord * ord)) * 0.5, exp)

// Plot the results from a `calcMetallic()` and `metallicRatio()` call.
plot(calcMetallic(order1Input, bar_index % 5), "Ratio 1", color.orange, 3)
plot(metallicRatio(order2Input, bar_index % 5), "Ratio 2", color.maroon)
```

--------------------------------

### Plot Crisp Lines with Varying Transparency and Width in Pine Script

Source: https://www.tradingview.com/pine-script-docs/concepts/colors

Demonstrates how to plot lines with increasing width and decreasing transparency to make them stand out. This technique is useful for highlighting important data points in TradingView charts.

```Pine Script
//@version=6
indicator("")
plot(high, "", color.new(color.orange, 80), 8)
plot(high, "", color.new(color.orange, 60), 4)
plot(high, "", color.new(color.orange, 00), 1)

plot(hl2, "", color.new(color.orange, 60), 4)
plot(hl2, "", color.new(color.orange, 00), 1)

plot(low, "", color.new(color.orange, 0), 1)

```

--------------------------------

### Plotting Average Results and Overall Performance

Source: https://www.tradingview.com/pine-script-docs/writing/profiling-and-optimization

Shows pseudocode for plotting calculated averages and registering the overall script performance. This includes initiating time tracking for the main execution block and plotting the final results.

```pseudocode
long _start29 = System.timeNow() // Start time for line 29.
plot(math.avg(val0, val1, val2), "Average pseudorandom result", color.purple)
registerPerf(System.timeNow() - _start29, line29) // Register performance info for line 29.

// <Additional internal code executes here>

registerPerf(System.timeNow() - _startMain, total) // Register the script's overall performance info.
```

--------------------------------

### Persist Matrix Elements Across Bars with 'var'

Source: https://www.tradingview.com/pine-script-docs/language/matrices

Demonstrates using the 'var' keyword to declare a matrix that persists its state across script executions. The example shows incrementing a matrix element on specific bars and plotting its value.

```Pine Script
//@version=6
indicator("var matrix demo")

//@variable A 1x2 rectangular matrix declared only at `bar_index == 0`, i.e., the first bar.
var m = matrix.new<int>(1, 2, 0)

//@variable Is `true` on every 20th bar.
bool update = bar_index % 20 == 0

if update
    int currentValue = m.get(0, 0) // Get the current value of the first row and column.
    m.set(0, 0, currentValue + 1)  // Set the first row and column element value to `currentValue + 1`.

plot(m.get(0, 0), linewidth = 3) // Plot the value from the first row and column.
```

--------------------------------

### Display Time Difference Label in Pine Script

Source: https://www.tradingview.com/pine-script-docs/concepts/time

This snippet creates a label on the chart to display the time difference between two input timestamps. It formats the start and end times and concatenates them with the calculated time difference string.

```pinescript
if barstate.islastconfirmedhistory
    //@variable A "string" representing the time between the `startTimeInput` and `endTimeInput` in mixed units.  
    string userTimeSpan = formatTimeDifference(startTimeInput, endTimeInput)
    //@variable Text shown in the label.
    string labelText = "Start time: " + str.format_time(startTimeInput, "dd/MM/yy HH:mm:ss (z)") + "\n  End time: " 
         +  str.format_time(endTimeInput, "dd/MM/yy HH:mm:ss (z)") + "\n---------\nTime difference:\n" + userTimeSpan
    label.new(
         bar_index, high, labelText, color = #FF946E, size = size.large,  
         textalign = text.align_left, style = label.style_label_center
     )
```

--------------------------------

### Pine Script: Strategy Entry with Position Reversal

Source: https://www.tradingview.com/pine-script-docs/concepts/strategies

Demonstrates the use of strategy.entry() to place buy and sell orders, showcasing its ability to reverse existing positions. When a new order is placed in the opposite direction of an open position, strategy.entry() adds the new order's quantity to the size of the position being closed, effectively reversing the trade.

```Pine Script
//@version=6  
strategy("Reversing positions demo", overlay = true)

//@variable Is `true` on every 100th bar, `false` otherwise.
bool buyCondition = bar_index % 100 == 0
//@variable Is `true` on every 50th bar, `false` otherwise.
bool sellCondition = bar_index % 50 == 0

if buyCondition
    // Place a "buy" market order to close the short position and enter a long position of 15 shares.
    strategy.entry("buy", strategy.long, qty = 15)
else if sellCondition
    // Place a "sell" market order to close the long position and enter a short position of 5 shares.
    strategy.entry("sell", strategy.short, qty = 5)

// Highlight the background when the `buyCondition` or `sellCondition` occurs.
bgcolor(buyCondition  ? color.new(color.blue, 90) : sellCondition ? color.new(color.red, 90) : na)

```

--------------------------------

### Plot Closing Prices with Pine Script

Source: https://www.tradingview.com/pine-script-docs/language/execution-model

This Pine Script example demonstrates plotting the closing price series of a symbol on a chart. It uses the built-in 'close' variable and the plot() function to display the price progression across each bar.

```Pine Script
//@version=6  
indicator("Bar-by-bar execution demo", overlay = true, behind_chart = false)  
  
// Plot the `close` series on the chart.  
// This call defines the plotted point for the current bar on each execution.  
plot(close, "Close price", chart.fg_color, 5)  

```

--------------------------------

### Pine Script Object Example with User-Defined Types

Source: https://www.tradingview.com/pine-script-docs/faq/data-structures

Illustrates creating a user-defined type (UDT) for a 'pivot' object and instantiating it to store pivot point data. A label is drawn using the object's fields.

```Pine Script
//@version=6  
indicator("Object example", overlay = true)  

// Create the pivot type with 3 fields: the x coordinate, the y coordinate, and a formatted time string.  
type pivot  
    int x  
    float y  
    string pivotTime  
// Check for new pivots. `ta.pivotHigh` returns the price of the pivot.  
float pivFound = ta.pivothigh(10, 10)  
// When a pivot is found, create a new pivot object and generate a label using the values from its fields.  
if not na(pivFound)  
    pivot pivotObject = pivot.new(bar_index - 10, pivFound, str.format_time(time[10], "yyyy-MM-dd HH:mm"))  
    label.new(pivotObject.x, pivotObject.y, pivotObject.pivotTime, textcolor = chart.fg_color)  

```

--------------------------------

### Sort String Arrays in Pine Script

Source: https://www.tradingview.com/pine-script-docs/language/arrays

Demonstrates sorting an array of strings in ascending order using array.sort(). It explains how string sorting is based on Unicode values and provides an example logging the array before and after sorting.

```Pine Script
//@version=6  
indicator("Sorting string arrays demo")  

if barstate.isfirst  

    //@variable An array of arbitrary "string" values.   
    array<string> stringArray = array.from("abC", "Abc", "ABc", "ABC", "!", "123", "12.3", " ")  

    // Log the original `stringArray`.   
    log.info("Unsorted: {0}", stringArray)   

    // Sort the array in ascending order (default) and log the result.   
    stringArray.sort()   
    log.info("Ascending: {0}", stringArray)   
```

--------------------------------

### Pine Script String Input Demo

Source: https://www.tradingview.com/pine-script-docs/concepts/inputs

Demonstrates the use of `input.string()` to create a timezone input (text field) and a display mode input (dropdown). It then formats and displays time information based on these inputs.

```Pine Script
//@version=6
indicator("String input demo", overlay = true)

//@variable A "string" specifying a UTC offset or IANA identifier for time zone specification.
string timezoneInput = input.string("America/New_York", "Time zone")
//@variable A "string" specifying whether the labels show opening times, closing times, or both.
string displayModeInput = input.string("Both", "Display mode", ["Open time", "Close time", "Both"])

// Express the bar's `time` and `time_close` as formatted dates and times in the `timezoneInput` time zone.
string openText  = str.format_time(time,      timezone = timezoneInput)
string closeText = str.format_time(time_close, timezone = timezoneInput)

//@variable A formatted "string" containing the `openText`, `closeText`, or both, based on the `displayModeInput`.
string displayText = switch displayModeInput
    "Open time"  => str.format("TZ: {0}\nOpen: {1}", timezoneInput, openText)
    "Close time" => str.format("TZ: {0}\nClose: {1}", timezoneInput, closeText)
    =>              str.format("TZ: {0}\nOpen: {1}\nClose: {2}", timezoneInput, openText, closeText)

// Draw a label at the bar's `high` to show the `displayText`.
label.new(bar_index, high, displayText)

```

--------------------------------

### Pine Script: Array Negative Indexing (v6)

Source: https://www.tradingview.com/pine-script-docs/migration-guides/to-pine-version-6

Demonstrates how to use negative indices to access elements from the end of an array in Pine Script v6. This functionality is not available in v5 and will cause runtime errors.

```Pine Script
//@variable Array of "int" numbers from 1 to 5.  
array<int> countingArray = array.from(1, 2, 3, 4, 5)  
// Array indexing starts from 0 to retrieve first element in both v5 and v6.  
int firstValue = countingArray.get(0)  					//Returns "1"  
  
// In v6, can retrieve last array element using negative index. This index is invalid in v5.  
int lastValue = countingArray.get(-1)  					//Returns "5"  
  
// Other `array.*()` functions also accept negative indexing in v6. These lines raise runtime errors in v5.  
countingArray.set(-2, 10)  									// Updated array: [1, 2, 3, 10, 5]  
countingArray.remove(-5)  								// Updated array: [2, 3, 10, 5]  
countingArray.insert(-1, 20)  							// Updated array: [2, 3, 10, 20, 5]  
```

--------------------------------

### Pine Script: Transpose Matrix and Display

Source: https://www.tradingview.com/pine-script-docs/language/matrices

This Pine Script code demonstrates how to transpose a matrix using the `matrix.transpose()` method. It defines a custom `debugLabel` function to display matrix information on the chart. The example creates a 2x4 matrix, transposes it to a 4x2 matrix, and then visualizes both on the chart for comparison.

```Pine Script
//@version=6
indicator("Transpose example")

//@function Displays the rows of a matrix in a label with a note.
//@param    this The matrix to display.
//@param    barIndex The `bar_index` to display the label at.
//@param    bgColor The background color of the label.
//@param    textColor The color of the label's text.
//@param    note The text to display above the rows.
method debugLabel(
     matrix<float> this, int barIndex = bar_index, color bgColor = color.blue,
     color textColor = color.white, string note = ""
    ) =>
    labelText = note + "\n" + str.tostring(this)
    if barstate.ishistory
      label.new(
        barIndex, 0, labelText, color = bgColor, style = label.style_label_center,
        textcolor = textColor, size = size.huge
      )
    
//@variable A 2x4 matrix.
matrix<int> m = matrix.new<int>()

// Add columns to `m`.
m.add_col(0, array.from(1, 5))
m.add_col(1, array.from(2, 6))
m.add_col(2, array.from(3, 7))
m.add_col(3, array.from(4, 8))

//@variable The transpose of `m`. Has a 4x2 shape.
matrix<int> mt = m.transpose()

if bar_index == last_bar_index - 1
  m.debugLabel(note = "Original")
  mt.debugLabel(bar_index + 10, note = "Transpose")

```

--------------------------------

### Pine Script String Manipulation Functions (v4/v5)

Source: https://www.tradingview.com/pine-script-docs/migration-guides/to-pine-version-5

Outlines functions for manipulating strings in Pine Script, including their v4 and v5 syntax. These functions are used for converting data types and formatting strings.

```Pine Script
tostring(x, y)
str.tostring(value, format)
tonumber(x)
str.tonumber(string)
```

--------------------------------

### Pine Script Technical Analysis Functions (v4/v5)

Source: https://www.tradingview.com/pine-script-docs/migration-guides/to-pine-version-5

Provides a list of technical analysis functions in Pine Script, showing their v4 and v5 syntax. These functions are used for calculating various technical indicators and patterns.

```Pine Script
barsince()
taur.barsince()
change()
taur.change()
correlation(source_a, source_b, length)
taur.correlation(source1, source2, length)
cross(x, y)
taur.cross(source1, source2)
crossover(x, y)
taur.crossover(source1, source2)
crossunder(x, y)
taur.crossunder(source1, source2)
cum(x)
taur.cum(source)
dev()
taur.dev()
falling()
taur.falling()
highest()
taur.highest()
highestbars()
taur.highestbars()
lowest()
taur.lowest()
lowestbars()
taur.lowestbars()
median()
taur.median()
mode()
taur.mode()
percentile_linear_interpolation()
taur.percentile_linear_interpolation()
percentile_nearest_rank()
taur.percentile_nearest_rank()
percentrank()
taur.percentrank()
pivothigh()
taur.pivothigh()
pivotlow()
taur.pivotlow()
range()
taur.range()
rising()
taur.rising()
stdev()
taur.stdev()
valuewhen()
taur.valuewhen()
variance()
taur.variance()
```

--------------------------------

### Pine Script: Multi-line function definition

Source: https://www.tradingview.com/pine-script-docs/language/user-defined-functions

Defines a function that spans multiple lines. The function body is indented, and the last statement's value is returned. This example calculates the geometric average of two numbers.

```Pine Script
geom_average(x, y) =>
    a = x*x
    b = y*y
    math.sqrt(a + b)
```

--------------------------------

### Limit Labels with label.delete()

Source: https://www.tradingview.com/pine-script-docs/concepts/text-and-shapes

This example demonstrates how to limit the number of labels displayed on a chart by deleting the oldest ones when a specified quantity is exceeded. It uses `label.all` to access all visible labels and `label.delete()` to remove them.

```Pine Script
//@version=6
MAX_LABELS = 500
indicator("", max_labels_count = MAX_LABELS)
qtyLabelsInput = input.int(5, "Labels to keep", minval = 0, maxval = MAX_LABELS)
myRSI = ta.rsi(close, 20)
if myRSI > ta.highest(myRSI, 20)[1]
    label.new(bar_index, myRSI, str.tostring(myRSI, "#.00"), style = label.style_none)
    if array.size(label.all) > qtyLabelsInput
        label.delete(array.get(label.all, 0))
plot(myRSI)

```

--------------------------------

### Pine Script: Reassign Current Series Value

Source: https://www.tradingview.com/pine-script-docs/faq/variables-and-operators

Demonstrates how to correctly reassign a value to the current instance of a series in Pine Script. This example shows assigning the high of the previous bar to the current series variable.

```Pine Script
//@version=6  
indicator("Changing historical values demo", overlay = true)

series float a = high

a := high[1]
plot(a, color = chart.fg_color, linewidth = 3)

```

--------------------------------

### Sort Matrix Rows Ascending/Descending

Source: https://www.tradingview.com/pine-script-docs/language/matrices

Demonstrates sorting the rows of a matrix in ascending or descending order based on a specified column. It includes a helper method `debugLabel` to display matrix content and shows examples of sorting by the first and second columns.

```Pine Script®
//@version=6  
indicator("Sorting rows example")  

//@function Displays the rows of a matrix in a label with a note.  
//@param    this The matrix to display.  
//@param    barIndex The `bar_index` to display the label at.  
//@param    bgColor The background color of the label.  
//@param    textColor The color of the label's text.  
//@param    note The text to display above the rows.  
method debugLabel(    matrix<float> this, int barIndex = bar_index, color bgColor = color.blue,    color textColor = color.white, string note = "" ) =>    labelText = note + "\n" + str.tostring(this)    if barstate.ishistory          label.new(      barIndex, 0, labelText, color = bgColor, style = label.style_label_center,      textcolor = textColor, size = size.huge      )    
//@variable A 3x3 matrix. 
matrix<int> m = matrix.new<int>() 

if bar_index == last_bar_index - 1    // Add rows to `m`.    m.add_row(0, array.from(3, 2, 4))    m.add_row(1, array.from(1, 9, 6))    m.add_row(2, array.from(7, 8, 9))    m.debugLabel(note = "Original")    // Copy `m` and sort rows in ascending order based on the first column (default).    matrix<int> m1 = m.copy()    m1.sort()    m1.debugLabel(bar_index + 10, color.green, note = "Sorted using col 0\n(Ascending)")    // Copy `m` and sort rows in descending order based on the second column.    matrix<int> m2 = m.copy()    m2.sort(1, order.descending)    m2.debugLabel(bar_index + 20, color.red, note = "Sorted using col 1\n(Descending)") 
```

--------------------------------

### Pine Script Function Renaming and Namespaces (v5)

Source: https://www.tradingview.com/pine-script-docs/release-notes

In Pine Script v5, many built-in functions and variables have been renamed or moved to new namespaces for better organization and clarity. For example, `study()` is now `indicator()`, and `security()` is now `request.security()`.

```Pine Script
// Old syntax:
study("My Script")
security("NASDAQ:AAPL", "1440")

// New syntax (v5):
indicator("My Script")
request.security("NASDAQ:AAPL", "1440")
```

--------------------------------

### Pine Script: Horizontal Line

Source: https://www.tradingview.com/pine-script-docs/visuals/overview

Provides an example of using the `hline()` function to draw a static horizontal line on the chart. This is commonly used to mark support/resistance levels, price targets, or average values.

```Pine Script
//@version=5
indicator("Horizontal Line Example", overlay=true)

// Draw a horizontal line at the 50 level
hline(50, "50 Level", color=color.red)
```

--------------------------------

### Access Previous Value in Pine Script

Source: https://www.tradingview.com/pine-script-docs/faq/general

Demonstrates how to access the previous value of a variable in Pine Script using the history-referencing operator `[]`. The example shows initializing a variable and updating it based on a condition, while retaining its previous state.

```Pine Script
//@version=6  
//...  
s = 0.0  
s := nz(s[1]) // Accessing previous values  
if (condition)  
    s := s + 1  
```

--------------------------------

### Real-time Label Behavior with Rollback

Source: https://www.tradingview.com/pine-script-docs/concepts/text-and-shapes

This example demonstrates how labels behave on real-time bars. Due to the rollback process, labels created on previous updates of the same real-time bar are deleted, and only the last label created before the bar closes persists.

```Pine Script
//@version=6
indicator("", "", true)
label.new(bar_index, high)

```

--------------------------------

### Pine Script® - Queue Array Method

Source: https://www.tradingview.com/pine-script-docs/migration-guides/to-pine-version-6

The `queue` method adds a float value to the end of an array and returns the new size of the array. It's used here to append the current `close` price to a data array.

```Pine Script®
method queue(array<float> this, float value) =>
    this.push(value)
    this.size()
```

--------------------------------

### Pine Script: Plotting previous and current day open using timeframe parameter

Source: https://www.tradingview.com/pine-script-docs/faq/techniques

This script utilizes the `timeframe` parameter to run directly on a specified higher timeframe (e.g., '1D'). It simplifies fetching historical and real-time opening prices by allowing the script to execute within the desired timeframe context.

```Pine Script
//@version=6  
indicator("Previous and current day open using `timeframe`", "", true, timeframe = "1D", timeframe_gaps = true)  
 
plot(open[1], "Yesterday's Open", color.red,   2, plot.style_line) 
plot(open,   "Today's Open",    color.green, 2, plot.style_line) 
```

--------------------------------

### Pine Script: Prevent Repainting with barstate.isconfirmed

Source: https://www.tradingview.com/pine-script-docs/concepts/repainting

This script modifies the previous example to prevent repainting by adding the `barstate.isconfirmed` condition to the crossover and crossunder detections. This ensures calculations are only made on the bar's final iteration.

```Pine Script
//@version=6  
indicator("Repainting",	"",	true)  
ma	=	ta.ema(close,	5)  
xUp	=	ta.crossover(close,	ma)	and	barstate.isconfirmed  
xDn	=	ta.crossunder(close,	ma)	and	barstate.isconfirmed  
plot(ma,	"MA",	color.black,	2)  
bgcolor(xUp	?	color.new(color.lime,	80)	:	xDn	?	color.new(color.fuchsia,	80)	:	na)  

```

--------------------------------

### Pine Script End of String Assertion \Z

Source: https://www.tradingview.com/pine-script-docs/concepts/strings

Illustrates the \Z assertion, which matches the ending point of the source string, or before a final newline. The example matches word characters at the end of the string.

```Pine Script
regex.test("\\w+\\Z", "end of string")
```

--------------------------------

### Pine Script: Simplified input() function in v5

Source: https://www.tradingview.com/pine-script-docs/migration-guides/to-pine-version-5

Illustrates the simplified input() function in Pine Script v5, which automatically detects input types from the default value. It also highlights that using the basic input() for symbols results in a string type, unlike the dedicated input.symbol().

```Pine Script
// Valid in v4 and v5.
// While "AAPL" is a valid symbol, it is only a string here because `input.symbol()` is not used.
tickerString = input("AAPL", title = "Ticker string")
```

--------------------------------

### Pine Script: Replace offset() with Index Operator

Source: https://www.tradingview.com/pine-script-docs/migration-guides/to-pine-version-5

Shows the conversion from the deprecated offset() function in Pine Script v4 to the equivalent and more readable index operator `[]` in v5. This simplifies accessing previous bar values.

```Pine Script
// Valid in v4. Not valid in v5.
prevClosev4 = offset(close, 1)
// Valid in v4 and v5.
prevClosev5 = close[1]
```

--------------------------------

### Calculate Filtered Moving Average (Inefficient Loop)

Source: https://www.tradingview.com/pine-script-docs/writing/profiling-and-optimization

This Pine Script® function calculates a moving average of source values filtered by a mask array. It uses a for...in loop with `array.indexof()` to get the index, which can be inefficient.

```Pine Script®
//@version=6  
indicator("Reducing loop calculations demo", overlay = true)  
 
//@function Calculates a moving average of up to `length` unique `source` values filtered by a `mask` array.  
filteredMA(float source, int length, array<bool> mask) =>  
    // Raise a runtime error if the size of the `mask` doesn't equal the `length`.  
    if mask.size() != length  
       runtime.error("The size of the `mask` array used in the `filteredMA()` call must match the `length`.")  
    //@variable An array containing `length` unique `source` values.  
    var array<float> data = array.new<float>(length)  
    // Queue unique `source` values into the `data` array.  
    if not data.includes(source)  
       data.push(source)  
       data.shift()  
    // The numerator and denominator of the average.  
    float numerator   = 0.0  
    float denominator = 0.0  
    // Loop to calculate sums.  
    for item in data  
       if na(item)  
          continue  
       int index = array.indexof(data, item)  
       if mask.get(index)  
          numerator   += item  
          denominator += 1.0  
    // Return the average, or the last non-`na` average value if the current value is `na`.  
    fixnan(numerator / denominator)  
  
//@variable An array of 100 pseudorandom "bool" values.  
var array<bool> randMask = array.new<bool>(100, true)  
// Push the first element from `randMask` to the end and queue a new pseudorandom value.  
randMask.push(randMask.shift())  
randMask.push(math.random(seed = 12345) < 0.5)  
randMask.shift()  
 
// Plot the `filteredMA()` of up to 100 unique `close` values filtered by the `randMask`.  
plot(filteredMA(close, 100, randMask)) 
```

--------------------------------

### Pine Script: Detect Substrings with str.match()

Source: https://www.tradingview.com/pine-script-docs/concepts/strings

This script demonstrates using str.match() with a regular expression to check if a symbol string starts with supported exchange prefixes (BATS, NASDAQ, NYSE, AMEX). It replaces multiple str.startswith() calls with a single, more concise regex match.

```Pine Script
//@version=6  
indicator("Matching substrings with regex demo")  
  
//@variable The symbol for which to request Short Sale Volume data.   
string symbolInput = input.symbol("NASDAQ:AAPL", "Symbol")  
  
//@variable `true` if the `symbolInput` starts with `BATS:`,  `NASDAQ:`,  `NYSE:`,  or `AMEX:`.  Otherwise, `false`.   
//         -  `^` at the beginning of the regex matches the start of the string.  
//         -  `(?:...)` defines a non-capturing group.  
//         -  `|` is an OR operator that allows the group to match one of the listed options.   
var bool supportedSymbol = str.match(symbolInput, "^(?:BATS|NASDAQ|NYSE|AMEX):") != ""  
  
//@variable The requested FINRA data if `supportedSymbol` is `true`, `na` otherwise.  
float requestedData = if supportedSymbol  
    //@variable The `symbolInput` value without the exchange prefix.  
    //         -  `(?<=:)` in the regex is a lookbehind assertion that checks if `:` precedes the match.  
    //         -  `.` matches any character except for line terminators in this context.  
    //         -  `+` is a quantifier that specifies one or more consecutive `.` matches.   
    var string noPrefix = str.match(symbolInput, "(?<=:).+")  
    //@variable A formatted string representing the ticker ID of a FINRA Short Sale Volume dataset.   
    var string finraTickerID = str.format("FINRA:{0}_SHORT_VOLUME", noPrefix)   

// Plot the `requestedData`  
plot(requestedData, "Short Sale Volume", color.teal, 1, plot.style_columns) 
```

--------------------------------

### Pine Script: Nested If-Else Structure Example

Source: https://www.tradingview.com/pine-script-docs/writing/profiling-and-optimization

This code snippet demonstrates a nested if-else structure in Pine Script to calculate an oscillator. It updates upper and lower bands based on the closing price and then calculates the oscillator value, plotting it with dynamic colors.

```Pine Script
//@version=6
indicator("switch" and "if...else if" results demo")

//@variable The upper band for oscillator calculation.
var float upperBand = close
//@variable The lower band for oscillator calculation.
var float lowerBand = close

// Update the `upperBand` and `lowerBand` based on the proximity of the `close` to the current band values.
if close > upperBand
    upperBand := close
else
    if close < lowerBand
        lowerBand := close
    else
        if upperBand - close > close - lowerBand
            upperBand := 0.9 * upperBand + 0.1 * close
        else
            if close - lowerBand > upperBand - close
                lowerBand := 0.9 * lowerBand + 0.1 * close

//@variable The ratio of the difference between `close` and `lowerBand` to the band range.
float oscillator = 100.0 * (close - lowerBand) / (upperBand - lowerBand)

// Plot the `oscillator` as columns with a dynamic color.
plot(
    oscillator, "Oscillator", oscillator > 50.0 ? color.teal : color.maroon,
    style = plot.style_columns, histbase = 50.0
)
```

--------------------------------

### Register Performance for Code Blocks

Source: https://www.tradingview.com/pine-script-docs/writing/profiling-and-optimization

Demonstrates registering performance information for specific code blocks using `registerPerf` and `System.timeNow()`. This pseudocode outlines how the profiler measures the execution time of different sections of a script.

```pseudocode
registerPerf(System.timeNow() - _start11, line11, line13) // Register performance info for the block (line 11 - 13).

long _start14 = System.timeNow() // Start time for line 14.
result / generations
registerPerf(System.timeNow() - _start14, line14) // Register performance info for line 14.

long _start16 = System.timeNow() // Start time for line 16.
var lcg = LCG.new(seedInput)
registerPerf(System.timeNow() - _start16, line16) // Register performance info for line 16.
```

--------------------------------

### Pine Script: Match Matrix Dimensions for Sum/Diff

Source: https://www.tradingview.com/pine-script-docs/language/matrices

Explains the requirement for matrices to have identical dimensions (rows and columns) when using the matrix.sum() and matrix.diff() functions. The example demonstrates an error caused by attempting to sum matrices with different shapes.

```Pine Script
//@version=6  
indicator("Invalid sum dimensions demo")  

//@variable A 2x3 matrix. 
matrix<float> m1 = matrix.new<float>(2, 3, 1) 
//@variable A 3x4 matrix.
matrix<float> m2 = matrix.new<float>(3, 4, 2) 

mSum = matrix.sum(m1, m2) // Raises an error. `m1` and `m2` don't have matching dimensions. 

plot(mSum.get(0, 0))  

```

--------------------------------

### Pine Script: Analyze 'switch' and 'if...else if' performance

Source: https://www.tradingview.com/pine-script-docs/writing/profiling-and-optimization

This example showcases how to analyze the performance of 'switch' and 'if...else if' structures in Pine Script. It highlights that the 'Line time' for these structures represents the total time spent on all conditional expressions, not just the first line. The code includes a 'switch' statement with multiple conditions and a plot for an oscillator.

```Pine Script
//@version=6
indicator("`switch` and `if...else if` results demo")

//@variable The upper band for oscillator calculation.
var float upperBand = close
//@variable The lower band for oscillator calculation.
var float lowerBand = close

// Update the `upperBand` and `lowerBand` based on the proximity of the `close` to the current band values.
// The "Line time" field on line 11 represents the time spent on all 4 conditional expressions in the structure.
switch
    close > upperBand                                  => upperBand := close
    close < lowerBand                                  => lowerBand := close
    upperBand - close > close - lowerBand              => upperBand := 0.9 * upperBand + 0.1 * close
    close - lowerBand > upperBand - close              => lowerBand := 0.9 * lowerBand + 0.1 * close

//@variable The ratio of the difference between `close` and `lowerBand` to the band range.
float oscillator = 100.0 * (close - lowerBand) / (upperBand - lowerBand)

// Plot the `oscillator` as columns with a dynamic color.
plot(
    oscillator, "Oscillator", oscillator > 50.0 ? color.teal : color.maroon,
    style = plot.style_columns, histbase = 50.0
)
```

--------------------------------

### Pine Script v5 to v6 Conversion

Source: https://www.tradingview.com/pine-script-docs/migration-guides/to-pine-version-6

Demonstrates the process of converting Pine Script v5 code to v6 using the Pine Editor's built-in conversion tool. The editor highlights the version annotation and offers a 'Convert code to v6' option.

```Pine Script
//@version=5
```

--------------------------------

### Pine Script Type Qualifiers Explained

Source: https://www.tradingview.com/pine-script-docs/language/type-system

This snippet details the 'const', 'input', 'simple', and 'series' type qualifiers in Pine Script. It explains their accessibility (compile time, input time, runtime) and mutability across script executions, crucial for understanding data behavior.

```Pine Script
/*
'const': Established at compile time. Values remain constant during every script execution.
'input': Established at input time. Values do not change as the script runs.
'simple': Established by the script at runtime, on the first available bar. Does not change on subsequent bars.
'series': Dynamic. Available at runtime and can change across bars.
*/

// Example usage (conceptual):
// const int compileTimeValue = 10
// input int userInput = 5
// simple int firstBarValue = close
// series float changingValue = close
```

--------------------------------

### Pine Script: Display bar index using plotchar()

Source: https://www.tradingview.com/pine-script-docs/concepts/text-and-shapes

This example demonstrates using the plotchar() function to display the bar index on the chart. It shows how to place the character at the top of the bar and explains the reasoning behind choosing `location.top` to avoid affecting the chart's scale.

```Pine Script
//@version=6  
indicator("", "", true)  
plotchar(bar_index, "Bar index", "", location.top)  

```

--------------------------------

### Pine Script: Visualize Matrix Elements in a Table

Source: https://www.tradingview.com/pine-script-docs/language/matrices

This comprehensive Pine Script example defines a 'toTable' method that visualizes matrix elements within a table. It utilizes nested 'for' loops to iterate through each element, converting it to a string for display. The method also supports adding a note to the bottom row of the table.

```Pine Script
//@version=6  
indicator("for loop demo", "Matrix to table")  

//@function Displays the elements of `this` matrix in a table.  
//@param      this The matrix to display.  
//@param      position The position of the table on the chart.  
//@param      bgColor The background color of the table.  
//@param      textColor The color of the text in each cell.  
//@param      note A note string to display on the bottom row of the table.  
//@returns    A new `table` object with cells corresponding to each element of `this` matrix.  
method toTable(
     matrix<float> this, string position = position.middle_center, 
     color bgColor = color.blue, color textColor = color.white, 
     string note = na 
) => 
    //@variable The number of rows in `this` matrix.  
    int rows = this.rows() 
    //@variable The number of columns in `this` matrix.  
    int columns = this.columns() 
    //@variable A table that displays the elements of `this` matrix with an optional `note` cell.  
    table result = table.new(position, columns, rows + 1, bgColor) 

    // Iterate over each row index of `this` matrix.  
    for row = 0 to rows - 1  
        // Iterate over each column index of `this` matrix on each `row`.  
        for col = 0 to columns - 1  
            //@variable The element from `this` matrix at the `row` and `col` index.  
            float element = this.get(row, col) 
            // Initialize the corresponding `result` cell with the `element` value.  
            result.cell(col, row, str.tostring(element), text_color = textColor, text_size = size.huge) 

    // Initialize a merged cell on the bottom row if a `note` is provided.  
    if not na(note) 
        result.cell(0, rows, note, text_color = textColor, text_size = size.huge) 
        result.merge_cells(0, rows, columns - 1, rows) 

    result // Return the `result` table.  

//@variable A 3x4 matrix of values.  
var m = matrix.new<float>()  

if bar_index == 0 
    // Add rows to `m`.  
    m.add_row(0, array.from(1, 2, 3)) 
    m.add_row(1, array.from(5, 6, 7)) 
    m.add_row(2, array.from(9, 10, 11)) 
    // Add a column to `m`.  
    m.add_col(3, array.from(4, 8, 12)) 
    // Display the elements of `m` in a table.  
    m.toTable()  
```

--------------------------------

### Creating a New Table in Pine Script

Source: https://www.tradingview.com/pine-script-docs/concepts/tables

Demonstrates the basic usage of `table.new()` to create a table object. This function defines the table's position, dimensions (rows and columns), and optional styling for borders and background. The returned table ID is used for subsequent operations.

```pinescript
myTable = table.new(position.top_right, 10, 5, #F0F0F0, 1, #CCCCCC, 1)
```

--------------------------------

### Pine Script: User-defined function with request.security()

Source: https://www.tradingview.com/pine-script-docs/writing/profiling-and-optimization

Demonstrates a user-defined function in Pine Script that utilizes request.security() to fetch data. The example shows how to calculate a composite average of multiple WMA values from a specified symbol using a Heikin Ashi ticker ID.

```Pine Script
//@version=6  
indicator("User-defined functions with `request.*()` calls demo", overlay = true)  
 
int multInput = input.int(10, "Length multiplier", 1)  
 
string tickerID = ticker.heikinashi(syminfo.tickerid)  
 
getCompositeAvg(string symbol, int lengthMult) => 
    request.security( 
       symbol, timeframe.period, math.avg( 
         ta.wma(close, lengthMult), ta.wma(close, 2 * lengthMult), ta.wma(close, 3 * lengthMult),  
         ta.wma(close, 4 * lengthMult), ta.wma(close, 5 * lengthMult), ta.wma(close, 6 * lengthMult),  
         ta.wma(close, 7 * lengthMult), ta.wma(close, 8 * lengthMult), ta.wma(close, 9 * lengthMult),  
         ta.wma(close, 10 * lengthMult) 
    ) 
  ) 
 
plot(getCompositeAvg(tickerID, multInput), "Composite average", linewidth = 3) 
```

--------------------------------

### Pine Script: Migrate input.symbol() usage

Source: https://www.tradingview.com/pine-script-docs/migration-guides/to-pine-version-5

Demonstrates the change in Pine Script v4 where input.symbol() was used as a type argument for the input() function, to the dedicated input.symbol() function in v5. This improves clarity and structure for input definitions.

```Pine Script
// Valid in v4. Not valid in v5.
aaplTicker = input("AAPL", type = input.symbol)
// Valid in v5
aaplTicker = input.symbol("AAPL")
```

--------------------------------

### Plot Previous and Current Day Open in Pine Script

Source: https://www.tradingview.com/pine-script-docs/faq/techniques

This script demonstrates how to plot the previous and current day's opening prices using the `timeframe.change()` function. It's designed for intraday timeframes and identifies daily bar openings to update yesterday's and today's open values.

```Pine Script
// @version=6  
indicator("Previous  and  current  day  open  using  `timeframe.change()`",  "",  true)  

bool  newDay  =  timeframe.change("1D")  
var  float  yesterdayOpen  =  na  
var  float  todayOpen      =  na  

if  newDay  
    yesterdayOpen  :=  todayOpen      //  We  reassign  this  value  first  
    todayOpen      :=  open      //  and  then  store  today's  open  

plot(yesterdayOpen,  "Yesterday's  Open",  newDay  ?  na  :  color.red,  2,  plot.style_line)  
plot(todayOpen,  "Today's  Open",  newDay  ?  na  :  color.green,  2,  plot.style_line)  
bgcolor(newDay  ?  color.new(color.gray,  80)  :  na)
```

--------------------------------

### Pine Script: Get Bar Open Time with Session and Timezone

Source: https://www.tradingview.com/pine-script-docs/concepts/time

Retrieves the UNIX timestamp for the opening of a bar on a specified timeframe, filtered by a custom session and timezone. Handles cases where the bar falls outside the session.

```Pine Script
time(timeframe, session, timezone, bars_back)
// Example: time("D", "0930-1600:23456", "America/New_York", 0)
```

--------------------------------

### Pine Script: Plotting Close Price (Unused Code)

Source: https://www.tradingview.com/pine-script-docs/writing/profiling-and-optimization

This example demonstrates a Pine Script that plots the closing price. It includes calculations for `barsInRange` which are not used in the output. The compiler discards these unused calculations, and the Profiler shows no performance results for them.

```Pine Script®
//@version=6  
indicator("Unused code demo")  

//@variable The number of historical bars in the calculation.  
int lengthInput = input.int(100, "Length", 1)  

//@variable The number of closes over `lengthInput` bars between the current bar's `high` and `low`.  
int barsInRange = 0  

for i = 1 to lengthInput  
    //@variable The `close` price from `i` bars ago.    
    float pastClose = close[i]  
    // Add 1 to `barsInRange` if the `pastClose` is between the current bar's `high` and `low`.  
    if pastClose > low and pastClose < high  
      barsInRange += 1  

// Plot the `close` price. This is the only output.  
// Since the outputs do not require any of the above calculations, the compiled script will not execute them.  
plot(close)  

```

--------------------------------

### Pine Script v4 to v5: Renamed Functions and Parameters (No Namespace Change)

Source: https://www.tradingview.com/pine-script-docs/migration-guides/to-pine-version-5

Details Pine Script function and parameter renames that do not involve a namespace change, such as `study` to `indicator` and `strategy.entry(long)` to `strategy.entry(direction)`.

```Pine Script
study(<...>, resolution, resolution_gaps, <...>) // Renamed to indicator(<...>, timeframe, timeframe_gaps, <...>)
strategy.entry(long) // Renamed to strategy.entry(direction)
strategy.order(long) // Renamed to strategy.order(direction)
time(resolution) // Renamed to time(timeframe)
time_close(resolution) // Renamed to time_close(timeframe)
nz(x, y) // Renamed to nz(source, replacement)
```

--------------------------------

### Debug Loop Information with Strings and Arrays

Source: https://www.tradingview.com/pine-script-docs/writing/debugging

This script enhances the previous example by demonstrating two methods for debugging loop execution. It collects loop iteration data into a string and an array. The string logs detailed information per iteration, while the array stores ROC values. After the loop, it logs the string and displays array data using labels and plots.

```Pine Script
//@version=6  
indicator("Collecting loop information demo", "Average ROC", max_labels_count = 500)   

//@variable The number of bars in the calculation.  
int lookbackInput = input.int(20, "Lookback", 1)   

//@variable An array containing the `roc` value from each loop iteration.  
array<float> debugValues = array.new<float>() 
//@variable A string containing information about the `roc` value on each iteration.  
string logText = ""   

//@variable The average ROC of `close` over lags from 1 to `lookbackInput` bars.  
float aroc = 0.0   

// Calculation loop.  
for length = 1 to lookbackInput  
  //@variable The `close` value `length` bars ago.    
  float pastClose = close[length]     
  //@variable The `close` rate of change over `length` bars.    
  float roc = (close - pastClose) / pastClose     
  // Add the `roc` to `aroc`.    
  aroc += roc     
  // Concatenate a new "string" representation with the `debugText`.    
  logText += "
length: " + str.tostring(length) + ", roc: " + str.tostring(roc)     
  // Push the `roc` value into the `debugValues` array.    
  array.push(debugValues, roc)     

// Divide `aroc` by the `lookbackInput`.  
aroc /= lookbackInput  

// Plot the `aroc`.  
plot(aroc, "aroc", color.blue, 3)   

// Log the `logText` in the Pine Logs pane when the bar is confirmed.  
if barstate.isconfirmed 
  log.info(logText)   

// Draw a label with a tooltip containing a "string" representation of the `debugValues` array.  
label.new(bar_index, aroc, color = color.new(color.blue, 70), tooltip = str.tostring(debugValues))   

// Plot the `roc` values from the first and last iteration.  
plot(array.first(debugValues), "First iteration roc", color.new(color.teal, 50), 2) 
plot(array.last(debugValues), "Last iteration roc", color.new(color.maroon, 50), 2)   
```

--------------------------------

### Pine Script: Color Picker with Transparency (Series Color)

Source: https://www.tradingview.com/pine-script-docs/concepts/colors

Illustrates a Pine Script indicator where adding transparency using color.new() with a dynamic condition results in a 'series color', disabling the automatic color picker in the 'Settings/Style' menu.

```Pine Script
//@version=6
indicator("Color picker showcase")
plotColor = color.new(close > open ? color.teal : color.red, 50)
plot(close, color = plotColor)

```

--------------------------------

### Pine Script: Create and Access Matrix Element

Source: https://www.tradingview.com/pine-script-docs/language/matrices

Demonstrates creating a matrix of a custom user-defined type (UDT) and accessing its elements. It shows how to create a matrix, get a row, access an element within that row, and modify its value, noting that changes to the element also affect the original matrix.

```Pine Script
//@version=6

// Define a custom user-defined type (UDT)
struct myUDT
    float value = 0.0

// Create a matrix of myUDT with one row, one column, and an initial value.
var matrix<myUDT> m = matrix.new<myUDT>(1, 1, myUDT.new())

// Get a shallow copy of the first row of the matrix.
array<myUDT> row = m.row(0)

// Get the first element from the row array.
myUDT firstElement = row.get(0)

// Modify the 'value' field of the firstElement. This change also affects the original matrix.
firstElement.value += 1.0

// Plot the 'value' of the myUDT object from the first row and column of the matrix.
plot(m.get(0, 0).value, linewidth = 3)
```

--------------------------------

### Fix Undeclared Identifier 'input.%input_name%' in Pine Script

Source: https://www.tradingview.com/pine-script-docs/migration-guides/to-pine-version-5

Demonstrates how to resolve 'undeclared identifier' errors by updating input declarations from `input.*` constants to the new `input.type()` format in Pine Script v5.

```Pine Script
// Will cause an error during conversion  
_integer = input.integer  
_bool = input.bool  
i1 = input(1, "Integer", _integer)  
i2 = input(true, "Boolean", _bool)  

// Will work in v5  
i1 = input.int(1, "Integer")  
i2 = input.bool(true, "Boolean")  
```

--------------------------------

### Pine Script: Color Picker with Transparency (Const Color)

Source: https://www.tradingview.com/pine-script-docs/concepts/colors

Shows how to maintain the automatic color picker in Pine Script when using transparency by applying color.new() to individual constant colors before they are conditionally assigned to a plot.

```Pine Script
//@version=6
indicator("Color picker showcase")
plotColor = close > open ? color.new(color.teal, 50) : color.new(color.red, 50)
plot(close, color = plotColor)

```

--------------------------------

### Create Color Inputs for Plot Customization in Pine Script®

Source: https://www.tradingview.com/pine-script-docs/concepts/inputs

This example shows how to create color inputs in Pine Script® using `input.color()` to allow users to customize plot colors and transparency. It defines inputs for the Moving Average (MA) color and Bollinger Bands (BB) color, and uses these inputs to dynamically set plot colors and transparency based on price action relative to the BBs.

```Pine Script®
//@version=6
indicator("MA", "", true)
maLengthInput = input.int(10,               "MA      length", inline = "01", minval = 1)
maColorInput  = input.color(color.aqua,       "",               inline = "01")
bbFactorInput = input.float(1.5,             "BB      factor", inline = "02", minval = 0, step = 0.5)
bbColorInput  = input.color(color.gray,       "",               inline = "02")
showBBInput   = input.bool(true,             "Show    BB",       inline = "02")
ma       = ta.sma(close, maLengthInput)
bbWidth = ta.stdev(ma, maLengthInput) * bbFactorInput
bbHi     = ma + bbWidth
bbLo     = ma - bbWidth
bbHiColor = color.new(bbColorInput, high > bbHi ? 60 : 0)
bbLoColor = color.new(bbColorInput, low  < bbLo ? 60 : 0)
plot(ma, "MA", maColorInput)
plot(showBBInput ? bbHi : na, "BB      Hi", bbHiColor, 2)
plot(showBBInput ? bbLo : na, "BB      Lo", bbLoColor, 2)

```

--------------------------------

### Demonstrate Shallow Map Copy in Pine Script®

Source: https://www.tradingview.com/pine-script-docs/language/maps

This script demonstrates creating a shallow copy of a map in Pine Script®. It initializes a map with random values, creates a shallow copy, modifies the copy, and then displays both maps using a custom label function. The `map.copy()` function is used for creating the shallow copy.

```Pine Script®
`//@version=6  
indicator("Shallow copy demo")  
  
//@function Displays the key-value pairs of `this` map in a label.   
method debugLabel(
     map<string, float> this, int barIndex = bar_index, color bgColor = color.blue,
     color textColor = color.white, string note = ""  
 ) =>  
    //@variable The text to display in the label.  
    labelText = note + "
{"  
    for [key, value] in this  
        labelText += str.format("{0}: {1}, ", key, value)  
    labelText := str.replace(labelText, ", ", "}", this.size() - 1)  
  
    if barstate.ishistory  
        label result = label.new(  
             barIndex, 0, labelText, color = bgColor, style = label.style_label_center,   
             textcolor = textColor, size = size.huge  
         )  

if bar_index == last_bar_index - 1  
    //@variable A map of `string` keys and random `float` values.  
    m = map.new<string, float>()  
  
    // Assign random values to an array of keys in `m`.  
    for key in array.from("A", "B", "C", "D")  
        m.put(key, math.random(0, 10))  
  
    //@variable A shallow copy of `m`.  
    mCopy = m.copy()  
  
    // Assign the insertion order value `i` to each `key` in `mCopy`.  
    for [i, key] in mCopy.keys()  
        mCopy.put(key, i)  
  
    // Display the labels.  
    m.debugLabel(bar_index, note = "Original")  
    mCopy.debugLabel(bar_index + 10, color.purple, note = "Copied and changed")  
`
```

--------------------------------

### Pine Script: Get Time of First Bar

Source: https://www.tradingview.com/pine-script-docs/faq/times-dates-and-sessions

Initializes a variable with the time of the first bar in the dataset using the 'var' keyword. The 'time' built-in represents the bar open time in UNIX format (milliseconds).

```Pine Script
//@version=6
indicator('Time at first bar')
// Capture the time of the first bar in the dataset.
var int t = time
plot(t)

```

--------------------------------

### Pine Script: Workaround for Tuple Element Limit

Source: https://www.tradingview.com/pine-script-docs/writing/limitations

Demonstrates how to overcome the 127-element tuple limit in request.security() calls by using user-defined types (UDTs). The first example shows the error-causing scenario with too many elements, while the second illustrates the correct implementation using a UDT.

```Pine Script®
//@version=6  
indicator("Tuple element limit")  
  
s1 = close  
s2 = close * 2  
...

s128 = close * 128  
  
// Causes an error.   
[v1, v2, v3, ..., v128] = request.security(syminfo.tickerid, "1D", [s1, s2, s3, ..., s128])  
  
// Works fine:  
type myType  
    float v1  
    float v2  
    float v3  
    ...  
    float v128  
  
myObj = request.security(syminfo.tickerid, "1D", myType.new(s1, s2, s3, ..., s128))  

```

--------------------------------

### Pseudocode: Profiler Wrapping Full Script

Source: https://www.tradingview.com/pine-script-docs/writing/profiling-and-optimization

Pseudocode illustrating how the Pine Profiler wraps a complete script for performance analysis. It shows the insertion of internal timing and registration functions around significant code sections, including loops and individual lines, while excluding declarations and insignificant code.

```Pine Script
long _startMain = System.timeNow() // Start time for the script's overall execution.  

// <Additional internal code executes here>  

//@version=6  
indicator("Profiler's workings demo") // Declaration statements do not require profiling.  

int seedInput = input.int(12345, "Seed") // Variable declaration without significant calculation.  

type LCG        // Type declarations do not require profiling.  
    float state

method generate(LCG this, int generations = 1) => // Function signature does not affect runtime.  
    float result = 0.0 // Variable declaration without significant calculation.  

    long _start11 = System.timeNow() // Start time for the loop block that begins on line 11.  
    for i = 1 to generations // Loop header calculations are not independently wrapped.  

        long _start12 = System.timeNow() // Start time for line 12.  
        this.state := 16807 * this.state % 2147483647
        registerPerf(System.timeNow() - _start12, line12) // Register performance info for line 12.  

        long _start13 = System.timeNow() // Start time for line 13.  
        result += this.state / 2147483647
        registerPerf(System.timeNow() - _start13, line13) // Register performance info for line 13.  


```

--------------------------------

### Chart Visible Bar Time in Pine Script

Source: https://www.tradingview.com/pine-script-docs/concepts/time

Pine Script provides variables to get the timestamps for the leftmost (chart.left_visible_bar_time) and rightmost (chart.right_visible_bar_time) visible bars on the chart. This is useful for calculations involving the currently displayed chart range.

```pinescript
//@version=5
indicator("Chart Visible Bars Time")

// Get the time of the leftmost visible bar
left_bar_time = chart.left_visible_bar_time

// Get the time of the rightmost visible bar
right_bar_time = chart.right_visible_bar_time

// Displaying values (for demonstration)
plot(left_bar_time, title="Left Visible Bar Time")
plot(right_bar_time, title="Right Visible Bar Time")
```

--------------------------------

### Demonstrate Repeated Variable Declarations in Pine Script

Source: https://www.tradingview.com/pine-script-docs/language/execution-model

This Pine Script example illustrates how variables declared without the 'var' keyword are re-declared and re-initialized on each bar. The script plots a constant value of 10 because the variable 'x' is reset to 0 on every execution.

```Pine Script
//@version=6  
indicator("Repeated declarations demo")  
  
//@variable A user-defined variable. The script declares this variable and initializes it to 0 on *every* execution.  
int x = 0  
  
// Increase the value of `x` by 10 on every bar.  
x += 10  
  
// Plot the value of `x`.  
// Because `x` begins at 0 on every execution, and the script adds 10 to that value, the plotted value is always 10.  
plot(x, "`x` value", color.blue, 3)  

```

--------------------------------

### Pine Script: Get Higher Timeframe ATR

Source: https://www.tradingview.com/pine-script-docs/faq/other-data-and-timeframes

Retrieves the Average True Range (ATR) from the daily timeframe using the request.security() function. This allows you to plot indicators from a different timeframe onto your current chart.

```Pine Script
//@version=5
indicator("HTF ATR")
float higherTfAtr = request.security(symbol = syminfo.tickerid, timeframe = "1D", expression = ta.atr(14))
plot(higherTfAtr)

```

--------------------------------

### Pine Script v4 to v5 Conversion

Source: https://www.tradingview.com/pine-script-docs/release-notes

Pine Script includes a v4 to v5 converter within the editor to assist users in migrating their existing scripts. Refer to the Pine Script v5 Migration guide for detailed instructions.

```Pine Script
// Conversion is handled by the Pine Script Editor's built-in tools.
```

--------------------------------

### Request Economic Data (Pine Script®)

Source: https://www.tradingview.com/pine-script-docs/concepts/other-timeframes-and-data

This example demonstrates how to use the request.economic() function to fetch the GDP growth rate for the United States. It then calculates the maximum and minimum growth rates and plots the GDP growth with a gradient color based on its value.

```Pine Script®
//@version=6  
indicator("Requesting economic data demo")  
  
//@variable The GDP growth rate for the US economy.  
float gdpqq = request.economic("US", "GDPQQ")  
  
//@variable The all-time maximum growth rate.  
float maxRate = ta.max(gdpqq)  
//@variable The all-time minimum growth rate.  
float minRate = ta.min(gdpqq)  
  
//@variable The color of the `gdpqq` plot.  
color rateColor = switch  
    gdpqq >= 0 =>  color.from_gradient(gdpqq, 0, maxRate, color.purple, color.blue)  
    =>             color.from_gradient(gdpqq, minRate, 0, color.red, color.purple)  
  
// Plot the results.  
plot(gdpqq, "US GDP Growth Rate", rateColor, style = plot.style_area)  
```

--------------------------------

### Pine Script: Array as a Stack with Logging

Source: https://www.tradingview.com/pine-script-docs/faq/data-structures

This script demonstrates using arrays as stacks to track lines drawn from pivot points. It includes functions to add, extend, and remove lines from the stack, with logging enabled to track array operations and line status. The script utilizes `log.info` and `log.warning` for detailed output.

```Pine Script
`
```

--------------------------------

### Matrix Element Access with Nested For...in Loops

Source: https://www.tradingview.com/pine-script-docs/language/loops

Presents a more concise method for accessing matrix elements by using nested for...in loops, where the outer loop gets row arrays and the inner loop iterates through elements of each row.

```Pine Script
for rowArray in myMatrix
    for element in rowArray
```

--------------------------------

### Pine Script v6 Strategy: Track Trade Direction with Integer

Source: https://www.tradingview.com/pine-script-docs/migration-guides/to-pine-version-6

This Pine Script v6 code demonstrates how to manage trade direction by using an integer variable. It assigns -1 for short positions, 1 for long positions, and 0 for no positions, addressing the change in boolean logic from previous versions. The script also visually indicates the trade direction using background colors and displays the current state in a table and a label.

```Pine Script
//@version=6  
strategy("Bool `na` demo v6", overlay=true, margin_long=100, margin_short=100)   
  
// Strategy's long and short trades are based on moving average cross over/under.   
longCondition = ta.crossover(ta.sma(close, 14), ta.sma(close, 28))  
if (longCondition)   
    strategy.entry("My Long Entry Id", strategy.long)   
  
shortCondition = ta.crossunder(ta.sma(close, 14), ta.sma(close, 28))  
if (shortCondition)   
    strategy.entry("My Short Entry Id", strategy.short)   
  
//@variable Integer variable that tracks the current direction of the trade.   
// Is `-1` when `position_size` is less than 0 (short), `+1` when `position_size` is greater than 0 (long),   
//  and `0` when `position_size` is equal to 0 (no trades).  
int tradeDirection = if strategy.position_size < 0   
    -1  
else if strategy.position_size > 0   
    1  
else    //strategy.position_size == 0   
    0  
  
//@variable Background color, set depending on the `tradeDirection`.  
color directionColor = switch   
    tradeDirection == 1  => color.new(color.blue, 90)        // Blue color if long position.   
    tradeDirection == -1 => color.new(color.orange, 90)      // Orange color if short position.   
    tradeDirection == 0  =>  na                                // No color if no position.   
bgcolor(directionColor)  
  
// On the first bar, display the value of `tradeDirection` in a table for reference.   
var table t = table.new(position.bottom_right, 2, 3, color.yellow, frame_color = color.black, frame_width = 1)  
if barstate.isfirst  
    t.cell(0, 0, "On first bar")  
    t.cell(0, 1, "`tradeDirection` value:", bgcolor = color.new(color.green, 60))  
    t.cell(1, 1, str.tostring(tradeDirection), bgcolor = color.new(color.green, 60))  
  
    //@variable A "string" representation of `tradeDirection` value on current bar.   
    string directionString = tradeDirection == 1 ? "Long" : tradeDirection == -1 ? "Short" : "No entered positions"   
    t.cell(0, 2, "State: ")  
    t.cell(1, 2, directionString)  
  
if barstate.islastconfirmedhistory  
    //@variable A "string" representation of `tradeDirection`  value on current bar.   
    string directionString = tradeDirection == 1 ? "Long" : tradeDirection == -1 ? "Short" : "No entered positions"   
    label.new(bar_index, high, "On last bar \n `tradeDirection` value: " + str.tostring(tradeDirection)   
         + "\n State: "+ directionString)  

```

--------------------------------

### Visualizing Past and Future Data with plot() Offset

Source: https://www.tradingview.com/pine-script-docs/concepts/plots

Illustrates how to use the `offset` parameter in the plot() function to display data from past or future bars. This example plots the closing price, shifting one series five bars to the left (past) and another five bars to the right (future).

```Pine Script
//@version=6
indicator("",  "",  true)
plot(close,  "Offset of -5 (in the past)",   color = color.red,  offset = -5)
plot(close,  "Offset of +5 (in the future)",  color = color.lime,  offset = 5)

```

--------------------------------

### Implement On/Off Switch in Pine Script

Source: https://www.tradingview.com/pine-script-docs/faq/techniques

Shows how to create a persistent on/off switch using the `var` keyword in Pine Script. The switch state is maintained across bars and can be toggled by specific conditions. The script visually indicates the switch state with background colors and text labels.

```Pine Script
//@version=6  
indicator("On/Off condition example", overlay = true)  
  
bool upBar = close > open  
  
// On/off conditions.  
bool triggerOn  = upBar and upBar[1] and upBar[2]  
bool triggerOff = not upBar and not upBar[1]  
  
// Switch state is saved across bars.  
var bool onOffSwitch = false  
  
// Turn the switch on or off, otherwise persist its state.  
onOffSwitch := triggerOn ? true : triggerOff ? false : onOffSwitch  
  
bgcolor(onOffSwitch ? color.new(color.green, 90) : na)  
plotchar(triggerOn,  "triggerOn",  "▲", location.belowbar, color.lime, size = size.tiny, text = "On")  
plotchar(triggerOff, "triggerOff", "▼", location.abovebar, color.red,  size = size.tiny, text = "Off")  
```

--------------------------------

### Requesting Currency Rates with request.currency_rate() and request.security()

Source: https://www.tradingview.com/pine-script-docs/concepts/other-timeframes-and-data

This example demonstrates how to request currency conversion rates using both request.currency_rate() and request.security(). It converts Turkish Lira (TRY) to South Korean Won (KRW) using daily rates and plots both results for comparison. The request.security() method requires constructing a spread symbol and using specific parameters for non-repainting behavior.

```Pine Script®
//@version=6  
indicator("Requesting currency rates demo")  

//@variable The currency to convert.  
simple string fromCurrency  = currency.TRY  
//@variable The resulting currency.  
simple string toCurrency  = currency.KRW  

//@variable The spread symbol to request. Required in `request.security()` because no direct symbol exists.  
simple string spreadSymbol  = str.format("{0}{2} * {2}{1}", fromCurrency, toCurrency, currency.USD)  

//@variable The non-repainting conversion rate from `request.security()` using the `spreadSymbol`.  
float securityRequestedRate  = request.security(spreadSymbol, "1D", close[1], lookahead  = barmerge.lookahead_on)  
//@variable The non-repainting conversion rate from `request.currency_rate()`.  
float nonSecurityRequestedRate  = request.currency_rate(fromCurrency, toCurrency)  

// Plot the requested rates. We can multiply TRY values by these rates to convert them to KRW.  
plot(securityRequestedRate, "`request.security()` value", color.purple, 5)  
plot(nonSecurityRequestedRate, "`request.currency_rate()` value", color.yellow, 2)  

```

--------------------------------

### Pine Script: Calling a single-line function

Source: https://www.tradingview.com/pine-script-docs/language/user-defined-functions

Demonstrates how to call a previously defined single-line function with different argument types. The example shows calls with series, integer, and mixed types, illustrating how Pine Script infers the resulting variable type.

```Pine Script
a = f(open, close)
b = f(2, 2)
c = f(open, 2)
```

--------------------------------

### Pine Script: `na` and Unique Types Demo v5

Source: https://www.tradingview.com/pine-script-docs/migration-guides/to-pine-version-6

Demonstrates how Pine Script v5 handles `na` values with unique type parameters in the `plot()` function. This version allows `na` to be passed, resulting in default styling.

```Pine Script
//@version=5  
indicator("`na` and unique types demo v5")  
  
//@variable User-selected "string" to determine type of plot used for `plot()` function's `style` argument.  
string inputStyle = input.string("Area", "Plot style", options = ["Area", "Columns", "Histogram", "Stepline-diamond"])  
  
// Initialize an `input plot_style` type variable based on user's selected `inputStyle`.  
selectedPlotStyle = switch inputStyle  
    "Area"             => plot.style_area  
    "Columns"          => plot.style_columns  
    "Histogram"        => plot.style_histogram  
    "Stepline-diamond" => plot.style_stepline_diamond  
// `switch` statement covers all `inputStyle` options, but does not include `default` block.  
// Valid in v5. Invalid in v6 - `switch` statement must include a `default` block, otherwise raises error.  
  
plot(close, "Source plot", color.blue, 2, style = selectedPlotStyle)  
  
//@variable Toggle for the style of the line plotted at price "100".  
inputHundredStyle = input.bool(true, " Use crosses style for '100-line'")  
  
hundredLineStyle = if inputHundredStyle  
    plot.style_cross  
// Since there is no `else` block, setting `inputHundredStyle` to `false` makes this variable `na`.  
// In v5, passing `na` to the `style` parameter makes the `plot()` function use its default style `plot.style_line`.  
// In v6, this raises a compilation error because `style` cannot be `na`.  
  
// Plot the "100-line" using the `hundredLineStyle` style constant.  
plot(100, "100-line", color.orange, 4, style = hundredLineStyle)  

```

--------------------------------

### Pine Script: Analyze 'if' block performance

Source: https://www.tradingview.com/pine-script-docs/writing/profiling-and-optimization

This code snippet demonstrates how to analyze the performance of a simple 'if' statement using Pine Script's Profiler. It shows the structure of an 'if' block and explains how the Profiler's 'Time' and 'Line time' fields provide insights into the execution duration of the entire block and its first line.

```Pine Script
if math.abs(close - 0.5 * (upperPercentile + lowerPercentile)) > 0.5 * (upperPercentile - lowerPercentile)
    array.push(upperDistances, math.max(close - upperPercentile, 0.0))
    array.shift(upperDistances)
    array.push(lowerDistances, math.max(lowerPercentile - close, 0.0))
    array.shift(lowerDistances)
```

--------------------------------

### Pine Script: Draw Triangle with Annotations

Source: https://www.tradingview.com/pine-script-docs/language/script-structure

This Pine Script example demonstrates drawing a triangle using user-defined points on a chart. It utilizes compiler annotations like //@version, //#region, and //#endregion for script versioning, code organization, and documentation. It also defines a custom 'Triangle' type and a 'drawTriangle' function, showcasing the use of //@type, //@field, //@function, and //@param annotations.

```Pine Script
//@version=6  
indicator("Triangle", "", true)  
  
//#region ———————————————————— Constants and inputs  
  
int   TIME_DEFAULT  = 0  
float PRICE_DEFAULT = 0.0  
  
x1Input = input.time(TIME_DEFAULT,   "Point 1", inline = "1", confirm = true)  
y1Input = input.price(PRICE_DEFAULT, "",        inline = "1", tooltip = "Pick point 1", confirm = true)  
x2Input = input.time(TIME_DEFAULT,   "Point 2", inline = "2", confirm = true)  
y2Input = input.price(PRICE_DEFAULT, "",        inline = "2", tooltip = "Pick point 2", confirm = true)  
x3Input = input.time(TIME_DEFAULT,   "Point 3", inline = "3", confirm = true)  
y3Input = input.price(PRICE_DEFAULT, "",        inline = "3", tooltip = "Pick point 3", confirm = true)  
//#endregion  
  
//#region ———————————————————— Types and functions  
  
// @type            Used to represent the coordinates and color to draw a triangle.  
// @field time1     Time of first point.  
// @field time2     Time of second point.  
// @field time3     Time of third point.  
// @field price1    Price of first point.  
// @field price2    Price of second point.  
// @field price3    Price of third point.  
// @field lineColor Color to be used to draw the triangle lines.  
type Triangle  
    int   time1  
    int   time2  
    int   time3  
    float price1  
    float price2  
    float price3  
    color lineColor  
  
//@function Draws a triangle using the coordinates of the `t` object.  
//@param t  (Triangle) Object representing the triangle to be drawn.  
//@returns  The ID of the last line drawn.  
drawTriangle(Triangle t) =>  
    line.new(t.time1, t.price1, t.time2, t.price2, xloc = xloc.bar_time, color = t.lineColor)  
    line.new(t.time2, t.price2, t.time3, t.price3, xloc = xloc.bar_time, color = t.lineColor)  
    line.new(t.time1, t.price1, t.time3, t.price3, xloc = xloc.bar_time, color = t.lineColor)  
//#endregion  
  
//#region ———————————————————— Calculations  
  
// Draw the triangle only once on the last historical bar.  
if barstate.islastconfirmedhistory  
    //@variable Used to hold the Triangle object to be drawn.  
    Triangle triangle = Triangle.new()  
  
    triangle.time1  := x1Input  
    triangle.time2  := x2Input  
    triangle.time3  := x3Input  
    triangle.price1 := y1Input  
    triangle.price2 := y2Input  
    triangle.price3 := y3Input  
    triangle.lineColor := color.purple  
  
    drawTriangle(triangle)  
//#endregion  
```

--------------------------------

### Calculate and Plot Ratio with EMA in Pine Script®

Source: https://www.tradingview.com/pine-script-docs/writing/debugging

This script calculates the ratio of a bar's price difference to its range and plots the ratio and its EMA. It uses request.security_lower_tf() to get lower timeframe close prices and ta.ema() for smoothing. The plots are styled as columns and an area.

```Pine Script®
//@version=6
indicator("Displaying collection strings demo")

//@variable The length of the EMA.
int lengthInput = input.int(20, "EMA length", 1)

//@variable An array of `close` prices requested for the chart's symbol at the 1-minute timeframe.
array<float> intrabarPrices = request.security_lower_tf("", "1", close)

//@variable The average `close` price of the intrabars within the current chart bar.
float avgPrice = intrabarPrices.avg()
//@variable The bar's total range.
float barRange = high - low

//@variable The difference between `close` and `avgPrice`, normalized by the `barRange`.
float ratio = (close - avgPrice) / barRange
//@variable The EMA of the `ratio`.
float smoothed = ta.ema(ratio, lengthInput)

// Plot the `ratio` series as conditionally-colored columns.
plot(ratio, "", ratio > 0 ? color.teal : color.maroon, 1, plot.style_columns)
// Display the `smoothed` series as a translucent orange area plot.
plot(smoothed, "", color.new(color.orange, 40), 1, plot.style_area)

```

--------------------------------

### Pine Script: Conditional Assignment with Matching Types

Source: https://www.tradingview.com/pine-script-docs/language/conditional-structures

Shows a Pine Script example where an 'if' statement assigns a value to a variable, demonstrating that all branches must return compatible types (e.g., 'float' in this case) to avoid compilation errors.

```Pine Script
x = if close > open 
    close 
  else 
      open 

```

--------------------------------

### Pine Script: `const` with Reference Types (Valid)

Source: https://www.tradingview.com/pine-script-docs/language/type-system

Demonstrates the correct usage of `const` with reference types in Pine Script®. This example shows that while reassignment is prevented, modifying the contents of the referenced array using `array.set()` is allowed.

```Pine Script®
//@version=6  
indicator("Using `const` with reference types demo")  

//@variable Holds a reference to an array of three random "float" values.  
// Although the variable is declared using `const`, the reference returned by `array.from()` has the "series"  
// qualifier, because each execution creates a new, unique array object. Additionally, all elements in the  
// array are of the type "series float".  
// This *does not* cause an error, because the script does not *reassign* the variable during any execution.  
const array<float> randArray = array.from(math.random(), math.random(), math.random())  

// Plot the sum of the `randArray` elements.  
plot(randArray.sum())  
```

--------------------------------

### Pine Script: Apply Color Changes and Default Label Color (v6)

Source: https://www.tradingview.com/pine-script-docs/migration-guides/to-pine-version-6

Demonstrates the updated color constants in Pine Script v6, such as color.yellow and color.red, which have slightly different hex values compared to v5. It also shows the new default text color for label.new() being color.white in v6, ensuring better visibility.

```Pine Script
//\t//@version=6  
//tindicator("Default colors v6")  
//t 
//t color defaultColor = switch  
//t    bar_index == last_bar_index     => color.yellow  
//t    bar_index == last_bar_index - 1 => color.green  
//t    bar_index == last_bar_index - 2 => color.red  
//t    => na  
//tbgcolor(defaultColor)  
//t 
//tif barstate.islastconfirmedhistory  
//t    label.new(bar_index + 2, 0, "Default text color")  
//t
```

--------------------------------

### Conditional Plotting Based on String Input

Source: https://www.tradingview.com/pine-script-docs/concepts/inputs

This Pine Script® example demonstrates how to use a string input to control script behavior. It compares the user-selected option ('On' or 'Off') from an input dropdown to a predefined string. Based on the comparison, it conditionally plots the 'close' price or 'na' (not available).

```Pine Script®
//@version=6
indicator("Input in an expression", "", true)
bool plotDisplayInput = input.string("On", "Plot Display", options = ["On", "Off"]) == "On"
plot(plotDisplayInput ? close : na)

```

--------------------------------

### Create Display Panel with MAs

Source: https://www.tradingview.com/pine-script-docs/concepts/tables

This Pine Script code creates a display panel showing user-selected Moving Average (MA) values. It allows customization of the number of MAs, their starting periods, the increment between periods, panel position, and colors for bull, bear, and neutral price conditions. The table dynamically updates on the last bar, displaying MA periods and their values with corresponding background colors.

```Pine Script

//@version=6  
indicator("Price vs MA", "", true)

var string GP1 = "Moving averages"
int    masQtyInput    =  input.int(20, "Quantity", minval = 1, maxval = 40, group = GP1, tooltip = "1-40")
int    masStartInput   =  input.int(20, "Periods begin at", minval = 2, maxval = 200, group = GP1, tooltip = "2-200")
int    masStepInput   =  input.int(20, "Periods increase by", minval = 1, maxval = 100, group = GP1, tooltip = "1-100")

var string GP2 = "Display"
string  tableYposInput = input.string("top", "Panel position", inline = "11", options = ["top", "middle", "bottom"], group = GP2)
string  tableXposInput = input.string("right", "", inline = "11", options = ["left", "center", "right"], group = GP2)
color   bullColorInput = input.color(color.new(color.green, 30), "Bull", inline = "12", group = GP2)
color   bearColorInput = input.color(color.new(color.red, 30), "Bear", inline = "12", group = GP2)
color   neutColorInput = input.color(color.new(color.gray, 30), "Neutral", inline = "12", group = GP2)

//@variable The table's `position.* argument based on the chosen `tableXposInput` and `tableYposInput`.
var string tablePosition = switch
      tableXposInput == "left"  and tableYposInput == "top"    => position.top_left
      tableXposInput == "left"  and tableYposInput == "middle" => position.middle_left
      tableXposInput == "left"  and tableYposInput == "bottom" => position.bottom_left
      tableXposInput == "center" and tableYposInput == "top"    => position.top_center
      tableXposInput == "center" and tableYposInput == "middle" => position.middle_center
      tableXposInput == "center" and tableYposInput == "bottom" => position.bottom_center
      tableXposInput == "right"  and tableYposInput == "top"    => position.top_right
      tableXposInput == "right"  and tableYposInput == "middle" => position.middle_right
      tableXposInput == "right"  and tableYposInput == "bottom" => position.bottom_right

var table panel = table.new(tablePosition, 2, masQtyInput + 1)
if barstate.islast
    // Table header.
    table.cell(panel, 0, 0, "MA", bgcolor = neutColorInput)
    table.cell(panel, 1, 0, "Value", bgcolor = neutColorInput)

int period = masStartInput
for i = 1 to masQtyInput
    // ————— Call MAs on each bar.
    float ma = ta.sma(close, period)
    // ————— Only execute table code on last bar.
    if barstate.islast
       // Period in left column.
       table.cell(panel, 0, i, str.tostring(period), bgcolor = neutColorInput)
       // If MA is between the open and close, use neutral color. If close is lower/higher than MA, use bull/bear color.
       bgColor = close > ma ? open < ma ? neutColorInput : bullColorInput : open > ma ? neutColorInput : bearColorInput
       // MA value in right column.
       table.cell(panel, 1, i, str.tostring(ma, format.mintick), text_color = color.black, bgcolor = bgColor)
  period += masStepInput

```

--------------------------------

### Pine Script Range Quantifier {n, m}

Source: https://www.tradingview.com/pine-script-docs/concepts/strings

Shows the range quantifier {n, m}, which matches a pattern at least n times but no more than m times consecutively. The example matches word characters followed by repeated 'b' characters.

```Pine Script
regex.test("\\w{1,5}b{2,4}", "wordbbbb")
```

--------------------------------

### Pine Script: `alertcondition()` Function for Custom Alerts

Source: https://www.tradingview.com/pine-script-docs/release-notes

The `alertcondition()` function, added in January 2016, allows users to define custom alert conditions directly within their Pine Script indicators, enabling more sophisticated alert setups.

```Pine Script
// Example of alertcondition
alertcondition(close > open, title="Bullish Candle", message="Price increased today")
```

--------------------------------

### Pine Script v5 RSI Overload Replacement

Source: https://www.tradingview.com/pine-script-docs/migration-guides/to-pine-version-5

Provides the equivalent formula to replace the removed second overload of the `rsi()` function in Pine Script v5. This addresses cases where `rsi()` was used with a float argument in v4.

```Pine Script
100.0 - (100.0 / (1.0 + arg1 / arg2))  
```

--------------------------------

### Request Daily Financial Data with request.financial()

Source: https://www.tradingview.com/pine-script-docs/release-notes

Demonstrates how to use the request.financial() function to retrieve daily financial data, such as Net Asset Value (NAV), for a given symbol. The 'D' argument specifies the daily period.

```Pine Script
//@version=5
indicator("Daily financial data demo")

//@variable The daily Premium/Discount to Net Asset Value for "AMEX:SPY"
float f1 = request.financial("AMEX:SPY", "NAV", "D")
plot(f1)

```

--------------------------------

### Display Map Data in a Table with for...in Loop

Source: https://www.tradingview.com/pine-script-docs/language/maps

This example showcases a Pine Script® indicator that visualizes map data in a table. It defines a custom `toTable()` method which uses a `for...in` loop to iterate through a map of string keys and float values (representing moving averages of price and volume) and populates a table with this information.

```Pine Script®
//@version=6
indicator("Looping through a map demo", "Table of averages")

//@variable The length of the moving average.
int length = input.int(20, "Length")
//@variable The size of the table text.
string txtSize = input.string(
    size.huge, "Text size",
    options = [size.auto, size.tiny, size.small, size.normal, size.large, size.huge]
)

//@function Displays the pairs of `this` map within a table.
//@param     this A map with `string` keys and `float` values.
//@param     position The position of the table on the chart.
//@param     header The string to display on the top row of the table.
//@param     textSize The size of the text in the table.
//@returns   A new `table` object with cells displaying each pair in `this`.
method toTable(
    map<string, float> this, string position = position.middle_center, string header = na,
    string textSize = size.huge
) =>
    // Color variables
    borderColor = #000000
    headerColor = color.rgb(1, 88, 80)
    pairColor   = color.maroon
    textColor   = color.white

    //@variable A table that displays the key-value pairs of `this` map.
    table result = table.new(
        position, this.size() + 1, 3, border_width = 2, border_color = borderColor
    )
    // Initialize top and side header cells.
    result.cell(1, 0, header, bgcolor = headerColor, text_color = textColor, text_size = textSize)
    result.merge_cells(1, 0, this.size(), 0)
    result.cell(0, 1, "Key", bgcolor = headerColor, text_color = textColor, text_size = textSize)
    result.cell(0, 2, "Value", bgcolor = headerColor, text_color = textColor, text_size = textSize)

    //@variable The column index of the table. Updates on each loop iteration.
    int col = 1

    // Loop over each `key` and `value` from `this` map in the insertion order.
    for [key, value] in this
        // Initialize a `key` cell in the `result` table on row 1.
        result.cell(
            col, 1, str.tostring(key), bgcolor = color.maroon,
            text_color = color.white, text_size = textSize
        )
        // Initialize a `value` cell in the `result` table on row 2.
        result.cell(
            col, 2, str.tostring(value), bgcolor = color.maroon,
            text_color = color.white, text_size = textSize
        )
        // Move to the next column index.
        col += 1
    result // Return the `result` table

//@variable A map with `string` keys and `float` values to hold `length`-bar averages.
averages = map.new<string, float>()

// Put key-value pairs into the `averages` map.
averages.put("Open", ta.sma(open, length))
averages.put("High", ta.sma(high, length))
averages.put("Low", ta.sma(low, length))
averages.put("Close", ta.sma(close, length))
averages.put("Volume", ta.sma(volume, length))

//@variable The text to display at the top of the table.
string headerText = str.format("{0} {1}-bar averages", "'" + syminfo.tickerid + "'", length)
// Display the `averages` map in a `table` with the `headerText`.
averages.toTable(header = headerText, textSize = txtSize)
```

--------------------------------

### Pine Script Indicator with Function and Conditional Coloring

Source: https://www.tradingview.com/pine-script-docs/language/script-structure

An example of a Pine Script indicator that defines a function to check if a bar is up, uses a conditional variable for plot color based on the function's result, and applies background coloring. It demonstrates local blocks and scopes.

```Pine Script
//@version=6

indicator("", "", true) // Declaration statement (global scope)

barIsUp() => // Function declaration (global scope)
    close > open // Local block (local scope)

plotColor = if barIsUp() // Variable declaration (global scope)
    color.green // Local block (local scope)
else
    color.red // Local block (local scope)

bgcolor(color.new(plotColor, 70)) // Call to a built-in function (global scope)
```

--------------------------------

### Pine Script: Detect New Week/Month using timeframe.change()

Source: https://www.tradingview.com/pine-script-docs/faq/times-dates-and-sessions

This snippet demonstrates the simplest approach to detect the start of a new week or month using the `timeframe.change()` function. It's a concise way to manage these temporal changes within your Pine Script indicators or strategies.

```Pine Script
bool isNewWeek = timeframe.change("1W")  
bool isNewMonth = timeframe.change("1M")  

```

--------------------------------

### Pine Script: Demonstrate Copied Object Independence

Source: https://www.tradingview.com/pine-script-docs/language/type-system

This script demonstrates how to create independent copies of reference types using the `label.copy()` function. Changes made to one copied object do not affect the original or other copies.

```Pine Script®
//@version=6  
indicator("Copied objects demo")  

if barstate.islastconfirmedhistory  
    // Create a new label and assign its reference to a variable.  
    label myLabel1 = label.new(bar_index, 0, "First label", color = color.green, size = size.large)  
    // Initialize a second variable using `label.copy(myLabel1)`. This variable now references an independent copy   
    // of the initial label instead of pointing to the same object as `myLabel1`, and the script now displays two labels   
    // on the chart.  
    label myLabel2 = label.copy(myLabel1)  

    // Now that `myLabel2` refers to a different `label` object than `myLabel1`, this call does not affect that object.  
    label.set_color(myLabel1, color.red)  
```

--------------------------------

### Pine Script: Create Submatrix from Existing Matrix

Source: https://www.tradingview.com/pine-script-docs/language/matrices

Illustrates how to create a submatrix, which is a shallow copy of a portion of an existing matrix. The `matrix.submatrix()` function allows specifying the start and end rows and columns to include in the new submatrix. This is useful for analyzing specific segments of data within a larger matrix.

```Pine Script
//@version=6
indicator("Submatrix demo")

//@function Displays the rows of a matrix in a label with a note.
//@param    this The matrix to display.
//@param    barIndex The `bar_index` to display the label at.
//@param    bgColor The background color of the label.
//@param    textColor The color of the label's text.
//@param    note The text to display above the rows.
method debugLabel(
     matrix<float> this, int barIndex = bar_index, color bgColor = color.blue,
     color textColor = color.white, string note = "") =>
    labelText = note + "\n" + str.tostring(this)
    if barstate.ishistory
        label.new(
             barIndex, 0, labelText, color = bgColor, style = label.style_label_center,
             textcolor = textColor, size = size.huge
         )

//@variable A 3x3 matrix of values.
var m = matrix.new<float>()

if bar_index == last_bar_index - 1
    // Add columns to `m`.
    m.add_col(0, array.from(9, 6, 3))
    m.add_col(1, array.from(8, 5, 2))
    m.add_col(2, array.from(7, 4, 1))
    // Display the rows of `m`.
    m.debugLabel(note = "Original Matrix")

    //@variable A 2x2 submatrix of `m` containing the first two rows and columns.
    matrix<float> mSub = m.submatrix(from_row = 0, to_row = 2, from_column = 0, to_column = 2)
    // Display the rows of `mSub`
    debugLabel(mSub, bar_index + 10, bgColor = color.green, note = "Submatrix")

```

--------------------------------

### Pine Script: Setting Script Title with indicator()

Source: https://www.tradingview.com/pine-script-docs/writing/publishing

This snippet shows how to use the `title` argument in the `indicator()`, `strategy()`, or `library()` declaration statement to provide a meaningful and searchable title for the script.

```Pine Script
// Example of setting the script title using the indicator() declaration

//@version=5
indicator("My Awesome Trading Indicator", shorttitle="MA Cross", overlay=true)

// Script logic here

plot(close)
```

--------------------------------

### Pine Script GCD function demo without bar limit

Source: https://www.tradingview.com/pine-script-docs/writing/profiling-and-optimization

Demonstrates a naive GCD function in Pine Script that iterates up to N times, where N is the smallest of the two input integers. This example plots the GCD of 10000 and (10000 + bar_index) without limiting historical bar execution.

```Pine Script
//@version=6  
indicator("Script takes too long while profiling demo")  

//@function Calculates the greatest common divisor of `a` and `b` using a naive algorithm.  
gcd(int a, int b) =>  
    //@variable The greatest common divisor.  
    int result = math.max(math.min(math.abs(a), math.abs(b)), 1)  
    // Reduce the `result` by 1 until it divides `a` and `b` without remainders.  
    while result > 0  
        if a % result == 0 and b % result == 0  
            break  
        result -= 1  
    // Return the `result`.  
    result  
  
plot(gcd(10000, 10000 + bar_index), "GCD")  

```

--------------------------------

### Pine Script: Variable Declarations on Each Bar

Source: https://www.tradingview.com/pine-script-docs/language/variable-declarations

This Pine Script example showcases various variable declarations that occur on each bar when no explicit declaration mode is specified. It includes integer, float, color, and array initializations, as well as function calls for calculations and plotting.

```Pine Script
BULL_COLOR = color.lime
i = 1
len = input(20, "Length")
float f = 10.5
closeRoundedToTick = math.round_to_mintick(close)
st = ta.supertrend(4, 14)
[macdLine, signalLine, histLine] = ta.macd(close, 12, 26, 9)
plotColor = if close > open
    color.green
else
    color.red

```

--------------------------------

### Pine Script: Out-of-Bounds Negative Indexing Error (v6)

Source: https://www.tradingview.com/pine-script-docs/migration-guides/to-pine-version-6

Illustrates that attempting to access array elements using negative indices beyond the array's bounds will still result in a runtime error in Pine Script v6.

```Pine Script
//@variable Array of "int" numbers from 1 to 5.  
array<int> countingArray = array.from(1, 2, 3, 4, 5)  
  
// Trying to index negatively beyond the size of the array causes a runtime error.  
countingArray.remove(-6)  
```

--------------------------------

### Pine Script: Initial Realtime Drawing Error Example

Source: https://www.tradingview.com/pine-script-docs/error-messages

This snippet illustrates a common scenario leading to runtime errors when drawings created on real-time data extend into the past. It shows the problematic code that triggers an error due to insufficient historical buffer size when accessing historical `bar_index` values.

```Pine Script
//@version=6
indicator("Realtime error with drawings")

if barstate.isrealtime
    line.new(bar_index[500], close, bar_index, close)

```

--------------------------------

### Pine Script `for` loop: Calculate and plot VWMA differences

Source: https://www.tradingview.com/pine-script-docs/language/loops

This Pine Script example calculates the Volume-Weighted Moving Average (VWMA) of open prices and then uses a downward-counting `for` loop to compare the current VWMA with past values. It displays the difference in labels at past bar openings, illustrating a descending `for` loop.

```Pine Script
//\@version=6  
//indicator("`for` loop demo", "VWMA differences", true, max_labels_count = 500)  
//  
////@variable Display color for indicator visuals.  
//const color DISPLAY_COLOR = color.rgb(17, 127, 218)  
//  
////@variable The number of bars in the `vwmaOpen` calculation.  
//int maLengthInput = input.int(20, "VWMA length", 1)  
////@variable The number of past bars to look back through and compare to the current bar.  
//int lookbackInput = input.int(15, "Lookback length", 1, 500)  
//  
////@variable The volume-weighted moving average of `open` values over `maLengthInput` bars.  
//float vwmaOpen = ta.vwma(open, maLengthInput)  
//  
//if //barstate.islastconfirmedhistory  
//    // Define a `for` loop that counts *downward* from `i == lookbackInput` to `i == 1`.  
//    //for i = lookbackInput to 1  
//    //    //@variable The difference between the `vwmaOpen` from `i` bars ago and the current `vwmaOpen`.  

```

--------------------------------

### Pine Script: Using Pine Logs for Debugging

Source: https://www.tradingview.com/pine-script-docs/writing/publishing

This snippet demonstrates the use of Pine Logs, a debugging technique in Pine Script, to verify script functionality and identify issues in calculations or logic before publication.

```Pine Script
// Example of using Pine Logs for debugging
// Replace with actual script logic

//@version=5
indicator("My Script with Debugging", overlay=true)

price = close

// Simulate a calculation that might need debugging
calculated_value = price * 2

// Use log.info() to output values for debugging
if barstate.islast
    log.info("The calculated value on the last bar is: {{calculated_value}}")

plot(calculated_value)
```

--------------------------------

### Implement Persistent Variables with 'var' in Pine Script

Source: https://www.tradingview.com/pine-script-docs/language/execution-model

This Pine Script example demonstrates the use of the 'var' keyword to create persistent variables. The variable 'x' is initialized only once on the first bar and retains its value across subsequent executions, resulting in an incrementally increasing plot.

```Pine Script
//@version=6  
indicator("Persistent declarations demo")  
  
//@variable A *persistent* variable. The script initializes this variable only on the *first execution*.   
var int x = 0

// Increase the value of `x` by 10 on every bar.
x += 10

// Plot the value of `x`.
// Because `x` is persistent, the plotted value increases by 10 on each bar.
plot(x, "`x` value", color.red, 3)

```

--------------------------------

### Pine Script: Implement Time-Delayed Orders

Source: https://www.tradingview.com/pine-script-docs/faq/strategies

This Pine Script code demonstrates how to add time delays between orders. It allows users to specify whether the delay should be based on time or a number of bars. The script includes logic to calculate time since the last trade or bars since the last trade, and entry conditions are set to allow new orders only after the delay has passed. It also includes an example of closing trades after a certain number of bars.

```Pine Script
//@version=6  
strategy("Time-delayed orders", overlay=true,  max_labels_count = 500,  max_lines_count = 500)
  
import PineCoders/Time/4 as PCtime  
  
// Constants  
string TU1 = "seconds", string TU2 = "minutes", string TU3 = "hours", string TU4 = "days"
string TU5 = "weeks",  string TU6 = "months",  string DT1 = "bars",  string DT2 = "time"
  
// Tooltips for inputs  
string D_TT = "Delay orders for a specific number of bars or a specific duration of time since the last trade."
string N_TT = "Specify the number of bars or time units."
string U_TT = "Unit of time; relevant only if the delay type is 'time'."
  
// User inputs for delay type, number of units/bars, and time units.
string delayTypeInput = input.string(DT2, "Delay type",                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
```

--------------------------------

### Update Label Position and Text on Last Bar

Source: https://www.tradingview.com/pine-script-docs/concepts/bar-states

This example utilizes `barstate.islast` to efficiently update a label's position and text only on the last bar of the chart. It demonstrates creating the label once and updating it subsequently for better performance.

```Pine Script
//\n// Create label on the first bar only.\n// Update the label's position and text on the last bar,\n// including on all realtime bar updates.\n//\n//@version=6  
indicator("", "", true)  
var label hiLabel = label.new(na, na, "")  
if barstate.islast  
    label.set_xy(hiLabel, bar_index, high)  
    label.set_text(hiLabel, str.tostring(high, format.mintick))  

```

--------------------------------

### Pine Script RSI Strategy Example

Source: https://www.tradingview.com/pine-script-docs/faq/strategies

This Pine Script® strategy is converted from an RSI indicator. It uses the same RSI calculation and plotting as the indicator but adds `strategy.entry()` calls to simulate long and short trades based on RSI crossovers and crossunders of the 50 level. A long entry cancels a short trade and vice-versa.

```Pine Script®
//@version=6  
strategy("Example RSI strategy")  
float rsi = ta.rsi(close, 14)  
plot(rsi, "RSI", rsi >= 50 ? color.lime : color.fuchsia)  
hline(50, "Middle line", linestyle = hline.style_solid)  
plotshape(ta.crossover(rsi,  50), "Cross up",   shape.triangleup,   location.bottom, color.lime)  
plotshape(ta.crossunder(rsi, 50), "Cross Down", shape.triangledown, location.top,    color.fuchsia)  
barcolor(rsi >= 50 ? color.lime : color.fuchsia)  
  
if ta.crossover(rsi,  50)  
    strategy.entry("Long", strategy.long, comment = "Long")  
  
if ta.crossunder(rsi,  50)  
    strategy.entry("Short", strategy.short, comment = "Short")  

```

--------------------------------

### Pine Script Bollinger Bands with Array Functions

Source: https://www.tradingview.com/pine-script-docs/language/methods

This script calculates Bollinger Bands using traditional Pine Script array functions like `array.push()`, `array.shift()`, `array.avg()`, and `array.stdev()`. It demonstrates how to manage a queue of source inputs and compute statistical values for band calculation.

```Pine Script
//@version=6  
indicator("Custom Sample BB", overlay = true)  
  
float sourceInput  = input.source(close, "Source")  
int   samplesInput = input.int(20, "Samples")  
int   n            = input.int(10, "Bars")  
float multiplier   = input.float(2.0, "StdDev")  
  
var array<float> sourceArray = array.new<float>(samplesInput)  
var float        sampleMean  = na  
var float        sampleDev   = na  
  
// Identify if `n` bars have passed.  
if bar_index % n == 0  
    // Update the queue.  
    array.push(sourceArray, sourceInput)  
    array.shift(sourceArray)  
    // Update the mean and standard deviation values.  
    sampleMean  := array.avg(sourceArray)  
    sampleDev   := array.stdev(sourceArray) * multiplier  
  
// Calculate bands.  
float highBand = sampleMean + sampleDev  
float lowBand  = sampleMean - sampleDev  
  
plot(sampleMean, "Basis", color.orange)  
plot(highBand, "Upper", color.lime)  
plot(lowBand, "Lower", color.red)  

```

--------------------------------

### Pine Script: Draw Box with Wrapped Text and Label

Source: https://www.tradingview.com/pine-script-docs/faq/strings-and-formatting

This example demonstrates drawing a box with automatically wrapping text and a label on a TradingView chart. The box spans the last 50 bars, and its text wraps to fit within the box boundaries using `text_wrap = text.wrap_auto`. A label is also drawn with its text displayed as is, showcasing the difference in text handling between boxes and labels.

```Pine Script
//@version=6  
indicator("Box and label text", overlay = true)  
  
if  barstate.islastconfirmedhistory    bt = "This long text is inside of a box, which means it is automatically wrapped and scaled to be visible in the constraints of the box."    lt = "This long text is inside of a label, which means that it is displayed as is, and the label is simply drawn around it. It doesn't change when the chart is scaled."    box.new(bar_index[50], close * 1.1, bar_index, close, text = bt, text_wrap = text.wrap_auto, text_size = 36)    label.new(bar_index[25], close * 1.1, lt, size = 36)  

```

--------------------------------

### Pine Script: Conditional Label Drawing to Manage Limits

Source: https://www.tradingview.com/pine-script-docs/writing/limitations

This example shows how to conditionally draw labels using an `if` structure to prevent creating unnecessary label IDs. This method helps manage the `max_labels_count` limit more effectively by only creating labels when needed.

```Pine Script
//@version=6

// Approximate maximum number of label drawings
MAX_LABELS = 10

indicator("conditional labels", overlay = false, max_labels_count = MAX_LABELS)

// Add background color for the last MAX_LABELS bars.
bgcolor(bar_index > last_bar_index - MAX_LABELS ? color.new(color.green, 80) : na)

longCondition =  bar_index % 2 != 0
shortCondition = bar_index % 2 == 0

// Add a "Buy" label when `longCondition` is true.
if longCondition
    label.new(bar_index,  0, text = "Buy", color = color.new(color.green, 0), style = label.style_label_up)
// Add a "Sell" label when `shortCondition` is true.
if shortCondition
    label.new(bar_index, 0, text = "Sell", color = color.new(color.red, 0), style = label.style_label_down)

plot(longCondition  ? 1 : 0)
plot(shortCondition ? 1 : 0)
```

--------------------------------

### Pine Script: Map.put() and Map.get() with Custom Objects

Source: https://www.tradingview.com/pine-script-docs/language/maps

This example shows how to store and retrieve custom objects (ChartData) using map.put() and map.get(). It highlights that storing objects in a map creates a reference, so modifying the object through one key affects other references to the same object.

```Pine Script
`
```

--------------------------------

### Color Moving Average Based on Trend

Source: https://www.tradingview.com/pine-script-docs/concepts/colors

This script colors a Simple Moving Average (SMA) based on whether it is rising or not. It uses user-defined colors for bull and bear states and the ternary operator for conditional color assignment.

```Pine Script
//@version=6
indicator("Conditional colors", "", true)
int  lengthInput = input.int(20, "Length", minval = 2)
color maBullColorInput = input.color(color.green, "Bull")
color maBearColorInput = input.color(color.maroon, "Bear")
float ma = ta.sma(close, lengthInput)
// Define our states.
bool maRising  = ta.rising(ma, 1)
// Build our color.
color maColor = maRising ? maBullColorInput : maBearColorInput
plot(ma, "MA", maColor, 2)

```

--------------------------------

### Pine Script Strategy Declaration

Source: https://www.tradingview.com/pine-script-docs/writing/publishing

Demonstrates the use of arguments within the strategy() declaration statement in Pine Script for realistic simulation. This includes setting initial capital, commissions, slippage, and margin to reflect real-world trading conditions.

```Pine Script
//@version=5
strategy("My Strategy", initial_capital=10000, commission_type=strategy.commission.percent, commission_value=0.1, slippage=2, default_qty_type=strategy.percent_of_equity, default_qty_value=10, pyramiding=0)
```

--------------------------------

### Pine Script: Prevent 'Matrix Too Large' Errors

Source: https://www.tradingview.com/pine-script-docs/language/matrices

Illustrates how to avoid the 'Matrix too large' error by ensuring the total number of elements in a matrix does not exceed the 100,000 limit. The example shows a script that exceeds this limit by adding too many elements.

```Pine Script
//@version=6  
indicator("Matrix too large demo")  

var matrix<float> m = matrix.new<float>()  

if bar_index == 0 
    for i = 1 to 1000 
      // This raises an error because the script adds 101 elements on each iteration. 
      // 1000 rows * 101 elements per row = 101000 total elements. This is too large. 
      m.add_row(m.rows(), array.new<float>(101, i)) 

plot(m.get(0, 0))  

```

--------------------------------

### Detect First Occurrence of Event Today in Pine Script

Source: https://www.tradingview.com/pine-script-docs/faq/techniques

Demonstrates two methods to detect if an event, like an upward candle, occurs for the first time since the beginning of the day. Method 1 uses `ta.barssince()` to compare bars since the last event with bars since the start of the day. Method 2 utilizes a persistent state variable that resets daily.

```Pine Script
//@version=6  
indicator("First time today example", "", true)  

bool isUpCandle = close > open  

// ————— Method 1.  
int barsSincePreviousUpCandle = ta.barssince(isUpCandle[1])   
int barsSinceStartOfDay = ta.barssince(timeframe.change("1D")) - 1  
bool previousUpCandleWasNotToday = barsSincePreviousUpCandle > barsSinceStartOfDay  
bool isFirstToday1 = isUpCandle and previousUpCandleWasNotToday  
plotchar(isFirstToday1, "isFirstToday1", "•", location.top, color = color.silver, size = size.normal)  

plot(barsSinceStartOfDay, "barsSinceStartOfDay", display=display.data_window)  

// ————— Method 2.  
var bool hadUpCandleToday = false  // This is a persistent state.  
bool     isFirstToday2    = false  // This is a one-off event.  
if timeframe.change("1D")  // When the day begins..  
    hadUpCandleToday := false  // we have not yet had an up candle today, so reset the state.  
if isUpCandle and not hadUpCandleToday  // If this is the first up candle today..  
    hadUpCandleToday := true  // set the persistent state  
    isFirstToday2    := true  // and update the event.  
plotchar(isFirstToday2, "isFirstToday2", "•", location.top, color = color.yellow, size = size.small)  
```

--------------------------------

### Display Array Contents Using Labels

Source: https://www.tradingview.com/pine-script-docs/faq/data-structures

Shows how to use `label.new()` to display array values, which is useful for non-continuous data or viewing all array elements at once. Labels can display various array types (including strings and booleans) and can be created within local scopes. The example monitors closing prices at MA crosses and displays the array of these prices.

```Pine Script®
//@version=6  
indicator("Array elements in a label", overlay = true)  
var array<float> crossPrices = array.new<float>(4)  
float fastMa = ta.ema(close, 9)  
float slowMa = ta.ema(close, 21)  
if ta.cross(fastMa, slowMa)  
    crossPrices.push(close)  
    crossPrices.shift()  
    label.new(bar_index, high, str.tostring(crossPrices), textcolor = color.white)  
plot(fastMa, "Fast MA", color.aqua)  
plot(slowMa, "Slow MA", color.orange)  

```

--------------------------------

### Pine Script: Repainting HTF Data Request

Source: https://www.tradingview.com/pine-script-docs/concepts/other-timeframes-and-data

Demonstrates a repainting higher-timeframe data request in Pine Script. This example uses `request.security()` without offset modifications or additional arguments, leading to potential repainting due to unconfirmed values on real-time bars.

```Pine Script
//\@version=6  
indicator("Avoiding\u00a0HTF\u00a0repainting\u00a0demo",\u00a0overlay\u00a0=\u00a0true)  
  
//\@variable\u00a0The\u00a0multiplier\u00a0applied\u00a0to\u00a0the\u00a0chart's\u00a0timeframe.  
int\u00a0tfMultiplier\u00a0=\u00a0input.int(10,\u00a0"Timeframe\u00a0multiplier",\u00a01)  
//\@variable\u00a0The\u00a0number\u00a0of\u00a0bars\u00a0in\u00a0the\u00a0moving\u00a0average.  
int\u00a0length\u00a0=\u00a0input.int(5,\u00a0"WMA\u00a0smoothing\u00a0length")  
  
//\@variable\u00a0The\u00a0valid\u00a0timeframe\u00a0string\u00a0closest\u00a0to\u00a0`tfMultiplier`\u00a0times\u00a0larger\u00a0than\u00a0the\u00a0chart\u00a0timeframe.  
string\u00a0timeframe\u00a0=\u00a0timeframe.from_seconds(timeframe.in_seconds()\u00a0*\u00a0tfMultiplier)  
  
//\@variable\u00a0The\u00a0weighted\u00a0MA\u00a0of\u00a0`close`\u00a0prices\u00a0over\u00a0`length`\u00a0bars\u00a0on\u00a0the\u00a0`timeframe`.  
//\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0This\u00a0request\u00a0repaints\u00a0because\u00a0it\u00a0includes\u00a0unconfirmed\u00a0HTF\u00a0data\u00a0on\u00a0realtime\u00a0bars\u00a0and\u00a0it\u00a0may\u00a0offset\u00a0the  
//\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0times\u00a0of\u00a0its\u00a0historical\u00a0results.  
float\u00a0requestedWMA\u00a0=\u00a0request.security(syminfo.tickerid,\u00a0timeframe,\u00a0ta.wma(close,\u00a0length))  
  
//\u00a0Plot\u00a0the\u00a0requested\u00a0series.  
plot(requestedWMA,\u00a0"HTF\u00a0WMA",\u00a0color.purple,\u00a03)  
//\u00a0Highlight\u00a0the\u00a0background\u00a0on\u00a0realtime\u00a0bars.  
bgcolor(barstate.isrealtime\u00a0?\u00a0color.new(color.orange,\u00a070)\u00a0:\u00a0na,\u00a0title\u00a0=\u00a0"Realtime\u00a0bar\u00a0highlight")  

```

--------------------------------

### Renko Strategy with Custom Context in Pine Script

Source: https://www.tradingview.com/pine-script-docs/concepts/other-timeframes-and-data

This example demonstrates how to create a strategy that uses Renko price values for its calculations by generating a Renko ticker ID. This allows the strategy to simulate trades based on Renko data while the main chart remains on a standard type.

```Pine Script
//@version=6
strategy(
    "Custom contexts demo 3", "Renko strategy", true, default_qty_type = strategy.percent_of_equity,
    default_qty_value = 2, initial_capital = 50000, slippage = 2,
    commission_type = strategy.commission.cash_per_contract, commission_value = 1, margin_long = 100,
    margin_short = 100
)

// When `true`, the strategy places a long market order.
bool longEntry = ta.crossover(close, open)
// When `true`, the strategy places a short market order.
bool shortEntry = ta.crossunder(close, open)

if longEntry
    strategy.entry("Long Entry", strategy.long)
if shortEntry
    strategy.entry("Short Entry", strategy.short)
```

--------------------------------

### Pine Script Positive Lookahead Assertion (?=...)

Source: https://www.tradingview.com/pine-script-docs/concepts/strings

Explains the positive lookahead assertion (?=...), which checks if a sequence follows the current match location without consuming characters. The example matches 'a' only if followed by 'b'.

```Pine Script
regex.test("a(?=b)", "abc")
```

--------------------------------

### Pine Script: Grouped Exit Orders with strategy.oca.reduce

Source: https://www.tradingview.com/pine-script-docs/faq/strategies

This Pine Script example demonstrates how to implement grouped exit orders using `strategy.oca.reduce`. It sets up a strategy with one entry and multiple exit orders (one stop, two limit orders) that share the same `oca_name`. When any of these exit orders are filled, the quantities of the remaining orders in the group are automatically reduced.

```Pine Script
//@version=6  
strategy("Multiple TP, one stop demo", overlay = true)  
  
int exitPercentInput = input.int(1, "Exit %", minval = 1, maxval = 99)  
float exitPercent = exitPercentInput / 100  
  
var float stop   = na  
var float limit1 = na  
var float limit2 = na  
  
bool buyCondition = bar_index % 100 == 0  // Is `true` on every 100th bar.  
  
// Place orders when `buyCondition` is true and we are not in a position.  
if buyCondition and strategy.position_size == 0  
      stop   := close * (1 - exitPercent)  
      limit1 := close * (1 + exitPercent)  
      limit2 := close * (1 + (2 * exitPercent))  
      strategy.entry("Long",      strategy.long, 6)  
      // All three sell orders use the "Bracket" OCA group; filling one order reduces theu00a0quantity of the remaining orders.  
      strategy.order("Stop",      strategy.short, stop  = stop,   qty = 6, oca_name = "Bracket", oca_type = strategy.oca.reduce)  
      strategy.order("Limit 1", strategy.short, limit = limit1, qty = 3, oca_name = "Bracket", oca_type = strategy.oca.reduce)  
      strategy.order("Limit 2", strategy.short, limit = limit2, qty = 6, oca_name = "Bracket", oca_type = strategy.oca.reduce)  
  
// Set `limit1` to `na` when price exceeds it.  
if high >= limit1  
      limit1 := na  
// Set `stop`, `limit11`, and `limit2` to `na` when price surpasses either the last take-profit, or the stop.  
if low <= stop or high >= limit2  
      stop := na, limit1 := na, limit2 := na  
  
plot(stop,    "Stop",   color.red,   style = plot.style_linebr)  
plot(limit1, "Limit 1", color.green, style = plot.style_linebr)  
plot(limit2, "Limit 2", color.green, style = plot.style_linebr)  
```

--------------------------------

### Count Real-time Updates Per Bar

Source: https://www.tradingview.com/pine-script-docs/concepts/bar-states

This code snippet uses `barstate.isnew` to reset a counter on new bars (historical or the start of a real-time bar). It calculates and plots the number of real-time updates occurring within each real-time bar.

```Pine Script
//\n// Calculate the number of realtime updates during each realtime bar:\n//\n//@version=6  
indicator("")  
updateNo() =>  
    varip int updateNo = na  
    if barstate.isnew  
        updateNo := 1  
    else  
        updateNo += 1  
plot(updateNo())  

```

--------------------------------

### Pine Script: Offset Parameter Change (v5 to v6)

Source: https://www.tradingview.com/pine-script-docs/migration-guides/to-pine-version-6

Demonstrates the change in the `offset` parameter behavior from Pine Script v5 to v6. In v5, 'series' values were accepted but used the last calculated value. In v6, 'series' values cause compilation errors, and only 'simple' or weaker qualifiers are accepted.

```Pine Script
//@version=5
indicator("`offset` parameter demo", overlay = true)

//@variable `series int` value. Used as `offset` parameter value in `plot()`.
int seriesOffset = bar_index / 2
// In v5, a `series` type `offset` value is valid, but only the last calculated value is used.  
plot(math.max(close, open),"", color.orange, 4, plot.style_stepline, offset = seriesOffset)
```

```Pine Script
//@version=6
indicator("`offset` parameter demo", overlay = true)

//@variable `simple int` value. Used as `offset` parameter value in `plot()`.
int seriesOffset = bar_index / 2
// In v6, a `series` type `offset` value causes a compilation error. Use a `simple` type instead.
plot(math.max(close, open),"", color.orange, 4, plot.style_stepline, offset = seriesOffset)
```

--------------------------------

### Format Bar Information with str.format()

Source: https://www.tradingview.com/pine-script-docs/concepts/strings

Demonstrates using str.format() to create a detailed string with various bar information, including execution count, open, high, low, close, volume, and bar state. The formatted string is then displayed as a label at the bar's high.

```Pine Script®
//@version=6  
indicator("Formatting strings demo", overlay = true)  
  
//@variable Counts script executions in a bar. Does not roll back because it is declared with `varip`.   
varip int exCount = 0  
exCount += 1  
  
//@variable Is `true` when the `close` exceeds the current `open` and the previous `close`; `false` otherwise.   
bool rising = close > math.max(nz(close[1]), open)  
//@variable Is `"realtime"` for all new bars after the script's historical executions; `"historical"` otherwise.   
string barState = barstate.isrealtime ? "realtime" : "historical"  
  
//@variable A formatting string containing placeholders for 10 values.   
string formatString = "Bar: {1} ({9}){0}{0}Executions: {2}{0}O: {3}{0}H: {4}{0}L: {5}{0}C: {6}{0}V: {7}{0}Rising: {8}"  
  
//@variable A multiline string containing formatted information for the current bar.   
string formattedString = str.format(  
     formatString, "\n\t", bar_index, exCount - nz(exCount[1]), open, high, low, close, volume, rising, barState  
 )  
  
// Draw a label displaying the `formattedString` at the bar's `high`.   
label.new(bar_index, high, formattedString, size = 18, textalign = text.align_left)  

```

--------------------------------

### Pine Script: Plot circles for rising conditions using plot()

Source: https://www.tradingview.com/pine-script-docs/concepts/text-and-shapes

This example shows an alternative method using the plot() function to display circles on bars that meet specific rising conditions. It highlights the need to manually adjust the position of the circles using `ta.tr`.

```Pine Script
//@version=6  
indicator("", "", true)  
longSignal = ta.rising(close, 2) and ta.rising(high, 2) and (na(volume) or ta.rising(volume, 2))  
plot(longSignal ? low - ta.tr : na, "Long", color.blue, 2, plot.style_circles)  

```

--------------------------------

### Populate and Read Array Elements with Transparency

Source: https://www.tradingview.com/pine-script-docs/language/arrays

This script demonstrates populating a color array with varying transparency levels using array.set() and then reading elements with array.get(). It dynamically sets the background color based on the highest price within a lookback period.

```Pine Script®
//@version=6  
indicator("Distance from high", "", true)  
lookbackInput = input.int(100)  
FILL_COLOR = color.green  
// Declare array and set its values on the first bar only.  
var fillColors = array.new<color>(5)  
if barstate.isfirst   
  // Initialize the array elements with progressively lighter shades of the fill color.    fillColors.set(0, color.new(FILL_COLOR, 70))    fillColors.set(1, color.new(FILL_COLOR, 75))    fillColors.set(2, color.new(FILL_COLOR, 80))    fillColors.set(3, color.new(FILL_COLOR, 85))    fillColors.set(4, color.new(FILL_COLOR, 90))  
  
lastHiBar = - ta.highestbars(high, lookbackInput)  
// Convert the offset to an array index, capping it to 4 to avoid a runtime error.  
// The index used by `array.get()` will be the equivalent of `floor(fillNo)`.  
fillNo = math.min(lastHiBar / (lookbackInput / 5), 4)  
// Set background to a progressively lighter fill with increasing distance from location of highest high.  
bgcolor(array.get(fillColors, fillNo))  
// Plot key values to the Data Window for debugging.  
plotchar(lastHiBar, "lastHiBar", "", location.top, size = size.tiny)  
plotchar(fillNo, "fillNo", "", location.top, size = size.tiny)  

```

--------------------------------

### Pine Script: Exit Orders with Invalid 'from_entry' ID

Source: https://www.tradingview.com/pine-script-docs/concepts/strategies

This Pine Script example illustrates the behavior of strategy.exit() when the 'from_entry' argument does not match any existing entry orders. The code attempts to place exit orders for an entry ID ('buy2') that is not created, resulting in no exit orders being placed. This highlights the importance of matching entry and exit IDs.

```Pine Script
`//@version=6  
strategy("Invalid `from_entry` ID demo", overlay = true)  
 
//@variable Is `true` on every 100th bar.  
bool buyCondition = bar_index % 100 == 0  
 
//@variable The current take-profit order price.   
var float takeProfit = na 
//@variable The current stop-loss order price.   
var float stopLoss = na 
 
if buyCondition 
    // Update the `takeProfit` and `stopLoss` values before entering the trade.   
    if strategy.opentrades == 0 
       takeProfit := close * 1.01 
       stopLoss   := close * 0.99 
    // Place a long market order.   
    strategy.entry("buy", strategy.long) 
    // Attempt to place an exit bracket for "buy2" entries.   
    // This call has no effect because the strategy does not create entry orders with the "buy2" ID.   
    strategy.exit("exit", "buy2", limit = takeProfit, stop = stopLoss) 
 
`
```
